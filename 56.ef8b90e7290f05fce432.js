(function(){(this||window).webpackJsonp.registerAbsMids({"esri/tasks/support/FeatureSet":1464,"esri/views/3d/layers/PointCloudWorker":1471,"esri/geometry/support/normalizeUtils":1509,"esri/tasks/support/AttachmentQuery":1559,"esri/tasks/support/RelationshipQuery":1586,"esri/views/3d/layers/i3s/PointCloudRendererUtil":1650,"esri/views/3d/layers/PointCloudLayerView3D":2264,"esri/views/3d/layers/i3s/LoDUtil":2265,"esri/views/3d/layers/i3s/PagedNodeIndex":2266,"esri/views/3d/layers/i3s/PointRenderer":2267,"esri/views/3d/webgl-engine/shaders/PointRendererPrograms":2268})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[56,95],{1464:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(2),r(43),r(79),r(8),r(24),r(0),r(34),r(69),r(354)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p){var h=new s.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent"}),c=function(e){function t(t){var r=e.call(this,t)||this;return r.displayFieldName=null,r.exceededTransferLimit=!1,r.features=[],r.fields=null,r.geometryType=null,r.hasM=!1,r.hasZ=!1,r.queryGeometry=null,r.spatialReference=null,r}return n(t,e),t.prototype.readFeatures=function(e,t){for(var r=u.fromJSON(t.spatialReference),n=[],i=0;i<e.length;i++){var a=e[i],s=o.fromJSON(a),l=a.geometry&&a.geometry.spatialReference;s.geometry&&!l&&(s.geometry.spatialReference=r),n.push(s)}return n},t.prototype.writeGeometryType=function(e,t,r,n){if(e)h.write(e,t,r,n);else{var i=this.features;if(i)for(var o=0,a=i;o<a.length;o++){var s=a[o];if(s&&s.geometry)return void h.write(s.geometry.type,t,r,n)}}},t.prototype.writeSpatialReference=function(e,t,r,n){if(e)t.spatialReference=e.toJSON();else{var i=this.features;if(i)for(var o=0,a=i;o<a.length;o++){var s=a[o];s&&s.geometry&&s.geometry.spatialReference&&(t.spatialReference=s.geometry.spatialReference.toJSON())}}},t.prototype.toJSON=function(e){var t=this.write(null);if(t.features&&Array.isArray(e)&&e.length>0)for(var r=0;r<t.features.length;r++){var n=t.features[r];if(n.geometry){var i=e&&e[r];n.geometry=i&&i.toJSON()||n.geometry}}return t},t.prototype.quantize=function(e){for(var t=e.scale,r=t[0],n=t[1],i=e.translate,o=i[0],a=i[1],s=this.features,l=this._getQuantizationFunction(this.geometryType,function(e){return Math.round((e-o)/r)},function(e){return Math.round((a-e)/n)}),u=0,d=s.length;u<d;u++)l(s[u].geometry)||(s.splice(u,1),u--,d--);return this.transform=e,this},t.prototype.unquantize=function(){var e=this,t=e.geometryType,r=e.features,n=e.transform;if(!n)return this;for(var i=n.translate,o=i[0],a=i[1],s=n.scale,l=s[0],u=s[1],d=this._getHydrationFunction(t,function(e){return e*l+o},function(e){return a-e*u}),p=0,h=r;p<h.length;p++){var c=h[p].geometry;c&&d(c)}return this},t.prototype._quantizePoints=function(e,t,r){for(var n,i,o=[],a=0,s=e.length;a<s;a++){var l=e[a];if(a>0){var u=t(l[0]),d=r(l[1]);u===n&&d===i||(o.push([u-n,d-i]),n=u,i=d)}else n=t(l[0]),i=r(l[1]),o.push([n,i])}return o.length>0?o:null},t.prototype._getQuantizationFunction=function(e,t,r){var n=this;return"point"===e?function(e){return e.x=t(e.x),e.y=r(e.y),e}:"polyline"===e||"polygon"===e?function(e){for(var i=d.isPolygon(e)?e.rings:e.paths,o=[],a=0,s=i.length;a<s;a++){var l=i[a],u=n._quantizePoints(l,t,r);u&&o.push(u)}return o.length>0?(d.isPolygon(e)?e.rings=o:e.paths=o,e):null}:"multipoint"===e?function(e){var i;return(i=n._quantizePoints(e.points,t,r)).length>0?(e.points=i,e):null}:"extent"===e?function(e){return e}:void 0},t.prototype._getHydrationFunction=function(e,t,r){return"point"===e?function(e){e.x=t(e.x),e.y=r(e.y)}:"polyline"===e||"polygon"===e?function(e){for(var n,i,o=d.isPolygon(e)?e.rings:e.paths,a=0,s=o.length;a<s;a++)for(var l=o[a],u=0,p=l.length;u<p;u++){var h=l[u];u>0?(n+=h[0],i+=h[1]):(n=h[0],i=h[1]),h[0]=t(n),h[1]=r(i)}}:"extent"===e?function(e){e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax)}:"multipoint"===e?function(e){for(var n,i,o=e.points,a=0,s=o.length;a<s;a++){var l=o[a];a>0?(n+=l[0],i+=l[1]):(n=l[0],i=l[1]),l[0]=t(n),l[1]=r(i)}}:void 0},r([l.property({type:String,json:{write:!0}})],t.prototype,"displayFieldName",void 0),r([l.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"exceededTransferLimit",void 0),r([l.property({type:[o],json:{write:!0}})],t.prototype,"features",void 0),r([l.reader("features")],t.prototype,"readFeatures",null),r([l.property({type:[p],json:{write:!0}})],t.prototype,"fields",void 0),r([l.property({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:h.read}}})],t.prototype,"geometryType",void 0),r([l.writer("geometryType")],t.prototype,"writeGeometryType",null),r([l.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasM",void 0),r([l.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasZ",void 0),r([l.property({types:i.geometryTypes,json:{read:d.fromJSON,write:!0}})],t.prototype,"queryGeometry",void 0),r([l.property({type:u,json:{write:!0}})],t.prototype,"spatialReference",void 0),r([l.writer("spatialReference")],t.prototype,"writeSpatialReference",null),r([l.property({json:{write:!0}})],t.prototype,"transform",void 0),r([l.subclass("esri.tasks.support.FeatureSet")],t)}(l.declared(a));return c.prototype.toJSON.isDefaultToJSON=!0,c||(c={}),c}.apply(null,n))||(e.exports=i)},1471:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(9),r(356),r(355),r(362),r(1543),r(4),r(262),r(34),r(1530),r(1588),r(1650),r(50),r.dj.m(e)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p,h,c,f,g){Object.defineProperty(t,"__esModule",{value:!0});var y=function(){function e(){}return e.prototype._process=function(e){var t=this._transform(e);return n.resolve({result:t,transferList:[t.points.buffer,t.rgb.buffer]})},e.prototype._transform=function(e){var t=this.readGeometry(e.schema,e.geometryBuffer),r=t.length/3,n=c.evaluateRenderer(e.rendererInfo,e.primaryAttribute,e.modulationAttribute,t,r);e.filterInfo&&e.filterInfo.length>0&&(r=c.filterInPlace(t,n,e.filterInfo,e.filterAttributes)),3*r<n.length&&(n=new Uint8Array(n.buffer.slice(0,3*r))),this._applyElevationOffsetInPlace(t,r,e.elevationOffset);var i=this._transformCoordinates(t,r,e.obb,d.fromJSON(e.inSR),d.fromJSON(e.outSR));return{obb:e.obb,points:i,rgb:n}},e.prototype.readGeometry=function(e,t){if(null==e.encoding||""===e.encoding){for(var r=p.createGeometryDataIndex(t,e,!1),n=p.createTypedView(t,r.vertexAttributes.position),i=r.header.fields,o=[i.offsetX,i.offsetY,i.offsetZ],a=[i.scaleX,i.scaleY,i.scaleZ],s=n.length/3,l=new Float64Array(3*s),u=0;u<s;u++)l[3*u]=n[3*u]*a[0]+o[0],l[3*u+1]=n[3*u+1]*a[1]+o[1],l[3*u+2]=n[3*u+2]*a[2]+o[2];return l}if("lepcc-xyz"===e.encoding)return h.decodeXYZ(t).result},e.prototype._transformCoordinates=function(e,t,r,n,i){if(!f.bufferToBuffer(e,n,0,e,i,0,t))throw Error("Can't reproject");var o=u.vec3f32.fromValues(r.center[0],r.center[1],r.center[2]),s=u.vec3f32.create(),d=u.vec3f32.create();a.quat.conjugate(v,r.quaternion);for(var p=new Float32Array(3*t),h=0;h<t;h++)s[0]=e[3*h]-o[0],s[1]=e[3*h+1]-o[1],s[2]=e[3*h+2]-o[2],l.vec3.transformQuat(d,s,v),r.halfSize[0]=Math.max(r.halfSize[0],Math.abs(d[0])),r.halfSize[1]=Math.max(r.halfSize[1],Math.abs(d[1])),r.halfSize[2]=Math.max(r.halfSize[2],Math.abs(d[2])),p[3*h]=s[0],p[3*h+1]=s[1],p[3*h+2]=s[2];return p},e.prototype._applyElevationOffsetInPlace=function(e,t,r){if(0!==r)for(var n=0;n<t;n++)e[3*n+2]+=r},e}(),v=s.quatf32.create(),m=function(t){function a(){var r=t.call(this)||this;return r._thread=void 0,o.open(i.getAbsMid("./PointCloudWorker",e,g)).then(function(e){void 0===r._thread?r._thread=e:e.close()}),r}return r(a,t),a.prototype.destroy=function(){this._thread&&this._thread.close(),this._thread=null},a.prototype.transform=function(e,t){return this._thread?this._thread.invoke("_process",e,{transferList:t}):n.resolve(this._transform(e))},a}(y);t.PointCloudWorker=m,t.default=function(){return new y}}.apply(null,n))||(e.exports=i)},1509:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(98),r(13),r(10),r(9),r(65),r(89),r(34),r(96),r(44),r(551)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p){function h(e){return"polygon"===e.type}function c(e){return"polygon"===e[0].type}function f(e){return"polyline"===e[0].type}function g(e){return h(e)?e.rings:e.paths}function y(e,t){return Math.ceil((e-t)/(2*t))}function v(e,t){for(var r=0,n=g(e);r<n.length;r++)for(var i=0,o=n[r];i<o.length;i++){o[i][0]+=t}return e}function m(e){for(var t=[],r=0,n=0,i=0;i<e.length;i++){for(var o=e[i],a=null,s=0;s<o.length;s++)a=o[s],t.push(a),0===s?n=r=a[0]:(r=Math.min(r,a[0]),n=Math.max(n,a[0]));a&&t.push([(r+n)/2,0])}return t}function _(e,t){if(!(e instanceof s||e instanceof a)){var r="straightLineDensify: the input geometry is neither polyline nor polygon";throw R.error(r),new n(r)}for(var i=[],o=0,l=g(e);o<l.length;o++){var u=l[o],d=[];i.push(d),d.push([u[0][0],u[0][1]]);for(var p=0;p<u.length-1;p++){var c=u[p][0],f=u[p][1],y=u[p+1][0],v=u[p+1][1],m=Math.sqrt((y-c)*(y-c)+(v-f)*(v-f)),_=(v-f)/m,b=(y-c)/m,x=m/t;if(x>1){for(var S=1;S<=x-1;S++){var w=S*t,P=b*w+c,N=_*w+f;d.push([P,N])}var z=(m+Math.floor(x-1)*t)/2,I=b*z+c,M=_*z+f;d.push([I,M])}d.push([y,v])}}return h(e)?new a({rings:i,spatialReference:e.spatialReference}):new s({paths:i,spatialReference:e.spatialReference})}function b(e,t,r){if(t){var n=_(e,1e6);e=d.webMercatorToGeographic(n,!0)}return r&&(e=v(e,r)),e}function x(e,t,r){var n;if(Array.isArray(e)){if((n=e[0])>t){var i=y(n,t);e[0]=n+i*(-2*t)}else if(n<r){i=y(n,r);e[0]=n+i*(-2*r)}}else if((n=e.x)>t){i=y(n,t);e=e.clone().offset(i*(-2*t),0)}else if(n<r){i=y(n,r);e=e.clone().offset(i*(-2*r),0)}return e}function S(e,t){for(var r=-1,n=0;n<t.cutIndexes.length;n++)!function(n){for(var i=t.cutIndexes[n],o=t.geometries[n],a=g(o),s=0;s<a.length;s++)!function(e){var t=a[e];t.some(function(r){if(r[0]<180)return!0;for(var n=0,i=0;i<t.length;i++){var a=t[i][0];n=a>n?a:n}for(var s=-360*y(n=Number(n.toFixed(9)),180),l=0;l<t.length;l++){var u=o.getPoint(e,l);o.setPoint(e,l,u.clone().offset(s,0))}return!0})}(s);if(i===r){if(c(e))for(var l=0,u=g(o);l<u.length;l++){var d=u[l];e[i]=e[i].addRing(d)}else if(f(e))for(var p=0,h=g(o);p<h.length;p++){var v=h[p];e[i]=e[i].addPath(v)}}else r=i,e[i]=o}(n);return e}function w(){return P||(P=new p({url:r.geometryServiceUrl})),P}Object.defineProperty(t,"__esModule",{value:!0});var P,R=i.getLogger("esri.geometry.support.normalizeUtils"),N={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new s({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:l.WebMercator}),minus180Line:new s({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:l.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new s({paths:[[[180,-180],[180,180]]],spatialReference:l.WebMercator}),minus180Line:new s({paths:[[[-180,-180],[-180,180]]],spatialReference:l.WebMercator})}};t.straightLineDensify=_,t.normalizeCentralMeridian=function e(t,r,n){if(!Array.isArray(t))return e([t],r);r||(r=w());for(var i,l,p,h,c,f,g,m,_=0,P=[],R=[],z=0,I=t;z<I.length;z++){var M=I[z];if(M)if(i||(i=M.spatialReference,l=u.getInfo(i),p=i.isWebMercator,h=N[f=p?102100:4326].maxX,c=N[f].minX,g=N[f].plus180Line,m=N[f].minus180Line),l)if("mesh"===M.type)R.push(M);else if("point"===M.type)R.push(x(M.clone(),h,c));else if("multipoint"===M.type){var O=M.clone();O.points=O.points.map(function(e){return x(e,h,c)}),R.push(O)}else if("extent"===M.type){var C=(k=M.clone())._normalize(!1,!1,l);R.push(C.rings?new a(C):C)}else if(M.extent){var k,V=y((k=M.extent).xmin,c)*(2*h),j=0===V?M.clone():v(M.clone(),V);k.offset(V,0),k.intersects(g)&&k.xmax!==h?(_=k.xmax>_?k.xmax:_,j=b(j,p),P.push(j),R.push("cut")):k.intersects(m)&&k.xmin!==c?(_=k.xmax*(2*h)>_?k.xmax*(2*h):_,j=b(j,p,360),P.push(j),R.push("cut")):R.push(j)}else R.push(M.clone());else R.push(M);else R.push(M)}for(var A=y(_,h),F=-90,U=A,W=new s;A>0;){var L=360*A-180;W.addPath([[L,F],[L,-1*F]]),F*=-1,A--}if(P.length>0&&U>0)return r.cut(P,W,n).then(function(e){return S(P,e)}).then(function(e){for(var i=[],o=[],a=0;a<R.length;a++){var s=R[a];if("cut"!==s)o.push(s);else{var l=e.shift(),u=t[a];"polygon"===u.type&&u.rings&&u.rings.length>1&&l.rings.length>=u.rings.length?(i.push(l),o.push("simplify")):o.push(p?d.geographicToWebMercator(l):l)}}return i.length?r.simplify(i,n).then(function(e){for(var t=[],r=0;r<o.length;r++){var n=o[r];"simplify"!==n?t.push(n):t.push(p?d.geographicToWebMercator(e.shift()):e.shift())}return t}):o});for(var E=[],T=0;T<R.length;T++){var Q=R[T];if("cut"!==Q)E.push(Q);else{var B=P.shift();E.push(!0===p?d.geographicToWebMercator(B):B)}}return o.resolve(E)},t.getDenormalizedExtent=function(e){var t;if(!e)return null;var r=e.extent;if(!r)return null;var n=e.spatialReference&&u.getInfo(e.spatialReference);if(!n)return r;var i,o=n.valid,a=o[0],s=o[1],l=2*s,d=r.width,p=r.xmin,h=r.xmax;if(p=(t=[h,p])[0],h=t[1],"extent"===e.type||0===d||d<=s||d>l||p<a||h>s)return r;switch(e.type){case"polygon":if(!(e.rings.length>1))return r;i=m(e.rings);break;case"polyline":if(!(e.paths.length>1))return r;i=m(e.paths);break;case"multipoint":i=e.points}for(var c=r.clone(),f=0;f<i.length;f++){var g=i[f][0];g<0?(g+=s,h=Math.max(g,h)):(g-=s,p=Math.min(g,p))}return c.xmin=p,c.xmax=h,c.width<d?(c.xmin-=s,c.xmax-=s,c):r},t.normalizeMapX=function(e,t){var r=u.getInfo(t);if(r){var n=r.valid,i=n[0],o=n[1],a=o-i;if(e<i)for(;e<i;)e+=a;if(e>o)for(;e>o;)e-=a}return e}}.apply(null,n))||(e.exports=i)},1559:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(8),r(7),r(0)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.attachmentTypes=null,r.globalIds=null,r.num=null,r.objectIds=null,r.returnMetadata=!1,r.size=null,r.start=null,r.where=null,r}var i;return r(t,e),i=t,t.prototype.writeStart=function(e,t,r){t.resultOffset=this.start,t.resultRecordCount=this.num||10},t.prototype.clone=function(){return new i(o.clone({attachmentTypes:this.attachmentTypes,where:this.where,globalIds:this.globalIds,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))},n([a.property({type:[String],json:{write:!0}})],t.prototype,"attachmentTypes",void 0),n([a.property({type:[Number],json:{write:!0}})],t.prototype,"globalIds",void 0),n([a.property({type:Number,json:{read:{source:"resultRecordCount"}}})],t.prototype,"num",void 0),n([a.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),n([a.property({type:Boolean,json:{default:!1,write:!0}})],t.prototype,"returnMetadata",void 0),n([a.property({type:[Number],json:{write:!0}})],t.prototype,"size",void 0),n([a.property({type:Number,json:{read:{source:"resultOffset"}}})],t.prototype,"start",void 0),n([a.writer("start"),a.writer("num")],t.prototype,"writeStart",null),n([a.property({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],t.prototype,"where",void 0),i=n([a.subclass("esri.tasks.support.AttachmentQuery")],t)}(a.declared(i))}.apply(null,n))||(e.exports=i)},1586:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(43),r(8),r(7),r(0)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.gdbVersion=null,r.geometryPrecision=void 0,r.historicMoment=null,r.maxAllowableOffset=void 0,r.objectIds=null,r.outFields=null,r.outSpatialReference=null,r.relationshipId=void 0,r.returnGeometry=!1,r.source=null,r.where=null,r}var o;return r(t,e),o=t,t.prototype._writeHistoricMoment=function(e,t){t.historicMoment=e&&e.getTime()},t.prototype.clone=function(){return new o(a.clone({gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&this.historicMoment.getTime(),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,source:this.source,where:this.where}))},n([s.property({type:String,json:{write:!0}})],t.prototype,"gdbVersion",void 0),n([s.property({type:Number,json:{write:!0}})],t.prototype,"geometryPrecision",void 0),n([s.property({type:Date})],t.prototype,"historicMoment",void 0),n([s.writer("historicMoment")],t.prototype,"_writeHistoricMoment",null),n([s.property({type:Number,json:{write:!0}})],t.prototype,"maxAllowableOffset",void 0),n([s.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),n([s.property({type:[String],json:{write:!0}})],t.prototype,"outFields",void 0),n([s.property({type:i.SpatialReference,json:{read:{source:"outSR"},write:{target:"outSR"}}})],t.prototype,"outSpatialReference",void 0),n([s.property({json:{write:!0}})],t.prototype,"relationshipId",void 0),n([s.property({json:{write:!0}})],t.prototype,"returnGeometry",void 0),n([s.property({json:{write:!0}})],t.prototype,"source",void 0),n([s.property({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],t.prototype,"where",void 0),o=n([s.subclass("esri.tasks.support.RelationshipQuery")],t)}(s.declared(o))}.apply(null,n))||(e.exports=i)},1650:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1626),r(1629),r(1630),r(1530)],void 0===(i=function(e,t,r,n,i,o){function a(e){for(var t=0,r=0,n=e||[];r<n.length;r++)t|=1<<n[r];return t}function s(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.name===t&&null!=i.attributeValues&&"UInt8"===i.attributeValues.valueType&&3===i.attributeValues.valuesPerElement)return{storageInfo:i,useElevation:!1}}return null}function l(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.name===t){var o="embedded-elevation"===i.encoding;return{storageInfo:o?null:i,useElevation:o}}}return"elevation"===t.toLowerCase()?{storageInfo:null,useElevation:!0}:null}function u(e,t,r,n){if(e&&e.useElevation){for(var i=new Float64Array(n),a=0;a<n;a++)i[a]=r[3*a+2];return i}return e&&t?o.readBinaryAttribute(e.storageInfo,t,n):null}function d(e){return null==e||"none"===e?null:"low-four-bit"===e?function(e){return 15&e}:"high-four-bit"===e?function(e){return(240&e)>>4}:"absolute-value"===e?function(e){return Math.abs(e)}:"modulo-ten"===e?function(e){return e%10}:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getRendererInfo=function(e){var t=e.renderer,r=t&&t.type,n=t&&e.renderer.toJSON()||null,i=null,o=!1;"point-cloud-unique-value"===r?i=l(e.attributeStorageInfo,t.field):"point-cloud-stretch"===r?i=l(e.attributeStorageInfo,t.field):"point-cloud-class-breaks"===r?i=l(e.attributeStorageInfo,t.field):o="point-cloud-rgb"===r?null!=(i=s(e.attributeStorageInfo,t.field)):null!=(i=s(e.attributeStorageInfo,"RGB"));var a=null;return t&&t.colorModulation&&(a=l(e.attributeStorageInfo,t.colorModulation.field)),{rendererJSON:n,isRGBRenderer:o,primaryAttribute:i,modulationAttribute:a}},t.getFilterInfo=function(e){var t=e.filters;return t?t.map(function(t){return{filterJSON:t.toJSON(),attributeInfo:l(e.attributeStorageInfo,t.field)}}):[]},t.evaluateRenderer=function(e,t,o,a,s){var l=e.rendererJSON,p=e.isRGBRenderer,h=e.primaryAttribute,c=e.modulationAttribute,f=u(h,t,a,s),g=u(c,o,a,s),y=null,v=null;if(f&&p)y=f;else if(f&&"pointCloudUniqueValueRenderer"===l.type){var m=(v=i.fromJSON(l)).colorUniqueValueInfos;y=new Uint8Array(3*s);for(var _=d(v.fieldTransformType),b=0;b<s;b++)for(var x=(P=_?_(f[b]):f[b])+"",S=0;S<m.length;S++)if(m[S].values.indexOf(x)>=0){y[3*b]=m[S].color.r,y[3*b+1]=m[S].color.g,y[3*b+2]=m[S].color.b;break}}else if(f&&"pointCloudStretchRenderer"===l.type){var w=(v=n.fromJSON(l)).stops;for(y=new Uint8Array(3*s),_=d(v.fieldTransformType),b=0;b<s;b++){var P=_?_(f[b]):f[b],R=w.length-1;if(P<w[0].value)y[3*b]=w[0].color.r,y[3*b+1]=w[0].color.g,y[3*b+2]=w[0].color.b;else if(P>=w[R].value)y[3*b]=w[R].color.r,y[3*b+1]=w[R].color.g,y[3*b+2]=w[R].color.b;else for(S=1;S<w.length;S++)if(P<w[S].value){var N=(P-w[S-1].value)/(w[S].value-w[S-1].value);y[3*b]=w[S].color.r*N+w[S-1].color.r*(1-N),y[3*b+1]=w[S].color.g*N+w[S-1].color.g*(1-N),y[3*b+2]=w[S].color.b*N+w[S-1].color.b*(1-N);break}}}else if(f&&"pointCloudClassBreaksRenderer"===l.type){var z=(v=r.fromJSON(l)).colorClassBreakInfos;for(y=new Uint8Array(3*s),_=d(v.fieldTransformType),b=0;b<s;b++)for(P=_?_(f[b]):f[b],S=0;S<z.length;S++)if(P>=z[S].minValue&&P<=z[S].maxValue){y[3*b]=z[S].color.r,y[3*b+1]=z[S].color.g,y[3*b+2]=z[S].color.b;break}}else for(y=new Uint8Array(3*s),b=0;b<y.length;b++)y[b]=255;if(g&&v&&v.colorModulation){var I=v.colorModulation.minValue,M=v.colorModulation.maxValue;for(b=0;b<s;b++){var O=(P=g[b])>=M?1:P<=I?.3:.3+.7*(P-I)/(M-I);y[3*b]=O*y[3*b],y[3*b+1]=O*y[3*b+1],y[3*b+2]=O*y[3*b+2]}}return y},t.filterInPlace=function(e,t,r,n){for(var i=e.length/3,o=n.map(function(t,n){return u(r[n].attributeInfo,t,e,i)}),s=0,l=0;l<i;l++){for(var d=!0,p=0;p<r.length&&d;p++){var h=r[p].filterJSON,c=o[p][l];switch(h.type){case"pointCloudValueFilter":var f="exclude"===h.mode;-1!==h.values.indexOf(c)===f&&(d=!1);break;case"pointCloudBitfieldFilter":var g=a(h.requiredSetBits),y=a(h.requiredClearBits);(c&g)===g&&0==(c&y)||(d=!1);break;case"pointCloudReturnFilter":for(var v=15&c,m=c>>>4&15,_=m>1,b=1===v,x=v===m,S=!1,w=0,P=h.includedReturns;w<P.length;w++){var R=P[w];if("last"===R&&x||"firstOfMany"===R&&b&&_||"lastOfMany"===R&&x&&_||"single"===R&&!_){S=!0;break}}S||(d=!1)}}d&&(e[3*s]=e[3*l],e[3*s+1]=e[3*l+1],e[3*s+2]=e[3*l+2],t[3*s]=t[3*l],t[3*s+1]=t[3*l+1],t[3*s+2]=t[3*l+2],s++)}return s},t.getSplatSizeAlgorithm=function(e){var t=e&&e.pointSizeAlgorithm;return t&&"splat"===t.type?t:null},t.getFixedSizeAlgorithm=function(e){var t=e&&e.pointSizeAlgorithm;return t&&"fixed-size"===t.type?t:null},t.rendererUsesFixedSizes=function(e){var t=e&&e.pointSizeAlgorithm;return!(!t||!t.type)&&"fixed-size"===t.type}}.apply(null,n))||(e.exports=i)},2264:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(53),r(51),r(51),r(10),r(9),r(14),r(82),r(21),r(0),r(4),r(262),r(45),r(1591),r(379),r(1507),r(1471),r(1516),r(2265),r(2266),r(1650),r(2267),r(1514),r(29),r(1523),r(50)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p,h,c,f,g,y,v,m,_,b,x,S,w,P,R,N,z,I){var M=s.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),O=N.plane.create();return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.maximumPointCount=4e6,t.slicePlaneEnabled=!1,t._renderer=null,t._rendererAdded=!1,t._renderedNodes=new Set,t._updateViewNeeded=!0,t._lodFactor=1,t._worker=new _.PointCloudWorker,t._maxLoggedBoxWarnings=5,t._pageMultiplier=1,t._indexQueue=[],t._workQueue=[],t._idleQueue=new y.PromiseQueue,t._indexPagesLoading=new Map,t._loadingNodes=new Map,t._layerIsVisible=!1,t._totalWork=0,t._index=null,t._loadingInitNodePage=!1,t._nodeIdArray=[],t}return r(t,e),Object.defineProperty(t.prototype,"pointScale",{get:function(){var e=w.getSplatSizeAlgorithm(this.layer.renderer);return e&&null!=e.scaleFactor?e.scaleFactor:1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useRealWorldSymbolSizes",{get:function(){var e=w.getFixedSizeAlgorithm(this.layer.renderer);return!(!e||null==e.useRealWorldSymbolSizes)&&e.useRealWorldSymbolSizes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointSize",{get:function(){var e=w.getFixedSizeAlgorithm(this.layer.renderer);return e&&null!=e.size?e.size:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inverseDensity",{get:function(){return this.layer.renderer?96/this.layer.renderer.pointsPerInch:5},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_clippingBox",{get:function(){var e=g.create(),t=this.view.renderSpatialReference;return I.extentToBoundingBox(this.view.clippingArea,e,t)?e:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_elevationOffset",{get:function(){var e=this.layer.elevationInfo;if(e&&"absolute-height"===e.mode){var t=d.getMetersPerVerticalUnitForSR(this.layer.spatialReference),r=v.getMetersPerUnit(e.unit);return(e.offset||0)*r/t}return 0},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;b.checkPointCloudLayerValid(this.layer),b.checkPointCloudLayerCompatibleWithView(this.layer,this.view),this._initRenderer();var t=this._initNodePages(),r=this.view.resourceController.memoryController;this._memCache=r.getMemCache(this.layer.uid),this.handles.add(p.init(this,"_clippingBox",function(){return e._setUpdateViewNeeded()})),this.handles.add(p.init(this,"_elevationOffset",function(){return e._elevationOffsetChanged()})),this.handles.add(p.init(this.layer,"renderer",function(){return e._rendererChanged()})),this.handles.add(p.init(this.layer,"filters",function(){return e._filterChanged()})),this.handles.add(p.init(this,"clippingArea",function(){e._setUpdateViewNeeded()})),this.handles.add(this.view.state.watch("camera",function(){return e._setUpdateViewNeeded()})),r.events.on("quality-changed",function(){return e._setUpdateViewNeeded()}),this.addResolvingPromise(t);var n=this.view.resourceController.scheduler;this.when(function(){e.handles.add([n.registerTask(2,function(t){return e._process(t)},function(){return e._needsUpdate()}),n.registerIdleStateCallbacks(function(){return e._idleBegin()},function(){return e._idleEnd()}),p.init(e,"suspended",function(t){t?e._clearNodeState():e._setUpdateViewNeeded()})])})},t.prototype._setUpdateViewNeeded=function(){this._updateViewNeeded=!0,this._updateLoading()},t.prototype.destroy=function(){this._cancelNodeLoading(),this._worker.destroy(),this._worker=null,this._destroyRenderer(),this._memCache.destroy(),this._memCache=null},t.prototype._initRenderer=function(){var e=this;this._renderer=new P,this._renderer.layerUid=this.layer.uid,this.handles.add(p.init(this,"_clippingBox",function(t){return e._renderer.clippingBox=t})),this.handles.add(p.init(this,"suspended",function(t){return e._setPointsVisible(!t)})),this.handles.add(p.init(this,"pointScale",function(t){return e._renderer.scaleFactor=t})),this._renderer.minSizePx=Math.sqrt(2),this.handles.add(p.init(this,"useRealWorldSymbolSizes",function(t){return e._renderer.useRealWorldSymbolSizes=t})),this.handles.add(p.init(this,"pointSize",function(t){var r=u.pt2px(t);e._renderer.size=t,e._renderer.sizePx=r})),this.handles.add(p.init(this,"slicePlaneEnabled",function(t){return e._renderer.slicePlaneEnabled=t})),this.handles.add(p.init(this,["inverseDensity","maximumPointCount"],function(){return e._setUpdateViewNeeded()})),this.handles.add(p.init(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",function(t){e._lodFactor=t,e._setUpdateViewNeeded()}))},t.prototype._destroyRenderer=function(){this._renderer.removeAll(),this._setPointsVisible(!1)},t.prototype._setPointsVisible=function(e){e&&!this._rendererAdded?(this.view._stage.addRenderPlugin([5],this._renderer),this._rendererAdded=!0):!e&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)},t.prototype._rendererChanged=function(){this._clearNodeState(),this._memCache.clear(),this._renderer.useFixedSizes=w.rendererUsesFixedSizes(this.layer.renderer),this._setUpdateViewNeeded()},t.prototype._filterChanged=function(){this._clearNodeState(),this._memCache.clear(),this._setUpdateViewNeeded()},t.prototype._elevationOffsetChanged=function(){this._clearNodeState(),this._memCache.clear(),this._initNodePages()},t.prototype.displayNodes=function(e){this._workQueue=x.nodeDiff(o.keysOfSet(this._renderedNodes),e,this._index),x.sortFrontToBack(this._workQueue,this.view.state.camera.viewForward,this._index),x.splitWorkEntries(this._workQueue,8,this._index),this._updateQueues(),this._totalWork=this._computeWork(),this._updateLoading(),this._layerIsVisible=e.length>0||this._loadingInitNodePage,this.notifyChange("suspended")},t.prototype.cancelLoading=function(){this._cancelNodeLoading(),this._cancelIndexLoading()},t.prototype._cancelNodeLoading=function(){var e=[];this._loadingNodes.forEach(function(t){return e.push(t)}),this._loadingNodes.clear();for(var t=0,r=e;t<r.length;t++)r[t].cancel();this._workQueue=[],this._idleQueue.cancelAll(),this._totalWork=this._computeWork(),this._updateLoading()},t.prototype._updateQueues=function(){var e=this,t=new Set;this._workQueue.forEach(function(e){e.load.forEach(function(e){t.add(e)})});var r=[],n=new Map;this._loadingNodes.forEach(function(e,i){t.has(i)?n.set(i,e):r.push(e)}),this._loadingNodes=n;for(var i=0,o=r;i<o.length;i++)o[i].cancel();this._workQueue=this._workQueue.filter(function(t){for(var r=0,n=t.load;r<n.length;r++){var i=n[r];if(e._loadingNodes.has(i))return!1}return!0}),this._totalWork=this._computeWork(),this._updateLoading()},t.prototype._cancelIndexLoading=function(){this._indexQueue=[],this._indexPagesLoading.forEach(function(e){return e.cancel()}),this._indexPagesLoading.clear(),this._totalWork=this._computeWork(),this._updateLoading()},t.prototype._clearNodeState=function(){var e=this;this._renderedNodes.forEach(function(t){return e._removeFromRenderer(t)}),this._cancelNodeLoading()},t.prototype._idleBegin=function(){this._setUpdateViewNeeded()},t.prototype._idleEnd=function(){this._setUpdateViewNeeded()},t.prototype._needsUpdate=function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||this._indexQueue.length>0||this._workQueue.length>0||this._idleQueue.length>0},t.prototype._process=function(e){var t=this;if(this.suspended){if(this._updateViewNeeded){this._updateViewNeeded=!1;var r=this._isRootNodeVisible();r!==this._layerIsVisible&&(this._layerIsVisible=r,this.notifyChange("suspended"))}}else{for(e.run(function(){return t._updateWorkQueues()});this._indexQueue.length>0&&e.run(function(){return t._processIndexQueue()}););for(this._processWorkQueue(e);this._idleQueue.length>0&&e.run(function(){return t._idleQueue.process()}););}},t.prototype._processIndexQueue=function(){var e=this,t=this._indexQueue.shift();return this._indexPagesLoading.set(t,this._loadNodePage(t)),this._indexPagesLoading.get(t).then(function(r){e._index.addPage(t,r,e._elevationOffset),e._setUpdateViewNeeded()}).then(function(){e._indexPagesLoading.delete(t)},function(){e._indexPagesLoading.delete(t)}),!0},t.prototype._processWorkQueue=function(e){for(;!e.done;){var t=this._scheduleWorkEntry();if(!t)return;this._processWorkEntry(t),e.madeProgress()}},t.prototype._scheduleWorkEntry=function(){var e=this;if(this._loadingNodes.size>=8)return null;for(var t=0;t<this._workQueue.length;++t){var r=this._workQueue[t];if(!a.find(r.remove,function(t){return!e._renderedNodes.has(t)})){for(var n=t;n>0;--n)this._workQueue[n]=this._workQueue[n-1];return this._workQueue.shift(),r}}return null},t.prototype._processWorkEntry=function(e){var t=this;if(0!==e.load.length)l.all(e.load.map(function(e){var r=t._memCache.pop(e.toString());return r?t._loadingNodes.set(e,l.resolve(r)):t._loadingNodes.has(e)||t._loadingNodes.set(e,t.loadNode(e)),t._loadingNodes.get(e)})).then(function(r){for(var n=0;n<e.load.length;n++)if(r[n]){var i=t._setupRendererData(e.load[n],r[n]);t._addToRenderer(i)}for(n=0;n<e.remove.length;n++)t._removeFromRenderer(e.remove[n])}).catch(function(){}).then(function(){for(var r=0;r<e.load.length;r++)t._loadingNodes.delete(e.load[r]);t._updateLoading()}),this._updateLoading();else for(var r=0;r<e.remove.length;r++)this._removeFromRenderer(e.remove[r])},t.prototype._computeWork=function(){for(var e=0,t=0;t<this._workQueue.length;t++)e+=this._workQueue[t].load.length;return e+=this._loadingNodes.size,e+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize,(e+=this._loadingInitNodePage?100:0)+(this._updateViewNeeded?100:0)},Object.defineProperty(t.prototype,"updatingPercentageValue",{get:function(){var e=this._computeWork();return 100*Math.min(this._totalWork,e)/this._totalWork},enumerable:!0,configurable:!0}),t.prototype._updateLoading=function(){this.notifyChange("updating"),this.notifyChange("updatingPercentageValue")},t.prototype.canResume=function(){return this.inherited(arguments)&&this._layerIsVisible},t.prototype.isUpdating=function(){return this._computeWork()>0},t.prototype._initNodePages=function(){var e=this,t=this.layer.store.index,r=t.nodesPerPage||t.nodePerIndexBlock;return this._index=new S(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,r),this._cancelIndexLoading(),this._traverseVisible=this._index.createVisibilityTraverse(),this._loadingInitNodePage=!0,this._layerIsVisible=!0,this.notifyChange("suspended"),this._updateLoading(),this._pageMultiplier=null!=t.nodesPerPage?1:t.nodePerIndexBlock,this._loadNodePage(0).then(function(t){e._index.addPage(0,t,e._elevationOffset),e._loadingInitNodePage=!1,e._setUpdateViewNeeded()})},t.prototype._loadNodePage=function(e){var t=this,r=this.baseUrl+"/nodepages/"+e*this._pageMultiplier;return this._requestJSON(r).then(function(r){return r.data.nodes.map(function(r,n){return{resourceId:null!=r.resourceId?r.resourceId:e*t._index.pageSize+n,obb:r.obb,firstChild:r.firstChild,childCount:r.childCount,vertexCount:null!=r.vertexCount?r.vertexCount:r.pointCount,lodThreshold:null!=r.lodThreshold?r.lodThreshold:r.effectiveArea}})})},t.prototype._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;for(var e=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor(),t=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor(),r=this._computeNodesForMinimumDensity(e),n=this._computePointCount(r),i=Math.sqrt(n/(.75*t));n>t;)e*=i,r=this._computeNodesForMinimumDensity(e),n=this._computePointCount(r),i=Math.sqrt(2);return this.displayNodes(r),this._updateViewNeeded=!1,this._updateLoading(),!0},t.prototype._computePointCount=function(e){for(var t=0,r=0;r<e.length;r++){var n=this._index.getNode(e[r]);n&&(t+=n.vertexCount)}return t},t.prototype._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor},t.prototype._isRootNodeVisible=function(){var e=!1;return this._traverseVisible({frustumPlanes:this.view.state.camera.frustum.planes,clippingBox:this._clippingBox},{predicate:function(t,r,n){return e=n,!1},pageMiss:function(e,t){}}),e},t.prototype._computeNodesForMinimumDensity=function(e){var t=this,r=this.view.state.camera,n=r.frustum,i=this._clippingBox,o=r.viewForward,a=c.vec3.dot(o,r.eye),s=N.plane.fromNormalAndOffset(o,-a,O),l=r.perScreenPixelRatio/2,u=e*e,d=this._nodeIdArray;return d.length=0,this._traverseVisible({frustumPlanes:n.planes,clippingBox:i},{predicate:function(e,r,n){if(!n)return!1;if(0===r.childCount)return d.push(e),!1;var i=t._index.getRenderObb(e);return!(t._computeAveragePixelArea(i,r.lodThreshold,r.vertexCount,s,l)<=u&&(d.push(e),1))},pageMiss:function(e,r){d.push(e),t._indexQueue.indexOf(r)<0&&t._indexQueue.push(r)}}),d},t.prototype._computeAveragePixelArea=function(e,t,r,n,i){var o=Math.max(1e-7,z.minimumDistancePlane(e,n));return t/(o*o)/(4*i*i)/r},t.prototype.loadNode=function(e){var t=this,r=this._index.getNode(e),n=w.getRendererInfo(this.layer),i=w.getFilterInfo(this.layer),o=r.resourceId,a=[],s=function(e){var r=t.loadAttribute(o,e);return a.push(r),r};return this._idleQueue.push().then(function(){var e=t.loadGeometry(o);a.push(e);var r=s(n.primaryAttribute),u=s(n.modulationAttribute),d=i.map(function(e){return s(e.attributeInfo)});return l.all([e,r,u,l.all(d)])}).then(function(r){var o=r[0],a=r[1],s=r[2],l=r[3],u=[o];a&&u.push(a),s&&u.push(s);for(var d=0,p=l;d<p.length;d++){var h=p[d];u.push(h)}var c={geometryBuffer:o,primaryAttribute:a,modulationAttribute:s,filterAttributes:l,schema:t.layer.store.defaultGeometrySchema,rendererInfo:n,filterInfo:i,obb:t._index.getRenderObb(e),elevationOffset:t._elevationOffset,inSR:t.layer.spatialReference.toJSON(),outSR:t.view.renderCoordsHelper.spatialReference.toJSON()};return t._worker.transform(c,u)}).catch(function(e){if(null==e||"CancelError"!==e.name&&"AbortError"!==e.name)M.error(e);else for(var t=0,r=a;t<r.length;t++){r[t].cancel()}return l.reject(e)})},t.prototype.loadGeometry=function(e){var t=this.baseUrl+"/nodes/"+e+"/geometries/0";return this._requestBinary(t).then(function(e){return e.data})},t.prototype.loadAttribute=function(e,t){if(!t||!t.storageInfo)return l.resolve(null);var r=t.storageInfo.key,n=this.baseUrl+"/nodes/"+e+"/attributes/"+r;return this._requestBinary(n).then(function(e){return e.data})},t.prototype._requestJSON=function(e){return i(e,{query:{f:"json"},responseType:"json"})},t.prototype._requestBinary=function(e){return i(e,{responseType:"array-buffer"})},t.prototype._removeFromRenderer=function(e){if(this._renderedNodes.has(e)){var t=this._renderer.removeNode(e);this._renderedNodes.delete(e),this._memCache.put(t.id.toString(),t,function(e){return 5*e.coordinates.length+128}(t))}},t.prototype._addToRenderer=function(e){this._renderedNodes.has(e.id)||(this._renderedNodes.add(e.id),this._renderer.addNode(e))},t.prototype._setupRendererData=function(e,t){var r=this._index.getNode(e),n=Math.sqrt(r.lodThreshold/r.vertexCount),i=this._index.getRenderObb(e);if(P.isInstanceOfNode(t))return t.splatSize=n,t.obb=i,t.origin=f.vec3f32.clone(t.obb.center),t;if(t.obb.halfSize[0]>i.halfSize[0]||t.obb.halfSize[1]>i.halfSize[1]||t.obb.halfSize[2]>i.halfSize[2]){if(this._maxLoggedBoxWarnings>0){var o=function(e){return"["+e.halfSize.join(", ")+"]"};M.warn("Node "+e+" reported bounding box too small. got "+o(i)+" but points cover "+o(t.obb)),0==--this._maxLoggedBoxWarnings&&M.warn("  Too many bounding box errors, stopping reporting for this layer.")}this._index.setRenderObb(e,t.obb)}return{id:e,coordinates:t.points,origin:f.vec3f32.clone(i.center),rgb:t.rgb,splatSize:n,obb:i,isLeaf:0===r.childCount}},t.prototype.getUsedMemory=function(){var e=this;return o.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+15*e._index.getNode(r).vertexCount+128},0)},t.prototype.getUnloadedMemory=function(){var e=this,t=this._renderedNodes.size;if(t<4)return 0;for(var r=o.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+e._index.getNode(r).vertexCount}),n=this._loadingNodes.size,i=0;i<this._workQueue.length;i++)n+=this._workQueue[i].load.length,n-=this._workQueue[i].remove.length;return n<0?0:n*r/t*15+128*n},t.prototype.ignoresMemoryFactor=function(){return!1},t.prototype.getStats=function(){var e=this;return{"Rendered Nodes":this._renderedNodes.size,"Rendered Points":o.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+e._index.getNode(r).vertexCount},0),"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}},n([h.property()],t.prototype,"layer",void 0),n([h.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],t.prototype,"baseUrl",void 0),n([h.property({readOnly:!0,dependsOn:["layer.renderer"]})],t.prototype,"pointScale",null),n([h.property({readOnly:!0,dependsOn:["layer.renderer"]})],t.prototype,"useRealWorldSymbolSizes",null),n([h.property({readOnly:!0,dependsOn:["layer.renderer"]})],t.prototype,"pointSize",null),n([h.property({readOnly:!0,dependsOn:["layer.renderer"]})],t.prototype,"inverseDensity",null),n([h.property()],t.prototype,"maximumPointCount",void 0),n([h.property({readOnly:!0,dependsOn:["view.clippingArea"]})],t.prototype,"_clippingBox",null),n([h.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],t.prototype,"_elevationOffset",null),n([h.property({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),n([h.property(R.updatingPercentage)],t.prototype,"updatingPercentage",void 0),n([h.property({readOnly:!0})],t.prototype,"updatingPercentageValue",null),n([h.subclass("esri.views.3d.layers.PointCloudLayerView3D")],t)}(h.declared(m))}.apply(null,n))||(e.exports=i)},2265:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(4)],void 0===(i=function(e,t,r){function n(e,t,r){for(var n=e;n>0;){var i=t.indexOf(n);if(i>=0)return i;n=r.getParentId(n)}return t.indexOf(n)}function i(e,t){for(var r=[e.remove[0]],n=[];1===r.length;){var i=r.pop();n.length=0;for(var o=0;o<e.load.length;o++){for(var a=e.load[o],s=t.getParentId(a);s!==i;)a=s,s=t.getParentId(a);var l=r.indexOf(a);l<0&&(l=r.length,r.push(a),n.push([])),n[l].push(e.load[o])}}var u=[];u.push({remove:e.remove,load:r});for(o=0;o<r.length;o++)n[o].length>1?u.push({remove:[r[o]],load:n[o]}):r[o]=n[o][0];return u}Object.defineProperty(t,"__esModule",{value:!0}),t.nodeDiff=function(e,t,r){for(var i=0;i<t.length;i++)s[i]=!1,l[i]=null;for(i=0;i<e.length;i++)o[i]=!1,a[i]=null;for(i=0;i<t.length;i++)(u=n(t[i],e,r))>=0&&(s[i]=!0,null!=a[u]?a[u].push(t[i]):a[u]=[t[i]]);for(i=0;i<e.length;i++){var u;(u=n(e[i],t,r))>=0&&(o[i]=!0,null!=l[u]?l[u].push(e[i]):l[u]=[e[i]])}var d=[];for(i=0;i<e.length;i++)null!=a[i]||o[i]||d.push({load:[],remove:[e[i]]});for(i=0;i<t.length;i++)null!=l[i]||s[i]||d.push({load:[t[i]],remove:[]});for(i=0;i<t.length;i++)null!=l[i]&&(l[i].length>1||l[i][0]!==t[i])&&d.push({load:[t[i]],remove:l[i]});for(i=0;i<e.length;i++)null!=a[i]&&(a[i].length>1||a[i][0]!==e[i])&&d.push({load:a[i],remove:[e[i]]});return d};var o=[!1],a=[null],s=[!1],l=[null];t.sortFrontToBack=function(e,t,n){return e.sort(function(e,i){if(0===e.load.length&&0===i.load.length)return 0;if(0===e.load.length)return-1;if(0===i.load.length)return 1;if(0===e.remove.length&&0===i.remove.length){var o=n.getRenderCenter(e.load[0]),a=n.getRenderCenter(i.load[0]);return r.vec3.dot(o,t)-r.vec3.dot(a,t)}return 0===e.remove.length?-1:0===i.remove.length?1:1===e.load.length&&1===i.load.length?(o=n.getRenderCenter(e.load[0]),a=n.getRenderCenter(i.load[0]),r.vec3.dot(o,t)-r.vec3.dot(a,t)):1===e.load.length?-1:1===i.load.length?1:(o=n.getRenderCenter(e.remove[0]),a=n.getRenderCenter(i.remove[0]),r.vec3.dot(o,t)-r.vec3.dot(a,t))})},t.splitWorkEntries=function(e,t,r){for(var n=0;n<e.length;++n){var o=e[n];if(o.load.length>t&&1===o.remove.length){var a=i(o,r);e[n]=a[0];for(var s=1;s<a.length;s++)e.push(a[s])}}},t.splitWorkEntry=i}.apply(null,n))||(e.exports=i)},2266:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(15),r(362),r(1543),r(4),r(3),r(45),r(1523),r(50)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u){function d(e,t,r,i){for(var a=new l.ObbArray(e.length),s=0;s<e.length;s++){var d=e[s].obb,p=a.obbs[s];if(l.set(d,p),o.vec3.set(c,d.center[0],d.center[1],d.center[2]+i),!t.isGeographic&&r===u.SphericalECEFSpatialReference){u.computeLinearTransformation(t,c,g,r);var h=2*Math.sqrt(1+g[0]+g[5]+g[10]);y[0]=(g[9]-g[6])/h,y[1]=(g[2]-g[8])/h,y[2]=(g[4]-g[1])/h,y[3]=.25*h,n.quat.conjugate(y,y),n.quat.multiply(p.quaternion,y,p.quaternion)}u.bufferToBuffer(c,t,0,p.center,r,0,1)}return a.obbs}function p(e,t){return e/t|0}function h(e,t){return e%t}var c=a.vec3f64.create(),f=function(){function e(e,t,r){this._pages=[],this.pageSize=0,this._nodeSR=null,this._renderSR=null,this._nodeSR=e,this._renderSR=t,this.pageSize=r}return e.prototype.addPage=function(e,t,r){for(void 0===r&&(r=0);this._pages.length<e;)this._pages.push(null);var n=d(t,this._nodeSR,this._renderSR,r);this._pages[e]={nodes:t,renderObbs:n,parents:new Uint32Array(this.pageSize)},function(e,t){for(var r=[0];r.length;)for(var n=r.pop(),i=e[p(n,t)].nodes[h(n,t)],o=0;o<i.childCount;o++){var a=i.firstChild+o;null!=e[p(a,t)]&&(e[p(a,t)].parents[h(a,t)]=n,r.push(a))}}(this._pages,this.pageSize)},e.prototype.hasPage=function(e){return!!this._pages[e]},e.prototype.getNode=function(e){var t=this.pageSize;return this._pages[p(e,t)].nodes[h(e,t)]},e.prototype.getRenderObb=function(e){var t=this.pageSize;return this._pages[p(e,t)].renderObbs[h(e,t)]},e.prototype.getRenderCenter=function(e){return this.getRenderObb(e).center},e.prototype.setRenderObb=function(e,t){var r=this.pageSize;l.set(t,this._pages[p(e,r)].renderObbs[h(e,r)])},e.prototype.getParentId=function(e){var t=this.pageSize;return this._pages[p(e,t)].parents[h(e,t)]},e.prototype.hasNodes=function(e,t){for(var r=p(e,this.pageSize),n=p(e+t-1,this.pageSize),i=r;i<=n;i++)if(null==this._pages[i])return!1;return!0},e.prototype.createVisibilityTraverse=function(){var e={index:this,queue:[],masks:[],tempAabb:s.create()};return function(t,r){return function(e,t,r){var n=e.index;if(n.hasNodes(0,1)){var i=e.queue;i.length=0,i.push(0);var o=e.masks;for(o.length=0,o.push(0);i.length>0;){var a=i.pop(),u=o.pop(),d=n.getNode(a),h=n.getRenderObb(a),c=!0;if(null!=t.clippingBox&&0==(u&(y=1<<t.frustumPlanes.length))){var f=l.toAaBoundingBox(h,e.tempAabb);s.contains(t.clippingBox,f)?u|=y:s.intersects(t.clippingBox,f)||(c=!1)}for(var g=0;g<t.frustumPlanes.length&&c;g++){var y;if(0==(u&(y=1<<g))){var v=l.intersectPlane(h,t.frustumPlanes[g]);v>0?c=!1:v<0&&(u|=y)}}if(r.predicate(a,d,c)){for(var m=d.firstChild,_=d.childCount,b=!1,x=p(m,n.pageSize),S=p(m+_-1,n.pageSize),w=x;w<=S;w++)if(!n.hasPage(w)){r.pageMiss(a,w),b=!0;break}if(!b)for(g=0;g<_;g++)i.push(m+g),o.push(u)}}}}(e,t,r)}},e}(),g=r.mat4f64.create(),y=i.quatf32.create();return f}.apply(null,n))||(e.exports=i)},2267:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(18),r(264),r(15),r(4),r(262),r(3),r(54),r(45),r(29),r(29),r(1523),r(140),r(605),r(68),r(2268),r(59),r(46),r(66)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p,h,c,f,g,y,v,m,_){function b(e){return e?256:64}function x(e,t,r,n,i){if(r.drawScreenSpace)return r.fixedSize*t*n;var o=b(i)*t*n;return r.drawFixedSize?Math.min(r.fixedSize/2,o):r.screenMinSize>0?Math.min(Math.max(r.screenMinSize*t*n,e/2),o):Math.min(e/2,o)}function S(e,t,r,n,i){return r.drawScreenSpace?0:x(e,t,r,n,i)}function w(e,t,r){return null==r&&(r=s.vec3f64.create()),r[0]=e.origin[0]+e.coordinates[3*t],r[1]=e.origin[1]+e.coordinates[3*t+1],r[2]=e.origin[2]+e.coordinates[3*t+2],r}var P=i.mat4f64.create(),R={positions:[{name:"aPosition",count:3,type:5126,offset:0,stride:12,normalized:!1}],colors:[{name:"aColor",count:3,type:5121,offset:0,stride:3,normalized:!0}]},N=function(){function e(){this.didRender=!1,this.needsRender=!0,this.layerUid="",this._useFixedSizes=!1,this._scaleFactor=1,this._minSizePx=0,this._useRealWorldSymbolSizes=!1,this._size=0,this._sizePx=0,this._slicePlaneEnabled=!1,this._clipBox=u.create(u.POSITIVE_INFINITY),this._programRep=null,this._needsPrograms=!0,this._programWorld=null,this._programScreen=null,this._programWorldDepth=null,this._programScreenDepth=null,this.tempMatrix4=n.mat4f32.create(),this.tempVec3=a.vec3f32.create(),this.nodes=[]}return e.prototype.initializeRenderContext=function(e){var t=e.rctx;this._programRep=new f(t),this.needsRender=!0,this._needsPrograms=!0},e.prototype.uninitializeRenderContext=function(e){this._programRep.dispose(),this._programRep=null,this._programWorld=null,this._programScreen=null,this._programWorldDepth=null,this._programScreenDepth=null},e.prototype.intersect=function(e,t,r,n,i){var a=s.vec3f64.create(),f=s.vec3f64.create(),g=s.vec3f64.create(),y=s.vec3f64.create(),v=p.plane.create(),m=e.camera.perScreenPixelRatio/2,_=e.camera.near,b=this._getSizeParams();o.vec3.subtract(f,n,r);var R=1/o.vec3.length(f);o.vec3.scale(f,f,R),o.vec3.negate(g,f),l.vec4.set(v,f[0],f[1],f[2],-o.vec3.dot(f,r));var N={},z={},I=[],M=u.create(),O=u.create(this._clipBox);u.offset(O,-r[0],-r[1],-r[2],O);for(var C=0,k=this.nodes;C<k.length;C++){var V=k[C],j=V.splatSize*this._scaleFactor,A=h.minimumDistancePlane(V.obb,v),F=h.maximumDistancePlane(V.obb,v);if(A-=S(j,A+_,b,m,V.isLeaf),!((F-=S(j,F+_,b,m,V.isLeaf))<0)&&!(null!=N.dist&&null!=z.dist&&N.dist<A*R&&z.dist>F*R)){var U=x(j,F+_,b,m,V.isLeaf);if(h.intersectLine(V.obb,r,f,U)){var W=U*U;h.toAaBoundingBox(V.obb,M),u.offset(M,-r[0],-r[1],-r[2],M);var L=!u.contains(O,M);o.vec3.subtract(y,V.origin,r);for(var E=V.coordinates.length/3,T=0;T<E;T++)if(a[0]=y[0]+V.coordinates[3*T],a[1]=y[1]+V.coordinates[3*T+1],a[2]=y[2]+V.coordinates[3*T+2],!L||u.containsPoint(O,a)){var Q=o.vec3.dot(a,f),B=o.vec3.squaredLength(a)-Q*Q;if(!(B>W)){var q=Q+_,D=S(j,q,b,m,V.isLeaf);if(!(Q-D<0)){var J=x(j,q-=D,b,m,V.isLeaf);if(!(B>J*J)){var G=this.layerUid+"/"+V.id+"/"+T,H=(Q-D)*R;if(null==N.dist||H<N.dist){var X=N;(null==t||t(r,n,H))&&(X.point=w(V,T,X.point),X.dist=H,X.normal=g,X.pointId=G,X.layerUid=this.layerUid)}if(null==z.dist||H>z.dist){X=z;(null==t||t(r,n,H))&&(X.point=w(V,T,X.point),X.dist=H,X.normal=g,X.pointId=G,X.layerUid=this.layerUid)}if((null==t||t(r,n,H))&&e.enable.storeAll){var Y={};Y.point=w(V,T,Y.point),Y.dist=H,Y.normal=g,Y.pointId=G,Y.layerUid=this.layerUid,I.push(Y)}}}}}}}}if(null!=N.dist){var Z=e.results.min;if(null==Z.dist||N.dist<Z.dist){var K={type:"external",point:N.point,metadata:{pointId:N.pointId,layerUid:N.layerUid}};Z.set(K,N.pointId,N.dist,N.normal,P,void 0),Z.intersector="PointRenderer"}}if(null!=z.dist){var $=e.results.max;if(null==$.dist||z.dist>$.dist){K={type:"external",point:z.point,metadata:{pointId:z.pointId,layerUid:z.layerUid}};$.set(K,z.pointId,z.dist,z.normal,P,void 0),$.intersector="PointRenderer"}}if(e.enable.storeAll)for(var ee=d.ray.fromPoints(r,n),te=0,re=I;te<re.length;te++){K={type:"external",point:(X=re[te]).point,metadata:{pointId:X.pointId,layerUid:X.layerUid}};var ne=new c.IntersectorResult(ee);ne.set(K,X.pointId,X.dist,X.normal,P,void 0),ne.intersector="PointRenderer",e.results.all.push(ne)}},e.prototype.render=function(e){if(0!==e.pass&&1!==e.pass)return!1;for(var t=1===e.pass,n=e.rctx,i=0,a=this.nodes;i<a.length;i++){null==(v=a[i]).vao&&this._initNode(e,v)}this._selectPrograms();var s=this._getSizeParams(),l=t?s.drawScreenSpace?this._programScreenDepth:this._programWorldDepth:s.drawScreenSpace?this._programScreen:this._programWorld;if(null==l||0===this.nodes.length)return!0;var d=this._clipBox,p=!u.equals(d,u.POSITIVE_INFINITY,function(e,t){return e===t});p||(o.vec3.set(this.tempVec3,-1/0,-1/0,-1/0),l.setUniform3fv("uClipMin",this.tempVec3),o.vec3.set(this.tempVec3,1/0,1/0,1/0),l.setUniform3fv("uClipMax",this.tempVec3)),n.bindProgram(l),n.setPipelineState(this._pipelineState),l.setUniformMatrix4fv("uProjectionMatrix",e.camera.projectionMatrix),t&&l.setUniform2f("nearFar",e.camera.near,e.camera.far);var h=e.camera.pixelRatio;s.drawFixedSize&&l.setUniform2f("uPointScale",s.fixedSize*h,e.camera.fullHeight);for(var c=this._slicePlaneEnabled?e.sliceHelper&&e.sliceHelper.plane:null,f=0,y=this.nodes;f<y.length;f++){var v=y[f];if(l.setUniform2f("uScreenMinMaxSize",s.screenMinSize*h,b(v.isLeaf)*h),!s.drawFixedSize){var m=v.splatSize*this._scaleFactor;l.setUniform2f("uPointScale",m*h,e.camera.fullHeight/h)}var _=v.origin;p&&(o.vec3.set(this.tempVec3,d[0]-_[0],d[1]-_[1],d[2]-_[2]),l.setUniform3fv("uClipMin",this.tempVec3),o.vec3.set(this.tempVec3,d[3]-_[0],d[4]-_[1],d[5]-_[2]),l.setUniform3fv("uClipMax",this.tempVec3)),r.mat4.identity(this.tempMatrix4),r.mat4.translate(this.tempMatrix4,this.tempMatrix4,_),r.mat4.multiply(this.tempMatrix4,e.camera.viewMatrix,this.tempMatrix4),l.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4),c&&g.bindSlicePlane(_,c,l),n.bindVAO(v.vao),n.drawArrays(0,0,v.coordinates.length/3)}return!0},Object.defineProperty(e.prototype,"useFixedSizes",{get:function(){return this._useFixedSizes},set:function(e){this._useFixedSizes!==e&&(this._useFixedSizes=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(e){this._scaleFactor!==e&&(this._scaleFactor=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minSizePx",{get:function(){return this._minSizePx},set:function(e){this._minSizePx!==e&&(this._minSizePx=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useRealWorldSymbolSizes",{get:function(){return this._useRealWorldSymbolSizes},set:function(e){this._useRealWorldSymbolSizes!==e&&(this._useRealWorldSymbolSizes=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){this._size!==e&&(this._size=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sizePx",{get:function(){return this._sizePx},set:function(e){this._sizePx!==e&&(this._sizePx=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clippingBox",{set:function(e){u.set(this._clipBox,e||u.POSITIVE_INFINITY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(e){this._slicePlaneEnabled!==e&&(this._slicePlaneEnabled=e,this._requestRender(),this._needsPrograms=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectionHandlerId",{get:function(){return this.layerUid},enumerable:!0,configurable:!0}),e.prototype.addNode=function(e){this.nodes.push(e),this._requestRender()},e.prototype.removeNode=function(e){var t=null;return this.nodes=this.nodes.filter(function(r){return r.id!==e||(t=r,r.vao&&(r.vao.dispose(!0),r.vao=null),!1)}),this._requestRender(),t},e.prototype.removeAll=function(){this.nodes.forEach(function(e){e.vao&&(e.vao.dispose(!0),e.vao=null)}),this.nodes=[],this._requestRender()},e.prototype._initNode=function(e,t){var r=e.rctx;t.vao=new _(r,y.program.attributes,R,{positions:v.createVertex(r,35044,t.coordinates),colors:v.createVertex(r,35044,t.rgb)})},e.prototype._requestRender=function(){this.didRender=!1,this.needsRender=!0},e.prototype._getSizeParams=function(){var e=this._useFixedSizes,t=e&&!this._useRealWorldSymbolSizes,r=t?this._sizePx:this._size,n=this._minSizePx;return e&&(n=0),{drawScreenSpace:t,drawFixedSize:e,fixedSize:r,screenMinSize:n}},e.prototype._selectPrograms=function(){this._needsPrograms&&(this._needsPrograms=!1,this._programWorld=this._programRep.getProgram(y.program,{slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreen=this._programRep.getProgram(y.program,{drawScreenSize:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programWorldDepth=this._programRep.getProgram(y.program,{depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreenDepth=this._programRep.getProgram(y.program,{drawScreenSize:!0,depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._pipelineState=m.makePipelineState({depthTest:{func:513},depthWrite:m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams}))},e}();return function(e){(N||(N={})).isInstanceOfNode=function(e){return e.hasOwnProperty("splatSize")}}(),N}.apply(null,n))||(e.exports=i)},2268:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(64),r(55)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return n.glslifyDefineMap({DEPTH_PASS:e.depthPass,DRAW_SCREEN_SIZE:e.drawScreenSize,SLICE:e.slicePlaneEnabled})};t.program={name:"point-renderer",shaders:function(e){return{vertexShader:i(e)+r.resolveIncludes("pointRenderer/pointRenderer.vert"),fragmentShader:i(e)+r.resolveIncludes("pointRenderer/pointRenderer.frag")}},attributes:{aPosition:0,aColor:1}}}.apply(null,n))||(e.exports=i)}}]);