(function(){(this||window).webpackJsonp.registerAbsMids({"esri/geometry/support/normalizeUtils":1463,"esri/tasks/geometry/cut":1464,"esri/tasks/geometry/simplify":1465,"esri/views/layers/RefreshableLayerView":1468,"esri/views/2d/layers/KMLLayerView2D":2450})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{1463:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n(10),n(12),n(97),n(15),n(11),n(14),n(8),n(63),n(96),n(39),n(94),n(56),n(1464),n(1465)],void 0===(r=function(e,t,n,i,r,s,o,a,l,p,u,h,c,f,y,d){function g(e){return"polygon"===e.type}function v(e){return"polygon"===e[0].type}function m(e){return"polyline"===e[0].type}function w(e){return g(e)?e.rings:e.paths}function _(e,t){return Math.ceil((e-t)/(2*t))}function b(e,t){for(var n=0,i=w(e);n<i.length;n++)for(var r=0,s=i[n];r<s.length;r++){s[r][0]+=t}return e}function V(e){for(var t=[],n=0,i=0,r=0;r<e.length;r++){for(var s=e[r],o=null,a=0;a<s.length;a++)o=s[a],t.push(o),0===a?i=n=o[0]:(n=Math.min(n,o[0]),i=Math.max(i,o[0]));o&&t.push([(n+i)/2,0])}return t}function x(e,t){if(!(e instanceof u||e instanceof p)){var n="straightLineDensify: the input geometry is neither polyline nor polygon";throw S.error(n),new s(n)}for(var i=[],r=0,o=w(e);r<o.length;r++){var a=o[r],l=[];i.push(l),l.push([a[0][0],a[0][1]]);for(var h=0;h<a.length-1;h++){var c=a[h][0],f=a[h][1],y=a[h+1][0],d=a[h+1][1],v=Math.sqrt((y-c)*(y-c)+(d-f)*(d-f)),m=(d-f)/v,_=(y-c)/v,b=v/t;if(b>1){for(var V=1;V<=b-1;V++){var x=V*t,M=_*x+c,I=m*x+f;l.push([M,I])}var P=(v+Math.floor(b-1)*t)/2,R=_*P+c,T=m*P+f;l.push([R,T])}l.push([y,d])}}return g(e)?new p({rings:i,spatialReference:e.spatialReference}):new u({paths:i,spatialReference:e.spatialReference})}function M(e,t,n){if(t){var i=x(e,1e6);e=f.webMercatorToGeographic(i,!0)}return n&&(e=b(e,n)),e}function I(e,t,n){var i;if(Array.isArray(e)){if((i=e[0])>t){var r=_(i,t);e[0]=i+r*(-2*t)}else if(i<n){r=_(i,n);e[0]=i+r*(-2*n)}}else if((i=e.x)>t){r=_(i,t);e=e.clone().offset(r*(-2*t),0)}else if(i<n){r=_(i,n);e=e.clone().offset(r*(-2*n),0)}return e}function P(e,t){for(var n=-1,i=0;i<t.cutIndexes.length;i++)!function(i){for(var r=t.cutIndexes[i],s=t.geometries[i],o=w(s),a=0;a<o.length;a++)!function(e){var t=o[e];t.some(function(n){if(n[0]<180)return!0;for(var i=0,r=0;r<t.length;r++){var o=t[r][0];i=o>i?o:i}for(var a=-360*_(i=Number(i.toFixed(9)),180),l=0;l<t.length;l++){var p=s.getPoint(e,l);s.setPoint(e,l,p.clone().offset(a,0))}return!0})}(a);if(r===n){if(v(e))for(var l=0,p=w(s);l<p.length;l++){var u=p[l];e[r]=e[r].addRing(u)}else if(m(e))for(var h=0,c=w(s);h<c.length;h++){var f=c[h];e[r]=e[r].addPath(f)}}else n=r,e[r]=s}(i);return e}Object.defineProperty(t,"__esModule",{value:!0});var S=o.getLogger("esri.geometry.support.normalizeUtils"),R={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new u({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:h.WebMercator}),minus180Line:new u({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:h.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new u({paths:[[[180,-180],[180,180]]],spatialReference:h.WebMercator}),minus180Line:new u({paths:[[[-180,-180],[-180,180]]],spatialReference:h.WebMercator})}};t.straightLineDensify=x,t.normalizeCentralMeridian=function e(t,s,o){return i(this,void 0,void 0,function(){var i,h,g,v,m,w,V,x,S,T,C,L,O,J,j,A,k,N,W,q,D,G,U,X,z,E,K,F,B,H,Q,Y,Z,$,ee,te,ne;return n(this,function(n){switch(n.label){case 0:if(!Array.isArray(t))return[2,e([t],s)];for(i=s?s.url:r.geometryServiceUrl,T=0,C=[],L=[],O=0,J=t;O<J.length;O++)j=J[O],a.isNone(j)?L.push(j):(h||(h=j.spatialReference,g=c.getInfo(h),v=h.isWebMercator,m=R[V=v?102100:4326].maxX,w=R[V].minX,x=R[V].plus180Line,S=R[V].minus180Line),g?"mesh"===j.type?L.push(j):"point"===j.type?L.push(I(j.clone(),m,w)):"multipoint"===j.type?((A=j.clone()).points=A.points.map(function(e){return I(e,m,w)}),L.push(A)):"extent"===j.type?(N=j.clone(),k=N._normalize(!1,!1,g),L.push(k.rings?new p(k):k)):j.extent?(N=j.extent,W=_(N.xmin,w),D=0==(q=W*(2*m))?j.clone():b(j.clone(),q),N.offset(q,0),N.intersects(x)&&N.xmax!==m?(T=N.xmax>T?N.xmax:T,D=M(D,v),C.push(D),L.push("cut")):N.intersects(S)&&N.xmin!==w?(T=N.xmax*(2*m)>T?N.xmax*(2*m):T,D=M(D,v,360),C.push(D),L.push("cut")):L.push(D)):L.push(j.clone()):L.push(j));for(G=_(T,m),U=-90,X=G,z=new u;G>0;)E=360*G-180,z.addPath([[E,U],[E,-1*U]]),U*=-1,G--;return C.length>0&&X>0?[4,y.cut(i,C,z,o)]:[3,3];case 1:for(K=n.sent(),F=P(C,K),B=[],H=[],ee=0;ee<L.length;ee++)"cut"!==(te=L[ee])?H.push(te):(ne=F.shift(),Q=t[ee],a.isSome(Q)&&"polygon"===Q.type&&Q.rings&&Q.rings.length>1&&ne.rings.length>=Q.rings.length?(B.push(ne),H.push("simplify")):H.push(v?f.geographicToWebMercator(ne):ne));return B.length?[4,d.simplify(i,B,o)]:[2,H];case 2:for(Y=n.sent(),Z=[],ee=0;ee<H.length;ee++)"simplify"!==(te=H[ee])?Z.push(te):Z.push(v?f.geographicToWebMercator(Y.shift()):Y.shift());return[2,Z];case 3:for($=[],ee=0;ee<L.length;ee++)"cut"!==(te=L[ee])?$.push(te):(ne=C.shift(),$.push(!0===v?f.geographicToWebMercator(ne):ne));return[2,l.resolve($)]}})})},t.getDenormalizedExtent=function(e){var t;if(!e)return null;var n=e.extent;if(!n)return null;var i=e.spatialReference&&c.getInfo(e.spatialReference);if(!i)return n;var r,s=i.valid,o=s[0],a=s[1],l=2*a,p=n.width,u=n.xmin,h=n.xmax;if(u=(t=[h,u])[0],h=t[1],"extent"===e.type||0===p||p<=a||p>l||u<o||h>a)return n;switch(e.type){case"polygon":if(!(e.rings.length>1))return n;r=V(e.rings);break;case"polyline":if(!(e.paths.length>1))return n;r=V(e.paths);break;case"multipoint":r=e.points}for(var f=n.clone(),y=0;y<r.length;y++){var d=r[y][0];d<0?(d+=a,h=Math.max(d,h)):(d-=a,u=Math.min(d,u))}return f.xmin=u,f.xmax=h,f.width<p?(f.xmin-=a,f.xmax-=a,f):n},t.normalizeMapX=function(e,t){var n=c.getInfo(t);if(n){var i=n.valid,r=i[0],s=i[1],o=s-r;if(e<r)for(;e<r;)e+=o;if(e>s)for(;e>s;)e-=o}return e}}.apply(null,i))||(e.exports=r)},1464:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n(7),n(12),n(10),n(42),n(48),n(31),n(71)],void 0===(r=function(e,t,n,i,r,s,o,a,l){Object.defineProperty(t,"__esModule",{value:!0}),t.cut=function(e,t,p,u){return i(this,void 0,void 0,function(){var i,h,c,f,y,d,g;return r(this,function(r){switch(r.label){case 0:return i="string"==typeof e?a.urlToObject(e):e,h=t[0].spatialReference,c=n({},u,{query:n({},i.query,{f:"json",sr:JSON.stringify(h),target:JSON.stringify({geometryType:l.getJsonType(t[0]),geometries:t}),cutter:JSON.stringify(p)})}),[4,o(i.path+"/cut",c)];case 1:return f=r.sent(),y=f.data,d=y.cutIndexes,g=y.geometries,[2,{cutIndexes:d,geometries:(void 0===g?[]:g).map(function(e){return s.fromJSON(e).set(h)})}]}})})}}.apply(null,i))||(e.exports=r)},1465:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n(7),n(12),n(10),n(48),n(31),n(71)],void 0===(r=function(e,t,n,i,r,s,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.simplify=function(e,t,l){return i(this,void 0,void 0,function(){var i,p,u,h;return r(this,function(r){switch(r.label){case 0:return i="string"==typeof e?o.urlToObject(e):e,p=t[0].spatialReference,u=a.getJsonType(t[0]),h=n({},l,{query:n({},i.query,{f:"json",sr:p.wkid?p.wkid:JSON.stringify(p),geometries:JSON.stringify(function(e){return{geometryType:a.getJsonType(e[0]),geometries:e.map(function(e){return e.toJSON()})}}(t))})}),[4,s(i.path+"/simplify",h)];case 1:return[2,function(e,t,n){var i=a.getGeometryType(t);return e.map(function(e){var t=i.fromJSON(e);return t.spatialReference=n,t})}(r.sent().data,u,p)]}})})}}.apply(null,i))||(e.exports=r)},1468:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n(2),n(1),n(10),n(12),n(6),n(8),n(0)],void 0===(r=function(e,t,n,i,r,s,o,a,l){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refreshTimestamp=null,t.refreshDebounced=a.debounce(function(e,n){return s(t,void 0,void 0,function(){var t;return r(this,function(i){switch(i.label){case 0:return"number"==typeof e?t=e:(t=Date.now(),n=e),this._set("refreshTimestamp",t),this.doRefresh?[4,this.doRefresh(n)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},2e3),t}return n(t,e),t.prototype.refresh=function(e){void 0===e&&(e=Date.now()),this._set("refreshTimestamp",e),this.doRefresh&&this.doRefresh()},i([l.property()],t.prototype,"layer",void 0),i([l.aliasOf("layer.refreshInterval")],t.prototype,"refreshInterval",void 0),i([l.property({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),i([l.subclass("esri.layers.mixins.RefreshableLayerView")],t)}(l.declared(o))}.apply(null,i))||(e.exports=r)},2450:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n(2),n(1),n(10),n(12),n(84),n(48),n(52),n(29),n(20),n(8),n(59),n(28),n(0),n(36),n(56),n(1714),n(1462),n(1475),n(1634),n(1468)],void 0===(r=function(e,t,n,i,r,s,o,a,l,p,u,h,c,f,y,d,g,v,m,w,_,b){var V=p.ofType(o);return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handles=new u,t._bitmapIndex=new Map,t._mapImageContainer=new m.BitmapContainer,t._featuresMap=new Map,t.allVisiblePoints=new V,t.allVisiblePolylines=new V,t.allVisiblePolygons=new V,t.allVisibleMapImages=new p,t.container=new m.Container,t}return n(t,e),t.prototype.hitTest=function(e,t){var n=this;if(this.suspended||!this._pointsView&&!this._polylinesView&&!this._polygonsView)return h.resolve(null);var i=[this._pointsView.hitTest(e,t),this._polylinesView.hitTest(e,t),this._polygonsView.hitTest(e,t)];return h.all(i).then(function(e){return e.filter(function(e){return e&&(e.layer=n.layer,e.sourceLayer=n.layer),!!e})[0]||null})},t.prototype.update=function(e){this._polygonsView&&this._polygonsView.update(e),this._polylinesView&&this._polylinesView.update(e),this._pointsView&&this._pointsView.update(e)},t.prototype.attach=function(){var e=this;this._handles.add(this.allVisibleMapImages.on("change",function(t){t.added.forEach(function(t){return e._addMapImage(t)}),t.removed.forEach(function(t){return e._removeMapImage(t)})})),this.container.addChild(this._mapImageContainer),this._polygonsView=new _.default({view:this.view,graphics:this.allVisiblePolygons}),this.container.addChild(this._polygonsView.container),this._polylinesView=new _.default({view:this.view,graphics:this.allVisiblePolylines}),this.container.addChild(this._polylinesView.container),this._pointsView=new _.default({view:this.view,graphics:this.allVisiblePoints}),this.container.addChild(this._pointsView.container),this.watch("layer.visibleSublayers",function(){return e._refreshCollections()}),this._fetchingPromise=this._fetchService().then(function(){e._fetchingPromise=null,e.notifyChange("updating")})},t.prototype.detach=function(){this._handles.removeAll(),this._mapImageContainer.removeAllChildren(),this.container.removeAllChildren(),this._bitmapIndex.clear(),this._polygonsView&&(this._polygonsView.destroy(),this._polygonsView=null),this._polylinesView&&(this._polylinesView.destroy(),this._polylinesView=null),this._pointsView&&(this._pointsView.destroy(),this._pointsView=null)},t.prototype.moveStart=function(){this.requestUpdate()},t.prototype.viewChange=function(){this.requestUpdate()},t.prototype.moveEnd=function(){this.requestUpdate()},t.prototype.isUpdating=function(){return null!=this._fetchingPromise||this._pointsView.updating||this._polygonsView.updating||this._polylinesView.updating},t.prototype._addMapImage=function(e){var t=this;this.view.spatialReference.isWGS84&&a(e.href,{responseType:"image"}).then(function(n){var i=n.data,r=d.fromJSON(e.extent);g.canProject(r,t.view.spatialReference)&&(r=g.project(r,t.view.spatialReference));var s=new m.Bitmap(i);s.x=r.xmin,s.y=r.ymax,s.resolution=r.width/i.naturalWidth,s.rotation=e.rotation,t._mapImageContainer.addChild(s),t._bitmapIndex.set(e,s)})},t.prototype._fetchService=function(){var e=this;return this._handles.remove("refresh-collections"),this._getParsedKML().then(function(t){return e._fetchSublayerService(e.layer,t)})},t.prototype._fetchSublayerService=function(e,t){var n=this,i=e.sublayers;if(!i||0===i.length)return h.resolve();var r=[];return i.forEach(function(e){var i=f.whenTrueOnce(e,"visible").then(function(){return e.load()}).then(function(){return l.safeCast(n._getGraphicsForSublayer(e,t))}).then(function(t){return h.create(function(i){e.networkLink?i():(n._featuresMap.set(e,t),n._handles.add(c.schedule(function(){n._refreshCollections(),i()}),"refresh-collections"))})}).then(function(){return n._fetchSublayerService(e,t)});e.visible&&r.push(i)}),h.all(r).then(function(){})},t.prototype._getParsedKML=function(){return v.fetchService(this.layer.url,this.view.spatialReference,this.layer.refreshInterval).then(function(e){return v.parseKML(e.data)})},t.prototype._getGraphicsForSublayer=function(e,t){return s(this,void 0,void 0,function(){var n,i,s,o,a;return r(this,function(r){switch(r.label){case 0:return n=null,t.sublayers.some(function(t){return n=t,t.id===e.id})?(i={},(s=n.points)?[4,v.getGraphics(n.points)]:[3,2]):[2,null];case 1:s=r.sent(),r.label=2;case 2:return i.points=s,(o=n.polylines)?[4,v.getGraphics(n.polylines)]:[3,4];case 3:o=r.sent(),r.label=4;case 4:return i.polylines=o,(a=n.polygons)?[4,v.getGraphics(n.polygons)]:[3,6];case 5:a=r.sent(),r.label=6;case 6:return[2,(i.polygons=a,i.mapImages=n.mapImages,i)]}})})},t.prototype._refreshCollections=function(){var e=this,t=this.get("layer.visibleSublayers");this.allVisiblePoints.removeAll(),this.allVisiblePolylines.removeAll(),this.allVisiblePolygons.removeAll(),this.allVisibleMapImages.removeAll(),t&&t.length&&t.forEach(function(t){var n=e._featuresMap.get(t);n&&(e.allVisiblePoints.addMany(n.points),e.allVisiblePolylines.addMany(n.polylines),e.allVisiblePolygons.addMany(n.polygons),e.allVisibleMapImages.addMany(n.mapImages))})},t.prototype._removeMapImage=function(e){var t=this._bitmapIndex.get(e);t&&(this._mapImageContainer.removeChild(t),this._bitmapIndex.delete(e))},i([y.property()],t.prototype,"_pointsView",void 0),i([y.property()],t.prototype,"_polylinesView",void 0),i([y.property()],t.prototype,"_polygonsView",void 0),i([y.property()],t.prototype,"_fetchingPromise",void 0),i([y.property({dependsOn:["_fetchingPromise","_pointsView.updating","_polygonsView.updating","_polylinesView.updating"]})],t.prototype,"updating",void 0),i([y.subclass("esri.views.2d.layers.KMLLayerView2D")],t)}(y.declared(w,b))}.apply(null,i))||(e.exports=r)}}]);