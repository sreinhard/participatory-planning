(function(){(this||window).webpackJsonp.registerAbsMids({"esri/core/HandleOwner":1509,"esri/views/2d/engine/webgl/enums":1511,"esri/views/2d/engine/webgl/Utils":1517,"esri/views/2d/tiling/TileSpan":1520,"esri/layers/graphics/data/projectionSupport":1524,"esri/views/2d/tiling/TileInfoView":1527,"esri/views/2d/engine/webgl/number":1528,"esri/views/2d/tiling/TileStrategy":1530,"esri/views/2d/engine/webgl/color":1537,"esri/views/2d/tiling/LODInfo":1545,"esri/views/2d/tiling/TileCoverage":1546,"esri/views/2d/tiling/TileQueue":1547,"esri/views/support/QueueProcessor":1552,"esri/core/Queue":1562,"esri/views/2d/tiling":1600,"esri/geometry/projection":1618,"esri/views/2d/engine/webgl/SymbolProperties":1620,"esri/layers/support/FeatureProcessing":1630,"esri/views/2d/layers/features/controllers/BaseController":1647,"esri/layers/graphics/data/FeatureFilter":1648,"esri/geometry/pe":1664,"esri/geometry/support/GeographicTransformation":1665,"esri/geometry/support/GeographicTransformationStep":1666,"esri/views/2d/layers/features/support/TileUpdateQueue":1717,"esri/views/2d/layers/features/controllers/MemoryController":1799})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{1509:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(6),r(17),r(0)],void 0===(i=function(e,t,r,n,i,o,s){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.call(this)||this;return n.handles=new o,n}return r(t,e),t.prototype.destroy=function(){this.handles.destroy()},n([s.property({readOnly:!0})],t.prototype,"handles",void 0),n([s.subclass("esri.core.HandleOwner")],t)}(s.declared(i))}.apply(null,n))||(e.exports=i)},1511:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r,n,i,o,s,u,a,l,p,c;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.WGLGeometryType||(t.WGLGeometryType={}))[r.FILL=0]="FILL",r[r.LINE=1]="LINE",r[r.MARKER=2]="MARKER",r[r.TEXT=3]="TEXT",r[r.LABEL=4]="LABEL",(n=t.WGLGeometryTransactionStatus||(t.WGLGeometryTransactionStatus={}))[n.SUCCEEDED=0]="SUCCEEDED",n[n.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY",(i=t.WGLDrawPhase||(t.WGLDrawPhase={}))[i.NONE=0]="NONE",i[i.MAP=1]="MAP",i[i.LABEL=2]="LABEL",i[i.LABEL_ALPHA=4]="LABEL_ALPHA",i[i.HITTEST=8]="HITTEST",i[i.HIGHLIGHT=16]="HIGHLIGHT",i[i.CLIP=32]="CLIP",i[i.DEBUG=64]="DEBUG",i[i.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES",(o=t.VVType||(t.VVType={}))[o.SIZE=0]="SIZE",o[o.COLOR=1]="COLOR",o[o.OPACITY=2]="OPACITY",o[o.ROTATION=3]="ROTATION",(s=t.WGLVVFlag||(t.WGLVVFlag={}))[s.NONE=0]="NONE",s[s.OPACITY=1]="OPACITY",s[s.COLOR=2]="COLOR",s[s.ROTATION=4]="ROTATION",s[s.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE",s[s.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS",s[s.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS",s[s.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE",(u=t.WGLVVTarget||(t.WGLVVTarget={}))[u.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",u[u.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",u[u.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",u[u.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE",(a=t.CapType||(t.CapType={}))[a.UNKNOWN=0]="UNKNOWN",a[a.BUTT=1]="BUTT",a[a.ROUND=2]="ROUND",a[a.SQUARE=3]="SQUARE",(l=t.JoinType||(t.JoinType={}))[l.UNKNOWN=0]="UNKNOWN",l[l.MITER=1]="MITER",l[l.BEVEL=2]="BEVEL",l[l.ROUND=3]="ROUND",(p=t.Alignment||(t.Alignment={}))[p.SCREEN=0]="SCREEN",p[p.MAP=1]="MAP",(c=t.MosaicType||(t.MosaicType={}))[c.SPRITE=0]="SPRITE",c[c.GLYPH=1]="GLYPH"}.apply(null,n))||(e.exports=i)},1517:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(134),r(156),r(13),r(10),r(14),r(560),r(81),r(1537),r(1511),r(1620),r(12),r(53)],void 0===(i=function(e,t,r,n,i,o,s,u,a,l,p,c,_,h,f){var d;Object.defineProperty(t,"__esModule",{value:!0});var y=s.getLogger("esri.views.2d.engine.webgl.Utils");function g(e){for(var t={},r=0,n=e;r<n.length;r++){var i=n[r];t[i.name]=i.strideInBytes}return t}t.C_HITTEST_SEARCH_SIZE=4,t.C_VBO_GEOMETRY="geometry",t.C_VBO_PERINSTANCE="per_instance",t.C_VBO_PERINSTANCE_VV="per_instance_vv",t.C_VBO_VISIBILITY="visibility",t.C_VBO_VISIBILITY_RANGE="visibilityRange",t.C_ICON_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_ICON_VERTEX_DEF_VV=[{name:t.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_FILL_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:32,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_FILL_VERTEX_DEF_VV=[{name:t.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_FILL_VERTEX_DEF_DD=[{name:t.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_LINE_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:32,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_LINE_VERTEX_DEF_VV=[{name:t.C_VBO_GEOMETRY,strideInBytes:44,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_TEXT_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_TEXT_VERTEX_DEF_VV=[{name:t.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_LABEL_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0},{name:t.C_VBO_VISIBILITY_RANGE,strideInBytes:2,divisor:0}],t.C_ICON_STRIDE_SPEC=g(t.C_ICON_VERTEX_DEF),t.C_ICON_STRIDE_SPEC_VV=g(t.C_ICON_VERTEX_DEF_VV),t.C_FILL_STRIDE_SPEC=g(t.C_FILL_VERTEX_DEF),t.C_FILL_STRIDE_SPEC_VV=g(t.C_FILL_VERTEX_DEF_VV),t.C_FILL_STRIDE_SPEC_DD=g(t.C_FILL_VERTEX_DEF_DD),t.C_LINE_STRIDE_SPEC=g(t.C_LINE_VERTEX_DEF),t.C_LINE_STRIDE_SPEC_VV=g(t.C_LINE_VERTEX_DEF_VV),t.C_TEXT_STRIDE_SPEC=g(t.C_TEXT_VERTEX_DEF),t.C_TEXT_STRIDE_SPEC_VV=g(t.C_TEXT_VERTEX_DEF_VV),t.C_LABEL_STRIDE_SPEC=g(t.C_LABEL_VERTEX_DEF),t.getStrides=function(e,r,n){switch(e){case c.WGLGeometryType.MARKER:return r?t.C_ICON_STRIDE_SPEC_VV:t.C_ICON_STRIDE_SPEC;case c.WGLGeometryType.FILL:return n?t.C_FILL_STRIDE_SPEC_DD:r?t.C_FILL_STRIDE_SPEC_VV:t.C_FILL_STRIDE_SPEC;case c.WGLGeometryType.LINE:return r?t.C_LINE_STRIDE_SPEC_VV:t.C_LINE_STRIDE_SPEC;case c.WGLGeometryType.TEXT:return r?t.C_TEXT_STRIDE_SPEC_VV:t.C_TEXT_STRIDE_SPEC;case c.WGLGeometryType.LABEL:return t.C_LABEL_STRIDE_SPEC}return null};var v=[t.C_VBO_GEOMETRY,t.C_VBO_VISIBILITY],m=[t.C_VBO_GEOMETRY,t.C_VBO_VISIBILITY],E=[t.C_VBO_GEOMETRY,t.C_VBO_VISIBILITY],P=[t.C_VBO_GEOMETRY,t.C_VBO_VISIBILITY],T=[t.C_VBO_GEOMETRY,t.C_VBO_VISIBILITY,t.C_VBO_VISIBILITY_RANGE];function I(e){switch(e){case c.WGLGeometryType.MARKER:return v;case c.WGLGeometryType.FILL:return m;case c.WGLGeometryType.LINE:return E;case c.WGLGeometryType.TEXT:return P;case c.WGLGeometryType.LABEL:return T}return null}function S(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function O(e){switch(e){case"esriSMS":return"simple-marker";case"esriPMS":return"picture-marker";case"esriSLS":return"simple-line";case"esriPLS":return"picture-line";case"esriSFS":return"simple-fill";case"esriPFS":return"picture-fill";case"esriTS":return"text"}return e}function w(e){return"string"==typeof e}t.getNamedBuffers=I,t.strideToPackingFactor=S,t.allocateTypedArrayBuffer=function(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}},t.allocateTypedArrayBufferwithData=function(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}},t.normalizeSymbolType=O,t.isMarkerSymbol=function(e){var t=O(e.type);if(t){switch(t){case"simple-marker":case"picture-marker":case"CIMPointSymbol":return!0}return!1}},t.isFillSymbol=function(e){var t=O(e.type);if(t){switch(t){case"simple-fill":case"picture-fill":case"CIMPolygonSymbol":return!0}return!1}},t.isLineSymbol=function(e){var t=O(e.type);if(t){switch(t){case"simple-line":case"picture-line":case"CIMLineSymbol":return!0}return!1}},t.isPictureSymbol=function(e){var t=O(e.type);if(t){switch(t){case"picture-marker":case"picture-line":case"picture-fill":return!0}return!1}return!1},t.isTextSymbol=function(e){var t=O(e.type);if(t){switch(t){case"text":case"CIMTextSymbol":return!0}return!1}},t.getTextProperties=function(e){return _.TextProperties.pool.acquire(e.color?p.copyAndPremultiply(e.color):[255,255,255,255],e.haloColor?p.copyAndPremultiply(e.haloColor):[255,255,255,255],u.pt2px(e.haloSize),u.pt2px(e.font.size),e.angle*Math.PI/180,e.xoffset/e.font.size,e.yoffset/e.font.size,"left"===e.horizontalAlignment?0:"right"===e.horizontalAlignment?1:.5,"top"===e.verticalAlignment?0:"bottom"===e.verticalAlignment?1:.5)},t.isDefined=function(e){return null!=e},t.isNumber=function(e){return"number"==typeof e},t.isString=w,t.isStringOrNull=function(e){return null==e||w(e)},t.lerp=function(e,t,r){return e+(t-e)*r};var C=function(){function e(){this._arr=[],this._push=this._push.bind(this)}return e.prototype._push=function(e,t){this._arr.push(t)},e.prototype.getKeys=function(e){return this._arr.length=0,e&&e.forEach(this._push),this._arr},e}();t.KeysGetter=C;var R=function(){function e(){this._arr=[],this._push=this._push.bind(this)}return e.prototype._push=function(e,t){this._arr.push(e)},e.prototype.getValues=function(e){return this._arr.length=0,e&&e.forEach(this._push),this._arr},e}();function M(e){var t={};switch(e){case"esriGeometryPoint":return function(e,r,n,i){return a.hydratePoint(r,t,e,n,i)};case"esriGeometryPolygon":return function(e,r,n,i){return a.hydratePolygon(r,t,e,n,i)};case"esriGeometryPolyline":return function(e,r,n,i){return a.hydratePolyline(r,t,e,n,i)};case"esriGeometryMultipoint":return function(e,r,n,i){return a.hydrateMultipoint(r,t,e,n,i)};default:return y.error(new o("mapview-arcade","Unable to handle geometryType: "+e)),function(e,t,r,n){return e}}}t.ValuesGetter=R,t.getCapType=function(e,t){switch(e){case"butt":return c.CapType.BUTT;case"round":return t?c.CapType.SQUARE:c.CapType.ROUND;case"square":return c.CapType.SQUARE;default:return y.error(new o("mapview-invalid-type","Cap type "+e+" is not a valid option. Defaulting to round")),c.CapType.ROUND}},t.getJoinType=function(e){switch(e){case"miter":return c.JoinType.MITER;case"bevel":return c.JoinType.BEVEL;case"round":return c.JoinType.ROUND;default:return y.error(new o("mapview-invalid-type","Join type "+e+" is not a valid option. Defaulting to round")),c.JoinType.ROUND}},t.getVVType=function(e){switch(e){case"opacity":return c.VVType.OPACITY;case"color":return c.VVType.COLOR;case"rotation":return c.VVType.ROTATION;case"size":return c.VVType.SIZE;default:return y.error("Cannot interpret unknown vv: "+e),null}},t.createHydrateFactory=M,t.getTransformParams=function(e){return{transform:e.transform,hasZ:e.hasZ,hasM:e.hasM}},t.createArcadeFunction=function(e,t,r){var o=t.fields,s=t.spatialReference,u=t.hasGeometryExpr,a=t.geometryType,p=l.createFunction(e),c=new i,_=new n({viewingMode:null,scale:null}),h={},f={vars:{$feature:c,$view:null},spatialReference:s},d={fields:o},y=M(a);return function(e,t,n){if(u){var i=t.transform,o=t.hasZ,a=t.hasM,g=y(e.geometry,i,o,a);g.spatialReference=s,c.repurposeFromGraphicLikeObject(g,e.attributes,d)}else c.repurposeFromGraphicLikeObject(e.geometry,e.attributes,d);n?((f.vars.$view=_).attributes.viewingMode=n.viewingMode,_.attributes.scale=n.scale):f.vars.$view=h;var v=l.executeFunction(p,f);return r?r(v):v}},t.copyMeshData=function(e,t,r,n,i,o,s){for(var u in o)for(var a=o[u].stride,l=S(a),p=o[u].data,c=r[u].data,_=a*i.vertexCount/l,h=a*e/l,f=a*i.vertexFrom/l,d=0;d<_;++d)c[d+h]=p[d+f];var y=i.indexCount;for(d=0;d<y;++d)n[d+t]=s[d+i.indexFrom]-i.vertexFrom+e},t.C_VBO_INFO=((d={})[t.C_VBO_GEOMETRY]=35044,d[t.C_VBO_VISIBILITY]=35044,d[t.C_VBO_VISIBILITY_RANGE]=35048,d),t.createGeometryData=function(e,t){for(var r=[],n=0;n<5;++n){for(var i={},o=0,s=I(n);o<s.length;o++){var u=s[o];i[u]={data:t(n,u)}}r.push({data:e(n),buffers:i})}return r},t.resampleHermite=function(e,t,r,n,i,o,s){void 0===s&&(s=!0);for(var u=t/i,a=r/o,l=Math.ceil(u/2),p=Math.ceil(a/2),c=0;c<o;c++)for(var _=0;_<i;_++){for(var h=4*(_+(s?o-c-1:c)*i),f=0,d=0,y=0,g=0,v=0,m=0,E=0,P=(c+.5)*a,T=Math.floor(c*a);T<(c+1)*a;T++)for(var I=Math.abs(P-(T+.5))/p,S=(_+.5)*u,O=I*I,w=Math.floor(_*u);w<(_+1)*u;w++){var C=Math.abs(S-(w+.5))/l,R=Math.sqrt(O+C*C);-1<=R&&R<=1&&0<(f=2*R*R*R-3*R*R+1)&&(E+=f*e[3+(C=4*(w+T*t))],y+=f,e[C+3]<255&&(f=f*e[C+3]/250),g+=f*e[C],v+=f*e[C+1],m+=f*e[C+2],d+=f)}n[h]=g/d,n[h+1]=v/d,n[h+2]=m/d,n[h+3]=E/y}},t.createTextureFromTexelData=function(e,t){var r,n;return n=h.isPowerOfTwo(t.width)&&h.isPowerOfTwo(t.height)?(r=!0,9987):(r=!1,9729),new f(e,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:r,samplingMode:n,wrapMode:33071,flipped:!0},t)},t.geometryToMappedGeometry=function(e){return{vertexFrom:void 0,vertexTo:void 0,geometry:e}};var N=new Map;t.createProgramDescriptor=function(e,t){if(!N.has(e)){var n=function(e){var t={},n=function(n){var i=e[n],o=0;t[n]=i.map(function(e){var t=r({},e,{normalized:e.normalized||!1,divisor:e.divisor||0,offset:o,stride:0});return o+=e.count*function(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}(e.type),t}),t[n].forEach(function(e){return e.stride=o})};for(var i in e)n(i);return t}(t),i={strides:function(e){var t={};for(var r in e){var n=e[r];t[r]=n.length?n[0].stride:0}return t}(n),bufferLayouts:n,attributes:function(e){var t={};for(var r in e)for(var n=0,i=e[r];n<i.length;n++){var o=i[n];t[o.name]=o.location}return t}(t)};N.set(e,i)}return N.get(e)}}.apply(null,n))||(e.exports=i)},1520:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(80)],void 0===(i=function(e,t,r){return function(){function e(e,t,r){this.row=e,this.colFrom=t,this.colTo=r}return e.pool=new r(e,!0),e}()}.apply(null,n))||(e.exports=i)},1524:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(13),r(8),r(1618),r(97),r(44)],void 0===(i=function(e,t,r,n,i,o,s){function u(e,t){var r,n,i;if(!t)return null;if("x"in t){var o={x:0,y:0};return r=e(t.x,t.y,_),o.x=r[0],o.y=r[1],null!=t.z&&(o.z=t.z),null!=t.m&&(o.m=t.m),o}if("xmin"in t){o={xmin:0,ymin:0,xmax:0,ymax:0};return n=e(t.xmin,t.ymin,_),o.xmin=n[0],o.ymin=n[1],i=e(t.xmax,t.ymax,_),o.xmax=i[0],o.ymax=i[1],t.hasZ&&(o.zmin=t.zmin,o.zmax=t.zmax,o.hasZ=!0),t.hasM&&(o.mmin=t.mmin,o.mmax=t.mmax,o.hasM=!0),o}return"rings"in t?{rings:a(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:a(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:l(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function a(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n];r.push(l(o,t))}return r}function l(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n],s=t(o[0],o[1],[0,0]);r.push(s),o.length>2&&s.push(o[2]),o.length>3&&s.push(o[3])}return r}function p(e,t){return!(!o.isValid(e)||!o.isValid(t)||o.equals(e,t)||s.canProject(e,t))}Object.defineProperty(t,"__esModule",{value:!0});var c="feature-store:unsupported-query",_=[0,0];t.checkProjectionSupport=function(e,t){if(!t)return n.resolve();if(Array.isArray(e)){for(var o=0,s=e;o<s.length;o++){var u=s[o];if(p(u.geometry&&u.geometry.spatialReference,t))return i.isSupported()?i.load():n.reject(new r(c,"projection not supported",{inSpatialReference:e,outSpatialReference:t}))}return n.resolve()}return p(e,t)?i.isSupported()?i.load():n.reject(new r(c,"projection not supported",{inSpatialReference:e,outSpatialReference:t})):n.resolve()};var h=u.bind(null,s.lngLatToXY),f=u.bind(null,s.xyToLngLat);t.project=function(e,t,r){return r||(r=t,t=e.spatialReference),o.isValid(t)&&o.isValid(r)&&!o.equals(t,r)?s.canProject(t,r)?o.isWebMercator(r)?h(e):f(e):i.projectMany([e],t,r,null,!0)[0]:e};var d=new(function(){function e(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}return e.prototype.push=function(e,t,r){var i=this;e&&e.length&&t&&r&&!o.equals(t,r)||n.resolve(e);var s={geometries:e,inSpatialReference:t,outSpatialReference:r,resolve:null};return this._jobs.push(s),n.create(function(e){s.resolve=e,null===i._timer&&(i._timer=setTimeout(i._process,10))},function(){var e=i._jobs.indexOf(s);e>-1&&i._jobs.splice(e,1)})},e.prototype._process=function(){this._timer=null;var e=this._jobs.shift();if(e){var t=e.geometries,r=e.inSpatialReference,n=e.outSpatialReference;(0,e.resolve)(s.canProject(r,n)?o.isWebMercator(n)?t.map(h):t.map(f):i.projectMany(t,r,n,null,!0)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}},e}());t.projectMany=function(e,t,r){return d.push(e,t,r)}}.apply(null,n))||(e.exports=i)},1527:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(97),r(1545),r(1546),r(355),r(1520)],void 0===(i=function(e,t,r,n,i,o,s){var u=new o("0/0/0/0"),a=function(){function e(e,t,r,n,i,o,s,u){this.x=e,this.ymin=t,this.ymax=r,this.invM=n,this.leftAdjust=i,this.rightAdjust=o,this.leftBound=s,this.rightBound=u}return e.create=function(t,r){var n;t[1]>r[1]&&(t=(n=[r,t])[0],r=n[1]);var i=t[0],o=t[1],s=r[0],u=r[1],a=s-i,l=u-o,p=0!==l?a/l:0,c=(Math.ceil(o)-o)*p,_=(Math.floor(o)-o)*p;return new e(i,Math.floor(o),Math.ceil(u),p,a<0?c:_,a<0?_:c,a<0?s:i,a<0?i:s)},e.prototype.incrRow=function(){this.x+=this.invM},e.prototype.getLeftCol=function(){return Math.max(this.x+this.leftAdjust,this.leftBound)},e.prototype.getRightCol=function(){return Math.min(this.x+this.rightAdjust,this.rightBound)},e}(),l=[[0,0],[0,0],[0,0],[0,0]];return function(){function e(e,t){var r=this;this.tileInfo=e,this.fullExtent=t,this.scales=[],this._lodInfos=null,this._infoByScale={},this._infoByLevel={};var i=e.lods.slice();i.sort(function(e,t){return t.scale-e.scale});var o=this._lodInfos=i.map(function(r){return n.create(e,r,t)});i.forEach(function(e,t){r._infoByLevel[e.level]=o[t],r._infoByScale[e.scale]=o[t],r.scales[t]=e.scale},this),this._wrap=e.isWrappable}return Object.defineProperty(e.prototype,"spatialReference",{get:function(){return this.tileInfo.spatialReference},enumerable:!0,configurable:!0}),e.prototype.getLODInfoAt=function(e){return this._infoByLevel["number"==typeof e?e:e.level]},e.prototype.getTileBounds=function(e,t,r){void 0===r&&(r=!1),u.set(t);var n=this._infoByLevel[u.level];return n?n.getTileBounds(e,u,r):e},e.prototype.getTileCoords=function(e,t,r){void 0===r&&(r=!1),u.set(t);var n=this._infoByLevel[u.level];return n?n.getTileCoords(e,u,r):e},e.prototype.getTileCoverage=function(e,t,r){void 0===t&&(t=192),void 0===r&&(r="closest");var n,o,u,p="closest"===r?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),c=i.pool.acquire(p),_=this._wrap,h=1/0,f=-1/0,d=c.spans;l[0][0]=l[0][1]=l[1][1]=l[3][0]=-t,l[1][0]=l[2][0]=e.size[0]+t,l[2][1]=l[3][1]=e.size[1]+t;for(var y=0,g=l;y<g.length;y++){var v=g[y];e.toMap(v,v),v[0]=p.getColumnForX(v[0]),v[1]=p.getRowForY(v[1])}for(var m=[],E=3,P=0;P<4;P++)if(l[P][1]!==l[E][1]){var T=a.create(l[P],l[E]);h=Math.min(T.ymin,h),f=Math.max(T.ymax,f),void 0===m[T.ymin]&&(m[T.ymin]=[]),m[T.ymin].push(T),E=P}else E=P;if(null==h||null==f||f-h>100)return null;var I=[];for(n=h;n<f;){null!=m[n]&&(I=I.concat(m[n])),o=1/0,u=-1/0;for(P=I.length-1;P>=0;P--){T=I[P];o=Math.min(o,T.getLeftCol()),u=Math.max(u,T.getRightCol())}if(o=Math.floor(o),u=Math.floor(u),n>=p.first[1]&&n<=p.last[1])if(_)if(p.size[0]<p.worldSize[0]){var S=Math.floor(u/p.worldSize[0]);for(P=Math.floor(o/p.worldSize[0]);P<=S;P++)d.push(new s(n,Math.max(p.getFirstColumnForWorld(P),o),Math.min(p.getLastColumnForWorld(P),u)))}else d.push(new s(n,o,u));else o>p.last[0]||u<p.first[0]||(o=Math.max(o,p.first[0]),u=Math.min(u,p.last[0]),d.push(new s(n,o,u)));n+=1;for(P=I.length-1;P>=0;P--){(T=I[P]).ymax>=n?T.incrRow():I.splice(P,1)}}return c},e.prototype.getTileParentId=function(e){u.set(e);var t=this._infoByLevel[u.level],r=this._lodInfos.indexOf(t)-1;return r<0?null:(this._getTileIdAtLOD(u,this._lodInfos[r],u),u.id)},e.prototype.getTileResolution=function(e){var t=this._infoByLevel["object"==typeof e?e.level:e];return t?t.resolution:-1},e.prototype.getTileScale=function(e){var t=this._infoByLevel[e.level];return t?t.scale:-1},e.prototype.intersects=function(e,t){u.set(t);var r=this._infoByLevel[u.level],n=e.lodInfo;if(n.resolution>r.resolution){this._getTileIdAtLOD(u,n,u);for(var i=n.denormalizeCol(u.col,u.world),o=0,s=e.spans;o<s.length;o++){var a=s[o];if(a.row===u.row&&a.colFrom<=i&&a.colTo>=i)return!0}}if(n.resolution<r.resolution){var l=e.spans.reduce(function(e,t){return e[0]=Math.min(e[0],t.row),e[1]=Math.max(e[1],t.row),e[2]=Math.min(e[2],t.colFrom),e[3]=Math.max(e[3],t.colTo),e},[1/0,-1/0,1/0,-1/0]),p=l[0],c=l[1],_=l[2],h=l[3],f=r.denormalizeCol(u.col,u.world),d=n.getColumnForX(r.getXForColumn(f)),y=n.getRowForY(r.getYForRow(u.row)),g=n.getColumnForX(r.getXForColumn(f+1))-1,v=n.getRowForY(r.getYForRow(u.row+1))-1;return!(d>h||g<_||y>c||v<p)}var m=n.denormalizeCol(u.col,u.world);return e.spans.some(function(e){return e.row===u.row&&e.colFrom<=m&&e.colTo>=m})},e.prototype.normalizeBounds=function(e,t,n){if(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],this._wrap){var i=r.getInfo(this.tileInfo.spatialReference),o=-n*(i.valid[1]-i.valid[0]);e[0]+=o,e[2]+=o}return e},e.prototype.getSmallestInfoForScale=function(e){var t=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>t[0])return this._infoByScale[t[0]];for(var r=1;r<t.length-1;r++)if(e>t[r])return this._infoByScale[t[r-1]];return this._infoByScale[t[t.length-1]]},e.prototype.getClosestInfoForScale=function(e){var t=this.scales;return this._infoByScale[e]?this._infoByScale[e]:(e=t.reduce(function(t,r,n,i){return Math.abs(r-e)<Math.abs(t-e)?r:t},t[0]),this._infoByScale[e])},e.prototype.scaleToLevel=function(e){var t=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(var r=t.length-1;r>=0;r--)if(e<t[r]){return r===t.length-1?this._infoByScale[t[t.length-1]].level:this._infoByScale[t[r]].level+(t[r]-e)/(t[r]-t[r+1])}return this._infoByScale[t[0]].level},e.prototype.scaleToZoom=function(e){return this.tileInfo.scaleToZoom(e)},e.prototype._getTileIdAtLOD=function(e,t,r){var n=this._infoByLevel[r.level];return e.set(r),t.resolution<n.resolution?null:t.resolution===n.resolution?e:(e.level=t.level,e.col=Math.floor(r.col*n.resolution/t.resolution+.01),e.row=Math.floor(r.row*n.resolution/t.resolution+.01),e)},e}()}.apply(null,n))||(e.exports=i)},1528:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=new Float32Array(1),i=new Uint32Array(n.buffer),o=r.getLogger("esri.views.2d.engine.webgl.number");function s(e,t,r){var n=Math.max(Math.min(e,r),t);return n!==e&&o.warn("Value of "+e+" exceeded rendering limitations and was clamped to "+n),n}t.i8=function(e){return s(e,-128,127)},t.i16=function(e){return s(e,-32768,32767)},t.i32=function(e){return s(e,-2147483648,2147483647)},t.u8=function(e){return s(e,0,255)},t.u16=function(e){return s(e,0,65535)},t.u32=function(e){return s(e,0,4294967295)},t.nextHighestPowerOfTwo=function(e){var t=e;t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16;var r=++t>>1;return e-r<t-e?r:t},t.toUint32=function(e){return n[0]=e,i[0]},t.toFloat32=function(e){return i[0]=e,n[0]},t.i1616to32=function(e,t){return 65535&e|t<<16},t.i8888to32=function(e,t,r,n){return 255&e|(255&t)<<8|(255&r)<<16|n<<24},t.i8816to32=function(e,t,r){return 255&e|(255&t)<<8|r<<16},t.numTo32=function(e){return 0|e}}.apply(null,n))||(e.exports=i)},1530:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(355)],void 0===(i=function(e,t,r,n){function i(e,t){e.delete(t)}var o=new n(0,0,0,0),s=new Map,u=[],a=[];return function(){function e(e){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.resampling=null==e.resampling||!!e.resampling,e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),null!=e.buffer&&(this.buffer=e.buffer)}return e.prototype.destroy=function(){this.tileIndex.clear()},e.prototype.update=function(e){var t=this,r=this.resampling,n=this.tileIndex,l=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.coveragePolicy);if(a.length=0,u.length=0,s.clear(),l){var p=this.tileInfoView.tileInfo,c=p.minScale,_=p.maxScale,h=l.spans,f=l.lodInfo,d=f.level,y=e.state.scale,g=!e.stationary&&y>this._previousScale;if(this._previousScale=y,this.tiles.length=0,!r&&(y>c||y<_))return this.tiles.length=0,s.clear(),n.forEach(function(e){t.releaseTile(e)}),n.clear(),a.length=0,u.length=0,s.clear(),!0;n.forEach(function(e){return e.visible=!0});var v=0,m=0;if(h.length>0)for(var E=0,P=h;E<P.length;E++)for(var T=P[E],I=T.row,S=T.colFrom,O=T.colTo,w=S;w<=O;w++){v++;var C=o.set(d,I,f.normalizeCol(w),f.getWorldForColumn(w)).id;if(n.has(C)){(R=n.get(C)).isReady?(s.set(C,R),m++):g||this._addParentTile(C,s)}else{var R=this.acquireTile(o);this.tileIndex.set(C,R),g||this._addParentTile(C,s)}}var M=m===v;n.forEach(function(e,r){if(o.set(r),!s.has(r)){var n=t.tileInfoView.intersects(l,o);if(!n||!g&&M)if("purge"===t.cachePolicy){!(o.level!==d)&&n||u.push(r)}else(o.level>d||!n)&&u.push(r);else e.isReady?a.push(r):o.level>d&&u.push(r)}});for(var N=0,b=a;N<b.length;N++){C=b[N];(R=n.get(C))&&R.isReady&&s.set(C,R)}for(var F=0,L=u;F<L.length;F++){C=L[F],R=n.get(C);this.releaseTile(R),i(n,C)}return s.forEach(function(e){return t.tiles.push(e)}),n.forEach(function(e){s.has(e.key.id)||(e.visible=!1)}),M}},e.prototype.clear=function(){var e=this,t=this.tileIndex;t.forEach(function(t){e.releaseTile(t)}),t.clear()},e.prototype._addParentTile=function(e,t){for(var r=e,n=null;r=this.tileInfoView.getTileParentId(r);)if(this.tileIndex.has(r)&&(n=this.tileIndex.get(r))&&n.isReady){t.has(n.key.id)||t.set(n.key.id,n);break}},e}()}.apply(null,n))||(e.exports=i)},1537:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1528)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.white=[255,255,255,1];var n=[0,0,0,0];function i(e,t){return Array.isArray(t)?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]):(e[0]=t.r,e[1]=t.g,e[2]=t.b,e[3]=t.a),e}function o(e,t,r){void 0===t&&(t=0),void 0===r&&(r=!1);var n=e[t+3];return e[t+0]*=n,e[t+1]*=n,e[t+2]*=n,r||(e[t+3]*=255),e}t.premultiplyAlpha=o,t.copyAndPremultiply=function(e){return o(i([],e))},t.premultiplyAlphaUint32=function(e){return o(i(n,e)),r.i8888to32(n[0],n[1],n[2],n[3])},t.premultiplyAlphaRGBA=function(e){var t=e.r,n=e.g,i=e.b,o=e.a,s=t*o,u=n*o,a=i*o,l=255*o;return r.i8888to32(s,u,a,l)}}.apply(null,n))||(e.exports=i)},1545:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(97),r(355)],void 0===(i=function(e,t,r,n){function i(e,t){return[e,t]}function o(e,t,r){return e[0]=t,e[1]=r,e}var s=new n("0/0/0/0");return function(){function e(e,t,r,n,i,o,s,u,a,l,p,c){this.level=e,this.resolution=t,this.scale=r,this.origin=n,this.first=i,this.last=o,this.size=s,this.norm=u,this.worldStart=a,this.worldEnd=l,this.worldSize=p,this.wrap=c}return e.create=function(t,n,s){var u,a,l,p,c=r.getInfo(t.spatialReference),_=i(t.origin.x,t.origin.y),h=i(t.size[0]*n.resolution,t.size[1]*n.resolution),f=i(-1/0,-1/0),d=i(1/0,1/0),y=i(1/0,1/0);return s&&(o(f,Math.max(0,Math.floor((s.xmin-_[0])/h[0])),Math.max(0,Math.floor((_[1]-s.ymax)/h[1]))),o(d,Math.max(0,Math.floor((s.xmax-_[0])/h[0])),Math.max(0,Math.floor((_[1]-s.ymin)/h[1]))),o(y,d[0]-f[0]+1,d[1]-f[1]+1)),t.isWrappable?(u=i(Math.ceil(Math.round(2*c.origin[1]/n.resolution)/t.size[0]),y[1]),a=i(Math.floor((c.origin[0]-_[0])/h[0]),f[1]),l=i(u[0]+a[0]-1,d[1]),p=!0):(a=f,l=d,u=y,p=!1),new e(n.level,n.resolution,n.scale,_,f,d,y,h,a,l,u,p)},e.prototype.normalizeCol=function(e){if(!this.wrap)return e;var t=this.worldSize[0];return e<0?t-1-Math.abs((e+1)%t):e%t},e.prototype.denormalizeCol=function(e,t){return this.wrap?this.worldSize[0]*t+e:e},e.prototype.getWorldForColumn=function(e){return this.wrap?Math.floor(e/this.worldSize[0]):0},e.prototype.getFirstColumnForWorld=function(e){return e*this.worldSize[0]+this.first[0]},e.prototype.getLastColumnForWorld=function(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1},e.prototype.getColumnForX=function(e){return(e-this.origin[0])/this.norm[0]},e.prototype.getXForColumn=function(e){return this.origin[0]+e*this.norm[0]},e.prototype.getRowForY=function(e){return(this.origin[1]-e)/this.norm[1]},e.prototype.getYForRow=function(e){return this.origin[1]-e*this.norm[1]},e.prototype.getTileBounds=function(e,t,r){void 0===r&&(r=!1),s.set(t);var n=r?s.col:this.denormalizeCol(s.col,s.world),i=s.row;return function(e,t,r,n,i){e[0]=t,e[1]=r,e[2]=n,e[3]=i}(e,this.getXForColumn(n),this.getYForRow(i+1),this.getXForColumn(n+1),this.getYForRow(i)),e},e.prototype.getTileCoords=function(e,t,r){void 0===r&&(r=!1),s.set(t);var n=r?s.col:this.denormalizeCol(s.col,s.world);return Array.isArray(e)?o(e,this.getXForColumn(n),this.getYForRow(s.row)):(e.x=this.getXForColumn(n),e.y=this.getYForRow(s.row)),e},e}()}.apply(null,n))||(e.exports=i)},1546:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(216),r(80),r(1520)],void 0===(i=function(e,t,r,n,i){return function(){function e(e){this.lodInfo=e,this.spans=r.acquire()}return e.prototype.release=function(){for(var e=0,t=this.spans;e<t.length;e++){var n=t[e];i.pool.release(n)}r.release(this.spans)},e.prototype.forEach=function(e,t){var r=this.spans,n=this.lodInfo,i=n.level;if(0!==r.length)for(var o=0,s=r;o<s.length;o++)for(var u=s[o],a=u.row,l=u.colFrom,p=u.colTo,c=l;c<=p;c++)e.call(t,i,a,n.normalizeCol(c),n.getWorldForColumn(c))},e.pool=new n(e,!0),e}()}.apply(null,n))||(e.exports=i)},1547:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(6),r(0),r(40),r(1552)],void 0===(i=function(e,t,r,n,i,o,s,u){var a=new Set,l=[],p=new Map,c=[0,0];return function(e){function t(t){var r=e.call(this,t)||this;return r._keysToRequests=new Map,r.concurrency=6,r.process=null,r.strategy="scale-first",r.tileInfoView=null,r.tileServers=null,r}return r(t,e),t.prototype.initialize=function(){var e=this,t="scale-first"===this.strategy?this._peekByScaleFirst.bind(this):this._peekByCenterFirst.bind(this),r=this,n=r.tileServers,i=r.concurrency,o=r.process;n&&n.length>0?this._queues=n.map(function(r){return new u({concurrency:i,process:function(t){var n=e._keysToRequests.get(t);return o(n,r)},peeker:t})}):this._queues=[new u({concurrency:i,process:function(t){var r=e._keysToRequests.get(t);return o(r)},peeker:t})]},t.prototype.destroy=function(){this.clear();for(var e=0,t=this._queues;e<t.length;e++)t[e].destroy();this._queues=null},Object.defineProperty(t.prototype,"length",{get:function(){return this._queues.reduce(function(e,t){return e+t.length},0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onGoingCount",{get:function(){return this._keysToRequests.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.length>0||this.onGoingCount>0},enumerable:!0,configurable:!0}),t.prototype.clear=function(){for(var e=0,t=this._queues;e<t.length;e++)t[e].clear();this._keysToRequests.clear(),this.notifyChange("updating")},t.prototype.find=function(e,t){for(var r=this,n=0,i=this._queues;n<i.length;n++){var o=i[n].find(function(t){return e(r._keysToRequests.get(t).key)});if(o)return o}},t.prototype.getPromise=function(e){for(var t="string"==typeof e?e:e.id,r=0,n=this._queues;r<n.length;r++){var i=n[r].get(t);if(i)return i}},t.prototype.getRequest=function(e){var t="string"==typeof e?e:e.id;return this._keysToRequests.get(t)},t.prototype.has=function(e){return"string"==typeof e?this._keysToRequests.has(e):this._keysToRequests.has(e.id)},t.prototype.isOngoing=function(e){var t="string"==typeof e?e:e.id;return this.has(t)&&this._queues.some(function(e){return e.isOngoing(t)})},t.prototype.pause=function(){for(var e=0,t=this._queues;e<t.length;e++)t[e].pause()},t.prototype.push=function(e){var t=this,r=e.key.id;if(this.has(r))return this.getPromise(r);var n=this._queues[e.key.row%this._queues.length].push(r),i=function(){t._keysToRequests.delete(r),t.notifyChange("updating")};return this._keysToRequests.set(r,e),n.then(i,i),this.notifyChange("updating"),n},t.prototype.reset=function(){for(var e=0,t=this._queues;e<t.length;e++)t[e].reset();this.notifyChange("updating")},t.prototype.resume=function(){for(var e=0,t=this._queues;e<t.length;e++)t[e].resume()},t.prototype._peekByScaleFirst=function(e){if(!this.state)return e[0];for(var t=this.tileInfoView,r=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,i=0,o=e;i<o.length;i++){var s=o[i],u=this._keysToRequests.get(s),c=this.tileInfoView.getTileScale(u.key);p.has(c)||(p.set(c,[]),r=Math.max(c,r),n=Math.min(c,n)),p.get(c).push(u.key),a.add(c)}var _=this.state.scale;p.has(_)||(function(e,t){e.length=0,t.forEach(function(t){return e.push(t)})}(l,a),l.sort(),_=l.reduce(function(e,t,r,n){return Math.abs(t-_)<Math.abs(e-_)?t:e},l[0])),_=Math.min(_,r),_=Math.max(_,n);var h=p.get(_),f=t.getClosestInfoForScale(_),d=f.getColumnForX(this.state.center[0]),y=f.getRowForY(this.state.center[1]);return h.sort(function(e,t){var r=f.denormalizeCol(e.col,e.world),n=f.denormalizeCol(t.col,t.world);return Math.sqrt((d-r)*(d-r)+(y-e.row)*(y-e.row))-Math.sqrt((d-n)*(d-n)+(y-t.row)*(y-t.row))}),a.clear(),p.clear(),h[0].id},t.prototype._peekByCenterFirst=function(e){if(!this.state)return e[0];for(var t=this.tileInfoView,r=this.state.center,n=Number.POSITIVE_INFINITY,i=null,o=0,u=e;o<u.length;o++){var a=u[o],l=this._keysToRequests.get(a);t.getTileCoords(c,l.key);var p=s.vec2.distance(c,r);p<n&&(n=p,i=l.key)}return i.id},n([o.property({constructOnly:!0})],t.prototype,"concurrency",void 0),n([o.property({constructOnly:!0})],t.prototype,"process",void 0),n([o.property()],t.prototype,"state",void 0),n([o.property({constructOnly:!0})],t.prototype,"strategy",void 0),n([o.property({constructOnly:!0})],t.prototype,"tileInfoView",void 0),n([o.property({constructOnly:!0})],t.prototype,"tileServers",void 0),n([o.property({readOnly:!0})],t.prototype,"updating",null),n([o.subclass()],t)}(o.declared(i))}.apply(null,n))||(e.exports=i)},1552:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(32),r(8),r(1562),r(57)],void 0===(i=function(e,t,r,n,i,o){return function(){function e(e){var t=this;this._apiPromises=new Map,this._processingItems=new Map,this._isPaused=!1,this._schedule=null,this._task=null,this._pendingProcessing=0,this.concurrency=1,this.ordered=!1,e.concurrency&&(this.concurrency=e.concurrency),e.ordered&&(this.ordered=!0,this._itemsToProcess=[]),this._queue=new i({peeker:e.peeker}),this.process=e.process;var r=e.scheduler;e.priority&&r&&(this._task=r.registerTask(e.priority,function(e){return t.update(e)},function(){return t.needsUpdate()}))}return e.prototype.destroy=function(){this.clear(),this._schedule&&(this._schedule.remove(),this._schedule=null),this._task&&(this._task.remove(),this._task=null)},Object.defineProperty(e.prototype,"length",{get:function(){return this._processingItems.size+this._queue.length+this._pendingProcessing},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._queue.clear();var e=[];this._processingItems.forEach(function(t){return e.push(t.resultPromise)}),this._processingItems.clear(),e.forEach(function(e){return e.cancel()}),e.length=0,this._apiPromises.forEach(function(t){return e.push(t)}),this._apiPromises.clear(),e.forEach(function(e){return e.cancel()}),this._cancelNext()},e.prototype.find=function(e,t){var r=this,n=void 0;return this._apiPromises.forEach(function(i,o){e.call(t,o)&&(n=r._apiPromises.get(o).promise)}),n},e.prototype.get=function(e){var t=this._apiPromises.get(e);return t&&t.promise||void 0},e.prototype.isOngoing=function(e){return this._processingItems.has(e)},e.prototype.has=function(e){return this._apiPromises.has(e)},e.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},e.prototype.push=function(e){var t=this;if(this._apiPromises.has(e))return this._apiPromises.get(e).promise;var r=n.createDeferred(function(r){var n=t._processingItems.get(e);n?n.resultPromise.cancel(r):(t._remove(e),t._scheduleNext())});return this._add(e,r),this._scheduleNext(),r.promise},e.prototype.reset=function(){var e=[];this._processingItems.forEach(function(t){return e.push(t)}),this._processingItems.clear();for(var t=0,r=e;t<r.length;t++){var n=r[t];n.resultPromise.isFulfilled()?this._processReset(n):(n.isReset=!0,n.resultPromise.cancel())}},e.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())},e.prototype.needsUpdate=function(){return!this._isPaused&&this._queue.length>0&&this._processingItems.size<this.concurrency},e.prototype.update=function(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()},e.prototype._scheduleNext=function(){var e=this;this._task||this._isPaused||this._schedule||(this._schedule=o.schedule(function(){e._schedule=null,e._next()}))},e.prototype._next=function(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())},e.prototype._cancelNext=function(){this._schedule&&(this._schedule.remove(),this._schedule=null)},e.prototype._processResult=function(e,t){this._remove(e.item),this._scheduleNext(),e.dfd.resolve(t)},e.prototype._processError=function(e,t){e.isReset?this._processReset(e):(this._remove(e.item),this._scheduleNext(),e.dfd.reject(t))},e.prototype._processReset=function(e){this._remove(e.item),this._add(e.item,e.dfd),this._scheduleNext()},e.prototype._processOrdered=function(e,t){var r=this;if(e.isReset)this._processReset(e);else{e.result=t;var n=!1;this._processingItems.forEach(function(e){n||(e.result?r._itemsToProcess.push(e):n=!0)});for(var i=0,o=this._itemsToProcess;i<o.length;i++){var s=o[i];!1===s.result.ok?this._processError(s,s.result.error):this._processResult(s,s.result.value)}this._itemsToProcess.length=0}},e.prototype._process=function(e){var t=this;if(!r.isNone(e)){var n=this._apiPromises.get(e);this._pendingProcessing++;var i=this.process(e);if(this._pendingProcessing--,function(e){return e&&"function"==typeof e.then}(i)){var o={item:e,resultPromise:i,result:null,dfd:n,isReset:!1};this._processingItems.set(e,o),this.ordered?i.then(function(e){return t._processOrdered(o,{ok:!0,value:e})},function(e){return t._processOrdered(o,{ok:!1,error:e})}):i.then(function(e){return t._processResult(o,e)},function(e){return t._processError(o,e)})}else n.resolve(i),this._remove(e)}},e.prototype._add=function(e,t){this._apiPromises.set(e,t),this._queue.push(e)},e.prototype._remove=function(e){this._queue.remove(e),this._apiPromises.delete(e),this._processingItems.delete(e)},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{update:function(t){return e.update(t)}}},enumerable:!0,configurable:!0}),e}()}.apply(null,n))||(e.exports=i)},1562:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(e){this._items=[],this._itemSet=new Set,this._peeker=function(e){return e[0]},this._length=0,e&&e.peeker&&(this._peeker=e.peeker)}return Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._itemSet.clear(),this._items.length=0,this._length=0},e.prototype.peek=function(){if(0!==this._length)return this._peeker(this._items)},e.prototype.push=function(e){this.contains(e)||this._add(e)},e.prototype.contains=function(e){return this._length>0&&this._itemSet.has(e)},e.prototype.pop=function(){if(0!==this._length){var e=this.peek();return this._remove(e),e}},e.prototype.remove=function(e){this.contains(e)&&this._remove(e)},e.prototype._add=function(e){this._items.push(e),this._itemSet.add(e),this._length++},e.prototype._remove=function(e){this._itemSet.delete(e),this._items.splice(this._items.indexOf(e),1),this._length--},e}()}.apply(null,n))||(e.exports=i)},1600:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1527),r(355),r(1547),r(1530)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0}),t.TileInfoView=r,t.TileKey=n,t.TileQueue=i,t.TileStrategy=o}.apply(null,n))||(e.exports=i)},1618:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(1664),r(34),r(1665)],void 0===(i=function(e,t,n,i,o,s){function u(e,t,r,n,i){if(void 0===n&&(n=null),void 0===i&&(i=!1),null===n){var u=s.cacheKey(t,r);void 0!==c[u]?n=c[u]:(null===(n=a(t,r,null))&&(n=new s),c[u]=n)}return l._project(e,t,r instanceof o||!1===i?r:new o(r),n,i)}function a(e,t,r){void 0===r&&(r=null);var n=l._getTransformation(e,t,r);return null!==n?s.fromGE(n):null}Object.defineProperty(t,"__esModule",{value:!0});var l=null;t.isLoaded=function(){return!!l&&i.isLoaded()},t.isSupported=function(){return i.isSupported()};var p=null;t.load=function(){return p||(p=n.create(function(e,t){var n=i.load();Promise.resolve().then(function(){var o=[r(179)];(function(r){l=r,n.then(function(){l._enableProjection(i),e()},function(e){t(e)})}).apply(null,o)}).catch(r.oe)}))},t.project=function(e,t,r){return void 0===r&&(r=null),e instanceof Array?0===e.length?[]:u(e,e[0].spatialReference,t,r):u([e],e.spatialReference,t,r)[0]};var c={};t.projectMany=u,t.getTransformation=a,t.getTransformations=function(e,t,r){void 0===r&&(r=null);var n=l._getTransformationBySuitability(e,t,r);if(null!==n){for(var i=[],o=0,u=n;o<u.length;o++){var a=u[o];i.push(s.fromGE(a))}return i}return[]}}.apply(null,n))||(e.exports=i)},1620:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(80)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.color=[0,0,0,0],this.haloColor=[0,0,0,0],this.haloSize=0,this.size=12,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}return e.prototype.acquire=function(e,t,r,n,i,o,s,u,a){this.color=e,this.haloColor=t,this.haloSize=r,this.size=n,this.angle=i,this.offsetX=o,this.offsetY=s,this.hAnchor=u,this.vAnchor=a},e.prototype.release=function(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0,this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0,this.haloSize=0,this.size=0,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0},e.pool=new r(e),e}();t.TextProperties=n}.apply(null,n))||(e.exports=i)},1630:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(6),r(7),r(0),r(357),r(128)],void 0===(i=function(e,t,r,n,i,o,s,u,a){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var i;return r(t,e),i=t,t.fromWorker=function(e){if(!e)return null;var t=JSON.parse(e),r=new i;return r.fields=t.fields&&t.fields.map(function(e){return u.fromJSON(e)}),r.options=t.options,r.process=new(Function.bind.apply(Function,[void 0].concat(t.process.args,[t.process.body]))),r},Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new i(o.clone({fields:this.fields,options:this.options,process:this.process}))},t.prototype.getField=function(e){return a.getField(this.fields,e)},t.prototype.refresh=function(){this.notifyChange("version")},t.prototype.toWorker=function(){var e=this.process.toString();return JSON.stringify({fields:this.fields,options:this.options,process:{body:e.substring(e.indexOf("{")+1,e.lastIndexOf("}")),args:e.slice(e.indexOf("(")+1,e.indexOf(")")).match(/([^\s,]+)/g)}})},n([s.property({type:[u]})],t.prototype,"fields",void 0),n([s.property()],t.prototype,"options",void 0),n([s.property()],t.prototype,"process",void 0),n([s.property({readOnly:!0,dependsOn:["process","options","fields"]})],t.prototype,"version",null),i=n([s.subclass("esri.layers.support.FeatureProcessing")],t)}(s.declared(i))}.apply(null,n))||(e.exports=i)},1647:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(22),r(25),r(2),r(6),r(13),r(1509),r(10),r(32),r(0),r(1648),r(1568),r(1512)],void 0===(i=function(e,t,r,n,i,o,s,u,a,l,p,c,_,h,f){Object.defineProperty(t,"__esModule",{value:!0});var d=l.getLogger("esri.views.2d.layers.features.controllers.BaseController"),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.configuration=null,t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t.filters=new Array(f.MAX_FILTERS),t}return o(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])},t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),t.prototype.setFilterBase=function(e,t){return i(this,void 0,void 0,function(){var r,i,o,s;return n(this,function(n){switch(n.label){case 0:return[4,this._getFilter(e)];case 1:return r=n.sent(),[4,h.normalizeFilter(t,null,this.spatialReference)];case 2:return i=n.sent(),this.configuration.filter=i,i?[4,r.update(i)]:[2,r.clear()];case 3:n.sent(),n.label=4;case 4:return n.trys.push([4,6,,7]),[4,this.queryObjectIds(r.createQuery().toJSON())];case 5:return o=n.sent(),[2,r.setTrue(o)];case 6:return s=n.sent(),d.error(new u("featurelayer-controller:query-filter-error","An error occurred while executing the query",{error:s})),[2,{show:[],hide:[]}];case 7:return[2]}})})},t.prototype.enableEvent=function(e){},t.prototype._getFilter=function(e){return i(this,void 0,void 0,function(){var t,r,i;return n(this,function(n){switch(n.label){case 0:return t=this.filters[e],p.isSome(t)?[2,t]:(r=new _.default({geometryType:this.service.geometryType,hasM:!1,hasZ:!1,timeInfo:this.service.timeInfo}),this.filters[e]=r,[4,this.queryObjectIds({})]);case 1:return i=n.sent(),r.setKnownIds(i),[2,r]}})})},t.prototype._getFilterFlags=function(e){for(var t=0,r=0;r<this.filters.length;r++){var n=this.filters[r];t|=(p.isNone(n)||n.check(e)?1:0)<<r}return t},t.prototype.hasGeometryFilter=function(){return this.filters.some(function(e){return p.isSome(e)&&!!e.geometry})},r([c.property()],t.prototype,"configuration",void 0),r([c.property()],t.prototype,"processor",void 0),r([c.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r([c.property({constructOnly:!0})],t.prototype,"service",void 0),r([c.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r([c.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r([c.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r([c.property()],t.prototype,"filters",void 0),r([c.subclass()],t)}(c.declared(s,a));t.default=y}.apply(null,n))||(e.exports=i)},1648:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(25),r(11),r(22),r(173),r(13),r(10),r(32),r(8),r(37),r(550),r(1560),r(1612),r(1598),r(356)],void 0===(i=function(e,t,r,n,i,o,s,u,a,l,p,c,_,h,f,d){Object.defineProperty(t,"__esModule",{value:!0});var y=u.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter"),g=1,v=2,m=function(){function e(e){var t=this;this._geometryBounds=p.create(),this._idToVisibility=new Map,this.check=function(e){var r=e.objectId,n=t._idToVisibility,i=t._applyFilter(e);return n.set(r,i?g|v:v),!!(n.get(r)&g)},this._serviceInfo=e}return e.prototype.clear=function(){var e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}},e.prototype.invalidate=function(){var e=this;this._idToVisibility.forEach(function(t,r){e._idToVisibility.set(r,0)})},e.prototype.setKnownIds=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];this._idToVisibility.set(n,g)}},e.prototype.setTrue=function(e){var t=this,r=[],n=[],i=new o.default(e);return this._idToVisibility.forEach(function(e,o){var s=!!(t._idToVisibility.get(o)&g),u=i.has(o);!s&&u?r.push(o):s&&!u&&n.push(o),t._idToVisibility.set(o,u?g|v:0)}),{show:r,hide:n}},e.prototype.createQuery=function(){var e=this,t=e.geometry,r=e.spatialRel,n=e.where,i=e.distance,o=e.units,s=e.timeExtent,u=e.objectIds;return d.fromJSON({geometry:t,spatialRel:r,where:n,distance:i,units:o,timeExtent:s,objectIds:u})},e.prototype.update=function(e){return void 0===e&&(e=null),r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,l.all([this._setGeometryFilter(e),this._setIdFilter(e),this._setAttributeFilter(e),this._setTimeFilter(e)])];case 1:return t.sent(),[2]}})})},e.prototype._setAttributeFilter=function(e){if(!e||!e.where)return this._clause=null,void(this.where=null);var t=_.getWhereClause(e.where);if(t.isStandardized())this._clause=t;else{var r=new s("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",t);y.error(r)}this.where=e.where},e.prototype._setIdFilter=function(e){this._idsToShow=e&&e.objectIds&&new o.default(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new o.default(e.hiddenIds),this.objectIds=e&&e.objectIds},e.prototype._setGeometryFilter=function(e){return r(this,void 0,void 0,function(){var t,r,n;return i(this,function(i){switch(i.label){case 0:return e&&e.geometry?(t=e.geometry,r=e.spatialRel||"esriSpatialRelIntersects",[4,h.getSpatialQueryOperator(r,t,this._serviceInfo)]):(this._spatialQueryOperator=null,this.geometry=null,this.spatialRel=null,[2]);case 1:return n=i.sent(),c.getBoundsXY(this._geometryBounds,t),this._spatialQueryOperator=n,this.geometry=t,this.spatialRel=r,[2]}})})},e.prototype._setTimeFilter=function(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent){if(!this._serviceInfo.timeInfo){var t=new s("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);return void y.error(t)}this.timeExtent=e.timeExtent,this._timeOperator=f.getTimeOperator(this._serviceInfo.timeInfo,e.timeExtent)}},e.prototype._applyFilter=function(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)},e.prototype._filterByExpression=function(e){return!this.where||this._clause.testFeature(e.attributes)},e.prototype._filterById=function(e){return(!this._idsToHide||!this._idsToHide.has(e.objectId))&&(!this._idsToShow||this._idsToShow.has(e.objectId))},e.prototype._filterByGeometry=function(e){return!this.geometry||!!this._earlyGeometryReject(e)&&this._spatialQueryOperator(e.geometry)},e.prototype._filterByTime=function(e){return!a.isSome(this._timeOperator)||this._timeOperator(e)},e.prototype._earlyGeometryReject=function(e){return!(!e.geometry||!e.geometry.coords.length)&&(!e.centroid||"esriSpatialRelContains"!==this.spatialRel||p.containsPoint(this._geometryBounds,e.centroid.coords))},e.prototype._resetAllHiddenIds=function(){var e=this,t=[];return this._idToVisibility.forEach(function(r,n){r&g||(e._idToVisibility.set(n,g),t.push(n))}),t},e}();t.default=m}.apply(null,n))||(e.exports=i)},1664:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(19),r(8)],void 0===(i=function(e,t,n,i,o){function s(e){function r(e,t,r){e[t]=r(e[t])}t._pe=e,_.init(),h.init(),f.init(),d.init(),y.init(),t.PeGCSExtent=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return n(r,e),r.prototype.destroy=function(){t._pe.destroy(this)},r}(t._pe.PeGCSExtent);for(var i=0,o=[t._pe.PeDatum,t._pe.PeGeogcs,t._pe.PeGeogtran,t._pe.PeObject,t._pe.PeParameter,t._pe.PePrimem,t._pe.PeProjcs,t._pe.PeSpheroid,t._pe.PeUnit];i<o.length;i++){r(o[i].prototype,"getName",function(e){return function(){return e.call(this,new Array(_.PE_NAME_MAX))}})}for(var s=0,u=[t._pe.PeGeogtran,t._pe.PeProjcs];s<u.length;s++){r(u[s].prototype,"getParameters",function(e){return function(){for(var r=new Array(_.PE_PARM_MAX),n=e.call(this),i=0;i<r.length;i++){var o=t._pe.getValue(n,"*");r[i]=o?t._pe.wrapPointer(o,t._pe.PeParameter):null,n+=Int32Array.BYTES_PER_ELEMENT}return r}})}r(t._pe.PeHorizon.prototype,"getCoord",function(e){return function(){var t=this.getSize();if(!t)return null;var r=[];return p(r,t,e.call(this)),r}}),r(t._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(e){var r=t._pe._pe_getPeGTlistExtendedGTsSize();return function(){var n=null,i=e.call(this);if(!t._pe.compare(i,t._pe.NULL)){n=[i];var o=this.getSteps();if(o>1)for(var s=t._pe.getPointer(i),u=1;u<o;u++)n.push(t._pe.wrapPointer(s+r*u,t._pe.PeGTlistExtendedGTs))}return n}});var a=t._pe._pe_getPeHorizonSize(),l=function(e){return function(){var r=this._cache;if(r||(r=new Map,this._cache=r),r.has(e))return r.get(e);var n=null,i=e.call(this);if(!t._pe.compare(i,t._pe.NULL)){n=[i];var o=i.getNump();if(o>1)for(var s=t._pe.getPointer(i),u=1;u<o;u++)n.push(t._pe.wrapPointer(s+a*u,t._pe.PeHorizon))}return r.set(e,n),n}};r(t._pe.PeProjcs.prototype,"horizonGcsGenerate",l),r(t._pe.PeProjcs.prototype,"horizonPcsGenerate",l),t._pe.PeObject.prototype.toString=function(e){void 0===e&&(e=_.PE_STR_OPTS_NONE),t._pe.ensureCache.prepare();var r=t._pe.getPointer(this),n=t._pe.ensureInt8(new Array(_.PE_BUFFER_MAX));return t._pe.Pointer_stringify(t._pe._pe_object_to_string_ext(r,e,n))}}function u(e){if(e){var r=t._pe.getClass(e);if(r){var n=t._pe.getCache(r);if(n){var i=t._pe.getPointer(e);i&&delete n[i]}}}}function a(e,r){for(var n=[],i=new Array(r),o=0;o<e;o++)n.push(t._pe.ensureInt8(i));return n}function l(e){var t;return Array.isArray(e[0])?(t=[],e.forEach(function(e){t.push(e[0],e[1])})):t=e,t}function p(e,r,n,i){if(void 0===i&&(i=!1),i)for(var o=0;o<2*r;o++)e[o]=t._pe.getValue(n+o*Float64Array.BYTES_PER_ELEMENT,"double");else{var s=0===e.length;for(o=0;o<r;o++)s&&(e[o]=new Array(2)),e[o][0]=t._pe.getValue(n,"double"),e[o][1]=t._pe.getValue(n+Float64Array.BYTES_PER_ELEMENT,"double"),n+=2*Float64Array.BYTES_PER_ELEMENT}}var c,_,h,f,d,y;Object.defineProperty(t,"__esModule",{value:!0}),t._pe=null,t.isLoaded=function(){return!!t._pe},t.isSupported=function(){return!!i("esri-wasm")},t.load=function(){return c||(c=o.create(function(t,n){r.e(75).then(function(){var i=[r(1794)];(function(r){r({locateFile:function(t){return e.toUrl("./support/"+t)},onAbort:function(e){n(new Error(e))}}).then(function(e){s(e),t()})}).apply(null,i)}).catch(r.oe)}))},function(e){function r(e,r,n){t._pe.ensureCache.prepare();var i=l(n),o=n===i,s=t._pe.ensureFloat64(i),u=t._pe._pe_geog_to_proj(t._pe.getPointer(e),r,s);return u&&p(n,r,s,o),u}function n(e,t,r){return i(e,t,r,0)}function i(e,r,n,i){t._pe.ensureCache.prepare();var o=l(n),s=n===o,u=t._pe.ensureFloat64(o),a=t._pe._pe_proj_to_geog_center(t._pe.getPointer(e),r,u,i);return a&&p(n,r,u,s),a}e.geogToProj=r,e.projGeog=function(e,t,i,o){switch(o){case _.PE_TRANSFORM_P_TO_G:return n(e,t,i);case _.PE_TRANSFORM_G_TO_P:return r(e,t,i)}return 0},e.projToGeog=n,e.projToGeogCenter=i}(t.PeCSTransformations||(t.PeCSTransformations={})),function(e){e.init=function(){e.PE_BUFFER_MAX=t._pe.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=t._pe.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=t._pe.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=t._pe.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=t._pe.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=t._pe.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=t._pe.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=t._pe.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=t._pe.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=t._pe.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=t._pe.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=t._pe.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=t._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=t._pe.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=t._pe.PeDefs.prototype.PE_TYPE_UNIT,e.PE_STR_OPTS_NONE=t._pe.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=t._pe.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=t._pe.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=t._pe.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=t._pe.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=t._pe.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=t._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=t._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=t._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=t._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=t._pe.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=t._pe.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=t._pe.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=t._pe.PeDefs.prototype.PE_HORIZON_DELTA}}(_=t.PeDefs||(t.PeDefs={})),function(e){function r(e,r){var o=null,s=i[e];if(s||(s={},i[e]=s),s.hasOwnProperty(String(r)))o=s[r];else{var u=t._pe.PeFactory.prototype.factoryByType(e,r);t._pe.compare(u,t._pe.NULL)||(o=u,s[r]=o)}return n(o)}function n(e){if(e){var r=e.getType();switch(r){case _.PE_TYPE_GEOGCS:e=t._pe.castObject(e,t._pe.PeGeogcs);break;case _.PE_TYPE_PROJCS:e=t._pe.castObject(e,t._pe.PeProjcs);break;case _.PE_TYPE_GEOGTRAN:e=t._pe.castObject(e,t._pe.PeGeogtran);break;default:r&_.PE_TYPE_UNIT&&(e=t._pe.castObject(e,t._pe.PeUnit))}}return e}var i={},o={};e.initialize=function(){t._pe.PeFactory.prototype.initialize(null)},e.coordsys=function(e){return r(_.PE_TYPE_COORDSYS,e)},e.factoryByType=r,e.fromString=function(e,r){var i=null,s=o[e];if(s||(s={},o[e]=s),s.hasOwnProperty(r))i=s[r];else{var u=t._pe.PeFactory.prototype.fromString(e,r);t._pe.compare(u,t._pe.NULL)||(i=u,s[r]=i)}return n(i)},e.geogcs=function(e){return r(_.PE_TYPE_GEOGCS,e)},e.geogtran=function(e){return r(_.PE_TYPE_GEOGTRAN,e)},e.getCode=function(e){return t._pe.PeFactory.prototype.getCode(e)},e.projcs=function(e){return r(_.PE_TYPE_PROJCS,e)},e.unit=function(e){return r(_.PE_TYPE_UNIT,e)}}(t.PeFactory||(t.PeFactory={})),t.PeGCSExtent=null,function(e){var r;e.init=function(){e.PE_GTLIST_OPTS_COMMON=t._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,r=t._pe._pe_getPeGTlistExtendedEntrySize()},e.getGTlist=function(e,n,i,o,s,u){var a=null,l=new t._pe.PeInteger(u);try{var p=t._pe.PeGTlistExtended.prototype.getGTlist(e,n,i,o,s,l);if((u=l.val)&&(a=[p],u>1))for(var c=t._pe.getPointer(p),_=1;_<u;_++)a.push(t._pe.wrapPointer(c+r*_,t._pe.PeGTlistExtendedEntry))}finally{t._pe.destroy(l)}return a}}(h=t.PeGTlistExtended||(t.PeGTlistExtended={})),function(e){(t.PeGTlistExtendedEntry||(t.PeGTlistExtendedEntry={})).destroy=function(e){if(e&&e.length){for(var r=0,n=e;r<n.length;r++){var i=n[r];u(i),i.getEntries().forEach(function(e){u(e);var t=e.getGeogtran();u(t),t.getParameters().forEach(u),[t.getGeogcs1(),t.getGeogcs2()].forEach(function(e){u(e);var t=e.getDatum();u(t),u(t.getSpheroid()),u(e.getPrimem()),u(e.getUnit())})})}t._pe.PeGTlistExtendedEntry.prototype.Delete(e[0])}}}(),function(e){(t.PeGTTransformations||(t.PeGTTransformations={})).geogToGeog=function(e,r,n,i,o){t._pe.ensureCache.prepare();var s=l(n),u=n===s,a=t._pe.ensureFloat64(s),c=0;i&&(c=t._pe.ensureFloat64(i));var _=t._pe._pe_geog_to_geog(t._pe.getPointer(e),r,a,c,o);return _&&p(n,r,a,u),_}}(),function(e){function r(e,r,n,i,o,s){var u,p;switch(t._pe.ensureCache.prepare(),e){case"dd":u=t._pe._pe_geog_to_dd,p=_.PE_DD_MAX;break;case"ddm":u=t._pe._pe_geog_to_ddm,p=_.PE_DDM_MAX;break;case"dms":u=t._pe._pe_geog_to_dms,p=_.PE_DMS_MAX}var c=0;r&&(c=t._pe.getPointer(r));var h=l(i),f=t._pe.ensureFloat64(h),d=a(n,p),y=u(c,n,f,o,t._pe.ensureInt32(d));if(y)for(var g=0;g<n;g++)s[g]=t._pe.Pointer_stringify(d[g]);return y}function n(e,r,n,i,o){var s;switch(t._pe.ensureCache.prepare(),e){case"dd":s=t._pe._pe_dd_to_geog;break;case"ddm":s=t._pe._pe_ddm_to_geog;break;case"dms":s=t._pe._pe_dms_to_geog}var u=0;r&&(u=t._pe.getPointer(r));var a=i.map(function(e){return t._pe.ensureString(e)}),l=t._pe.ensureInt32(a),c=t._pe.ensureFloat64(new Array(2*n)),_=s(u,n,l,c);return _&&p(o,n,c),_}e.geog_to_dms=function(e,t,n,i,o){return r("dms",e,t,n,i,o)},e.dms_to_geog=function(e,t,r,i){return n("dms",e,t,r,i)},e.geog_to_ddm=function(e,t,n,i,o){return r("ddm",e,t,n,i,o)},e.ddm_to_geog=function(e,t,r,i){return n("ddm",e,t,r,i)},e.geog_to_dd=function(e,t,n,i,o){return r("dd",e,t,n,i,o)},e.dd_to_geog=function(e,t,r,i){return n("dd",e,t,r,i)}}(t.PeNotationDms||(t.PeNotationDms={})),function(e){e.init=function(){e.PE_MGRS_STYLE_NEW=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=t._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=t._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES},e.geog_to_mgrs_extended=function(e,r,n,i,o,s,u){t._pe.ensureCache.prepare();var p=0;e&&(p=t._pe.getPointer(e));var c=l(n),h=t._pe.ensureFloat64(c),f=a(r,_.PE_MGRS_MAX),d=t._pe.ensureInt32(f),y=t._pe._pe_geog_to_mgrs_extended(p,r,h,i,o,s,d);if(y)for(var g=0;g<r;g++)u[g]=t._pe.Pointer_stringify(f[g]);return y},e.mgrs_to_geog_extended=function(e,r,n,i,o){t._pe.ensureCache.prepare();var s=0;e&&(s=t._pe.getPointer(e));var u=n.map(function(e){return t._pe.ensureString(e)}),a=t._pe.ensureInt32(u),l=t._pe.ensureFloat64(new Array(2*r)),c=t._pe._pe_mgrs_to_geog_extended(s,r,a,i,l);return c&&p(o,r,l),c}}(f=t.PeNotationMgrs||(t.PeNotationMgrs={})),function(e){e.geog_to_usng=function(e,r,n,i,o,s,u){t._pe.ensureCache.prepare();var p=0;e&&(p=t._pe.getPointer(e));var c=l(n),h=t._pe.ensureFloat64(c),f=a(r,_.PE_MGRS_MAX),d=t._pe.ensureInt32(f),y=t._pe._pe_geog_to_usng(p,r,h,i,o,s,d);if(y)for(var g=0;g<r;g++)u[g]=t._pe.Pointer_stringify(f[g]);return y},e.usng_to_geog=function(e,r,n,i){t._pe.ensureCache.prepare();var o=0;e&&(o=t._pe.getPointer(e));var s=n.map(function(e){return t._pe.ensureString(e)}),u=t._pe.ensureInt32(s),a=t._pe.ensureFloat64(new Array(2*r)),l=t._pe._pe_usng_to_geog(o,r,u,a);return l&&p(i,r,a),l}}(t.PeNotationUsng||(t.PeNotationUsng={})),function(e){e.init=function(){e.PE_UTM_OPTS_NONE=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS},e.geog_to_utm=function(e,r,n,i,o){t._pe.ensureCache.prepare();var s=0;e&&(s=t._pe.getPointer(e));var u=l(n),p=t._pe.ensureFloat64(u),c=a(r,_.PE_UTM_MAX),h=t._pe.ensureInt32(c),f=t._pe._pe_geog_to_utm(s,r,p,i,h);if(f)for(var d=0;d<r;d++)o[d]=t._pe.Pointer_stringify(c[d]);return f},e.utm_to_geog=function(e,r,n,i,o){t._pe.ensureCache.prepare();var s=0;e&&(s=t._pe.getPointer(e));var u=n.map(function(e){return t._pe.ensureString(e)}),a=t._pe.ensureInt32(u),l=t._pe.ensureFloat64(new Array(2*r)),c=t._pe._pe_utm_to_geog(s,r,a,i,l);return c&&p(o,r,l),c}}(d=t.PeNotationUtm||(t.PeNotationUtm={})),function(e){var r=new Map;e.init=function(){e.PE_PCSINFO_OPTION_NONE=t._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=t._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=t._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=t._pe.PePCSInfo.prototype.PE_POLE_POINT},e.generate=function(n,i){var o,s;return void 0===i&&(i=e.PE_PCSINFO_OPTION_DOMAIN),r.has(n)&&(s=r.get(n))[i]&&(o=s[i]),o||(o=t._pe.PePCSInfo.prototype.generate(n,i),s||(s=[],r.set(n,s)),s[i]=o),o}}(y=t.PePCSInfo||(t.PePCSInfo={})),function(e){(t.PeVersion||(t.PeVersion={})).version_string=function(){return t._pe.PeVersion.prototype.version_string()}}(),t._init=s}.apply(null,n))||(e.exports=i)},1665:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1666)],void 0===(i=function(e,t,r){return function(){function e(e){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(var t=0,n=e.steps;t<n.length;t++){var i=n[t];i instanceof r?this.steps.push(i):this.steps.push(new r({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}}return e.cacheKey=function(e,t){return[void 0!==e.wkid&&null!==e.wkid?e.wkid.toString():"-1",void 0!==e.wkt&&null!==e.wkt?e.wkt.toString():"",void 0!==t.wkid&&null!==t.wkid?t.wkid.toString():"-1",void 0!==t.wkt&&null!==t.wkt?t.wkt.toString():""].join(",")},e.fromGE=function(t){for(var n=new e,i="",o=0,s=t.steps;o<s.length;o++){var u=s[o],a=r.fromGE(u);n.steps.push(a),i+=a.uid.toString()+","}return n._cached_projection={},n._gtlistentry=null,n._chain=i,n},e.prototype.getInverse=function(){var t=new e;t.steps=[];for(var r=this.steps.length-1;r>=0;r--){var n=this.steps[r];t.steps.push(n.getInverse())}return t},e.prototype.getGTListEntry=function(){for(var e="",t=0,r=this.steps;t<r.length;t++)e+=r[t].uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=e),this._gtlistentry},e.prototype.assignCachedGe=function(t,r,n){this._cached_projection[e.cacheKey(t,r)]=n},e.prototype.getCachedGeTransformation=function(t,r){for(var n="",i=0,o=this.steps;i<o.length;i++)n+=o[i].uid.toString()+",";n!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=n);var s=this._cached_projection[e.cacheKey(t,r)];return void 0===s?null:s},e}()}.apply(null,n))||(e.exports=i)},1666:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r=0;return function(){function e(e){void 0===e&&(e=null),this.uid=r++,e?(this._wkt=void 0!==e.wkt?e.wkt:null,this._wkid=void 0!==e.wkid?e.wkid:-1,this._isInverse=void 0!==e.isInverse&&!0===e.isInverse):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}return e.fromGE=function(t){var r=new e;return r._wkt=t.wkt,r._wkid=t.wkid,r._isInverse=t.isInverse,r},Object.defineProperty(e.prototype,"wkt",{get:function(){return this._wkt},set:function(e){this._wkt=e,this.uid=r++},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wkid",{get:function(){return this._wkid},set:function(e){this._wkid=e,this.uid=r++},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInverse",{get:function(){return this._isInverse},set:function(e){this._isInverse=e,this.uid=r++},enumerable:!0,configurable:!0}),e.prototype.getInverse=function(){var t=new e;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t},e}()}.apply(null,n))||(e.exports=i)},1717:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(6),r(57),r(0),r(40),r(1600)],void 0===(i=function(e,t,r,n,i,o,s,u,a){Object.defineProperty(t,"__esModule",{value:!0});var l=[0,0],p=function(e){function t(t){var r=e.call(this,t)||this;return r._queue=new Map,r._onGoingTile=null,r._onGoingPromise=null,r._isPaused=!1,r._scheduledNextHandle=null,r._timestamp=Date.now(),r.tileInfoView=null,r._next=r._next.bind(r),r._finalize=r._finalize.bind(r),r}return r(t,e),Object.defineProperty(t.prototype,"length",{get:function(){return this._queue.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._queue.size>0||null!=this._onGoingPromise},enumerable:!0,configurable:!0}),t.prototype.cancel=function(e){this._onGoingTile&&this._onGoingTile.tileId===e&&(this._onGoingPromise.cancel(),this._onGoingTile=this._onGoingPromise=null),this._queue.delete(e),this._scheduleNext(),this.notifyChange("updating")},t.prototype.clear=function(){this._queue.clear(),this._onGoingPromise&&(this._onGoingPromise.cancel(),this._onGoingTile=this._onGoingPromise=null),this._cancelNext(),this.notifyChange("updating")},t.prototype.has=function(e){return this._queue.has(e)},t.prototype.isOngoing=function(e){return this._onGoingTile&&this._onGoingTile.tileId===e},t.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},t.prototype.push=function(e,t){this._queue.has(e)||(this._queue.set(e,{tileId:e,key:a.TileKey.pool.acquire(e),timestamp:t||this._timestamp}),this._scheduleNext(),this.notifyChange("updating"))},t.prototype.refresh=function(){this._timestamp=Date.now(),this.reset()},t.prototype.reset=function(){var e=this._onGoingTile;if(e){var t=e.tileId;this.push(t,this._timestamp)}this.notifyChange("updating")},t.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext()),this.notifyChange("updating")},t.prototype._finalize=function(){this._onGoingTile=null,this._onGoingPromise=null,this.notifyChange("updating"),this._scheduleNext()},t.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)},t.prototype._scheduleNext=function(){this._isPaused||this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingTile||(this._scheduledNextHandle=o.schedule(this._next))},t.prototype._next=function(){if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingTile)this._scheduledNextHandle=null;else{this._scheduledNextHandle=null;var e=this._peek(),t=e.tileId,r=e.key;a.TileKey.pool.release(r),this._queue.delete(t),this._onGoingTile=e,this._onGoingPromise=this.process(t,this._timestamp),function(e){return e&&"function"==typeof e.then}(this._onGoingPromise)?this._onGoingPromise.then(this._finalize,this._finalize):this._finalize(),this.notifyChange("updating")}},t.prototype._peek=function(){var e=this;if(!this.state)throw new Error("state not set");var t=this.tileInfoView,r=this.state.center,n=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,o=null;return this._queue.forEach(function(s,a){t.getTileCoords(l,s.key);var p=e._timestamp-s.timestamp;if(isNaN(p))(c=u.vec2.distance(l,r))<i&&(i=c,o=s);else if(p===n){var c;(c=u.vec2.distance(l,r))<i&&(i=c,o=s)}else p>n&&(n=p,i=Number.POSITIVE_INFINITY,o=s)}),o},n([s.property({readOnly:!0})],t.prototype,"length",null),n([s.property({constructOnly:!0})],t.prototype,"process",void 0),n([s.property()],t.prototype,"state",void 0),n([s.property({constructOnly:!0})],t.prototype,"tileInfoView",void 0),n([s.property({readOnly:!0})],t.prototype,"updating",null),n([s.subclass()],t)}(s.declared(i));t.default=p}.apply(null,n))||(e.exports=i)},1799:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(11),r(22),r(25),r(43),r(13),r(10),r(32),r(8),r(358),r(0),r(97),r(548),r(1630),r(559),r(356),r(1517),r(1647),r(1717)],void 0===(i=function(e,t,r,n,i,o,s,u,a,l,p,c,_,h,f,d,y,g,v,m,E,P){Object.defineProperty(t,"__esModule",{value:!0});var T=l.getLogger("esri.views.2d.layers.features.controllers.MemoryController"),I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="memory",t._processingInMainThread=!1,t}return r(t,e),t.prototype.initialize=function(){var e=this;this._tileQueue=new P.default({tileInfoView:this.tileStore.tileScheme,process:function(t,r){return e._fetchFeatureSet(t,r)}}),this._memorySource=_.openWithPorts(this.service.source,{client:this}),this.handles.add(this.watch("processor",this._switchProcessor.bind(this)))},t.prototype.destroy=function(){this._memorySource.close(),this._memorySource=null,this._tileQueue.clear(),this._tileQueue.pause()},Object.defineProperty(t.prototype,"processing",{get:function(){return y.fromWorker(this.configuration.processing)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._tileQueue.updating},enumerable:!0,configurable:!0}),t.prototype.onEdits=function(e){this.refresh()},t.prototype.queryFeatures=function(e){return this._memorySource.invoke("queryFeatures",e)},t.prototype.queryFeatureCount=function(e){return this._memorySource.invoke("queryFeatureCount",e)},t.prototype.queryObjectIds=function(e){return this._memorySource.invoke("queryObjectIds",e)},t.prototype.queryExtent=function(e){return this._memorySource.invoke("queryExtent",e)},t.prototype.redraw=function(){this.refresh()},t.prototype.refresh=function(){this._tileQueue.refresh();for(var e=0,t=this.tileStore.tiles;e<t.length;e++){var r=t[e];this._tileQueue.push(r.id,r.updateTimestamp)}},t.prototype.setViewState=function(e){this._tileQueue.state=e},t.prototype.setFilter=function(e){var t=e.index,r=e.filter;return s(this,void 0,void 0,function(){var e;return o(this,function(n){switch(n.label){case 0:return[4,this.setFilterBase(t,r)];case 1:return e=n.sent(),this.processor&&!this.processor.supportsTileUpdates&&this.redraw(),p.isNone(e)?(T.error(new a("featurelayer-controller:required-fields-error","Tried to set filter but was unable to find required fields")),[2,{show:[],hide:[]}]):[2,e]}})})},t.prototype.onTileUpdate=function(e){this._tileQueue.pause();for(var t=0,r=e.removed;t<r.length;t++){var n=r[t];this._tileQueue.cancel(n.id)}for(var i=0,o=e.added;i<o.length;i++){n=o[i];this._tileQueue.push(n.id,n.updateTimestamp)}this.processor&&this._tileQueue.resume()},t.prototype._switchProcessor=function(e,t){this.refresh(),e&&this._tileQueue.resume()},t.prototype._fetchFeatureSet=function(e,t){var r=this,n=this.tileStore.get(e),i=this.processor.queryInfo;return this._query(n,i).then(function(e){return r._setFilterFlags(e)}).then(function(e){return r._wrapPoints(e,i)}).then(function(e){return r._sortFeatures(e,i)}).then(function(e){return e.features.length?e:null}).then(function(e){return n.updateTimestamp=t,r.processor.onTileData(n,{addOrUpdate:e&&e.features,clear:!0,transformParams:e&&m.getTransformParams(e)})}).catch(function(e){return n.updateTimestamp=t,"cancel"!==e.dojoType&&(r.processor.onTileError(n,e.message),T.error("query-error",{error:e})),c.reject(e)})},t.prototype._query=function(e,t){var r=this,n=new v,i=this._getQuantizationParameters(e),o=t.pixelBuffer*e.resolution,s=e.bounds.slice();return s[0]-=o,s[1]-=o,s[2]+=o,s[3]+=o,n.outFields=this.processor.queryInfo.outFields,n.where=this.processor.queryInfo.definitionExpression||"1=1",n.geometry=new u.Extent({xmin:s[0],ymin:s[1],xmax:s[2],ymax:s[3],spatialReference:this.spatialReference}),this.service.capabilities.query.supportsQuantization?(n.quantizationParameters=i,"esriGeometryPolyline"===this.service.geometryType&&(n.maxAllowableOffset=i.tolerance)):n.maxAllowableOffset=i.tolerance,n.resultType="tile",n.returnExceededLimitFeatures=!1,n.returnGeometry=!0,n.returnCentroid=t.returnCentroid,n.orderByFields=t.orderByFields,this.queryFeatures(n.toJSON()).then(function(e){return t.returnCentroid?e.features=e.features.filter(function(e){return null!=e.geometry&&null!=e.centroid}):e.features=e.features.filter(function(e){return null!=e.geometry}),e}).then(function(e){return r._applyProcessing(e)})},t.prototype._applyProcessing=function(e){var t=this.processing;if(!t)return e;if(this._processingInMainThread)return this.remoteClient.invoke("executeProcessing",{featureSet:e});try{return t.process(e,t.options)||c.reject(new a("FeatureLayer","invalid processing.process() method, returns nothing"))}catch(t){return this._processingInMainThread=!0,this.remoteClient.invoke("executeProcessing",{featureSet:e})}},t.prototype._getQuantizationParameters=function(e){return new g.default({mode:"view",originPosition:"lower-left",tolerance:e.resolution,extent:new u.Extent({xmin:e.bounds[0],ymin:e.bounds[1],xmax:e.bounds[2],ymax:e.bounds[3],spatialReference:this.spatialReference})})},t.prototype._wrapPoints=function(e,t){if(0===e.features.length)return e;var r=t.returnCentroid,n=t.pixelBuffer,o=e.geometryType,s=e.spatialReference,u=e.transform;if("esriGeometryPoint"!==o&&"esriGeometryMultipoint"!==o&&!r||!f.isWrappable(s))return e;var a=e.features,l=f.getInfo(s),p=Math.round((l.valid[1]-l.valid[0])/u.scale[0]);if(512===p){for(var c=[],_=0,h=a;_<h.length;_++){var d=h[_],y=d.geometry,g=d.attributes;if(y)if(y.x<n){(v={geometry:i({},y),attributes:g}).geometry.x+=p,c.push(v)}else if(y.x>512-n){var v;(v={geometry:i({},y),attributes:g}).geometry.x-=p,c.push(v)}}a.push.apply(a,c)}else for(var m=0,E=a;m<E.length;m++){(y=E[m].geometry)&&(y.x<-n?y.x+=p:y.x>512+n&&(y.x-=p))}return e},t.prototype._sortFeatures=function(e,t){var r=t.orderByFields;if(r){var n=r[0].split(" "),i=n[0];"DESC"===n[1]&&e.features.sort(function(e,t){return t.attributes[i]-e.attributes[i]})}return e},t.prototype._setFilterFlags=function(e){var t=d.convertFromFeatureSet(e,this.service.objectIdField);this.hasGeometryFilter()&&(t=d.hydrateOptimizedFeatureSet(t));for(var r=t.features,n=0;n<r.length;n++)e.features[n].filterFlags=this._getFilterFlags(r[n]);return e},n([h.property()],t.prototype,"_tileQueue",void 0),n([h.property({readOnly:!0,dependsOn:["configuration"]})],t.prototype,"processing",null),n([h.property({dependsOn:["_tileQueue.updating"]})],t.prototype,"updating",null),n([h.subclass()],t)}(h.declared(E.default));t.default=I}.apply(null,n))||(e.exports=i)}}]);