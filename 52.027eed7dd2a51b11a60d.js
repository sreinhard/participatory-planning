(function(){(this||window).webpackJsonp.registerAbsMids({"esri/tasks/support/FeatureSet":1406,"esri/views/3d/layers/PointCloudWorker":1428,"esri/views/layers/LayerView":1461,"esri/geometry/support/normalizeUtils":1463,"esri/tasks/geometry/cut":1464,"esri/tasks/geometry/simplify":1465,"esri/views/3d/layers/LayerView3D":1466,"esri/views/3d/layers/support/layerViewUpdatingProperties":1472,"esri/tasks/support/AttachmentQuery":1496,"esri/tasks/support/RelationshipQuery":1501,"esri/layers/support/PromiseQueue":1521,"esri/views/3d/layers/i3s/PointCloudRendererUtil":1639,"esri/views/3d/layers/PointCloudLayerView3D":2451,"esri/views/3d/layers/i3s/LoDUtil":2452,"esri/views/3d/layers/i3s/PagedNodeIndex":2453,"esri/views/3d/layers/i3s/PointRenderer":2454,"esri/views/3d/webgl-engine/shaders/PointRendererPrograms":2455})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[52,72,106],{1406:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(2),r(42),r(84),r(26),r(9),r(14),r(0),r(39),r(71),r(549)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p,c){var h=new a.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent"}),f=function(e){function t(t){var r=e.call(this,t)||this;return r.displayFieldName=null,r.exceededTransferLimit=!1,r.features=[],r.fields=null,r.geometryType=null,r.hasM=!1,r.hasZ=!1,r.queryGeometry=null,r.spatialReference=null,r}return n(t,e),t.prototype.readFeatures=function(e,t){for(var r=d.fromJSON(t.spatialReference),n=[],i=0;i<e.length;i++){var a=e[i],s=o.fromJSON(a),u=a.geometry&&a.geometry.spatialReference;l.isSome(s.geometry)&&!u&&(s.geometry.spatialReference=r),n.push(s)}return n},t.prototype.writeGeometryType=function(e,t,r,n){if(e)h.write(e,t,r,n);else{var i=this.features;if(i)for(var o=0,a=i;o<a.length;o++){var s=a[o];if(s&&l.isSome(s.geometry))return void h.write(s.geometry.type,t,r,n)}}},t.prototype.writeSpatialReference=function(e,t,r,n){if(e)t.spatialReference=e.toJSON();else{var i=this.features;if(i)for(var o=0,a=i;o<a.length;o++){var s=a[o];s&&l.isSome(s.geometry)&&s.geometry.spatialReference&&(t.spatialReference=s.geometry.spatialReference.toJSON())}}},t.prototype.toJSON=function(e){var t=this.write(null);if(t.features&&Array.isArray(e)&&e.length>0)for(var r=0;r<t.features.length;r++){var n=t.features[r];if(n.geometry){var i=e&&e[r];n.geometry=i&&i.toJSON()||n.geometry}}return t},t.prototype.quantize=function(e){for(var t=e.scale,r=t[0],n=t[1],i=e.translate,o=i[0],a=i[1],s=this.features,u=this._getQuantizationFunction(this.geometryType,function(e){return Math.round((e-o)/r)},function(e){return Math.round((a-e)/n)}),d=0,p=s.length;d<p;d++)u(l.expect(s[d].geometry))||(s.splice(d,1),d--,p--);return this.transform=e,this},t.prototype.unquantize=function(){var e=this,t=e.geometryType,r=e.features,n=e.transform;if(!n)return this;for(var i=n.translate,o=i[0],a=i[1],s=n.scale,u=s[0],d=s[1],p=this._getHydrationFunction(t,function(e){return e*u+o},function(e){return a-e*d}),c=0,h=r;c<h.length;c++){var f=h[c].geometry;l.isSome(f)&&p(f)}return this},t.prototype._quantizePoints=function(e,t,r){for(var n,i,o=[],a=0,s=e.length;a<s;a++){var l=e[a];if(a>0){var u=t(l[0]),d=r(l[1]);u===n&&d===i||(o.push([u-n,d-i]),n=u,i=d)}else n=t(l[0]),i=r(l[1]),o.push([n,i])}return o.length>0?o:null},t.prototype._getQuantizationFunction=function(e,t,r){var n=this;return"point"===e?function(e){return e.x=t(e.x),e.y=r(e.y),e}:"polyline"===e||"polygon"===e?function(e){for(var i=p.isPolygon(e)?e.rings:e.paths,o=[],a=0,s=i.length;a<s;a++){var l=i[a],u=n._quantizePoints(l,t,r);u&&o.push(u)}return o.length>0?(p.isPolygon(e)?e.rings=o:e.paths=o,e):null}:"multipoint"===e?function(e){var i;return(i=n._quantizePoints(e.points,t,r)).length>0?(e.points=i,e):null}:"extent"===e?function(e){return e}:void 0},t.prototype._getHydrationFunction=function(e,t,r){return"point"===e?function(e){e.x=t(e.x),e.y=r(e.y)}:"polyline"===e||"polygon"===e?function(e){for(var n,i,o=p.isPolygon(e)?e.rings:e.paths,a=0,s=o.length;a<s;a++)for(var l=o[a],u=0,d=l.length;u<d;u++){var c=l[u];u>0?(n+=c[0],i+=c[1]):(n=c[0],i=c[1]),c[0]=t(n),c[1]=r(i)}}:"extent"===e?function(e){e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax)}:"multipoint"===e?function(e){for(var n,i,o=e.points,a=0,s=o.length;a<s;a++){var l=o[a];a>0?(n+=l[0],i+=l[1]):(n=l[0],i=l[1]),l[0]=t(n),l[1]=r(i)}}:void 0},r([u.property({type:String,json:{write:!0}})],t.prototype,"displayFieldName",void 0),r([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"exceededTransferLimit",void 0),r([u.property({type:[o],json:{write:!0}})],t.prototype,"features",void 0),r([u.reader("features")],t.prototype,"readFeatures",null),r([u.property({type:[c],json:{write:!0}})],t.prototype,"fields",void 0),r([u.property({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:h.read}}})],t.prototype,"geometryType",void 0),r([u.writer("geometryType")],t.prototype,"writeGeometryType",null),r([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasM",void 0),r([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasZ",void 0),r([u.property({types:i.geometryTypes,json:{read:p.fromJSON,write:!0}})],t.prototype,"queryGeometry",void 0),r([u.property({type:d,json:{write:!0}})],t.prototype,"spatialReference",void 0),r([u.writer("spatialReference")],t.prototype,"writeSpatialReference",null),r([u.property({json:{write:!0}})],t.prototype,"transform",void 0),r([u.subclass("esri.tasks.support.FeatureSet")],t)}(u.declared(s));return f.prototype.toJSON.isDefaultToJSON=!0,f||(f={}),f}.apply(null,n))||(e.exports=i)},1428:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(8),r(351),r(350),r(365),r(1549),r(4),r(260),r(39),r(1485),r(1594),r(1639),r(38),r.dj.m(e)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p,c,h,f,y){Object.defineProperty(t,"__esModule",{value:!0});var g=function(){function e(){}return e.prototype._process=function(e){var t=this._transform(e);return n.resolve({result:t,transferList:[t.points.buffer,t.rgb.buffer]})},e.prototype._transform=function(e){var t=this.readGeometry(e.schema,e.geometryBuffer),r=t.length/3,n=h.evaluateRenderer(e.rendererInfo,e.primaryAttribute,e.modulationAttribute,t,r);e.filterInfo&&e.filterInfo.length>0&&(r=h.filterInPlace(t,n,e.filterInfo,e.filterAttributes)),3*r<n.length&&(n=new Uint8Array(n.buffer.slice(0,3*r))),this._applyElevationOffsetInPlace(t,r,e.elevationOffset);var i=this._transformCoordinates(t,r,e.obb,d.fromJSON(e.inSR),d.fromJSON(e.outSR));return{obb:e.obb,points:i,rgb:n}},e.prototype.readGeometry=function(e,t){if(null==e.encoding||""===e.encoding){for(var r=p.createGeometryIndexFromSchema(t,e),n=p.createTypedView(t,r.vertexAttributes.position),i=r.header.fields,o=[i.offsetX,i.offsetY,i.offsetZ],a=[i.scaleX,i.scaleY,i.scaleZ],s=n.length/3,l=new Float64Array(3*s),u=0;u<s;u++)l[3*u]=n[3*u]*a[0]+o[0],l[3*u+1]=n[3*u+1]*a[1]+o[1],l[3*u+2]=n[3*u+2]*a[2]+o[2];return l}if("lepcc-xyz"===e.encoding)return c.decodeXYZ(t).result},e.prototype._transformCoordinates=function(e,t,r,n,i){if(!f.bufferToBuffer(e,n,0,e,i,0,t))throw Error("Can't reproject");var o=u.vec3f32.fromValues(r.center[0],r.center[1],r.center[2]),s=u.vec3f32.create(),d=u.vec3f32.create();a.quat.conjugate(v,r.quaternion);for(var p=new Float32Array(3*t),c=0;c<t;c++)s[0]=e[3*c]-o[0],s[1]=e[3*c+1]-o[1],s[2]=e[3*c+2]-o[2],l.vec3.transformQuat(d,s,v),r.halfSize[0]=Math.max(r.halfSize[0],Math.abs(d[0])),r.halfSize[1]=Math.max(r.halfSize[1],Math.abs(d[1])),r.halfSize[2]=Math.max(r.halfSize[2],Math.abs(d[2])),p[3*c]=s[0],p[3*c+1]=s[1],p[3*c+2]=s[2];return p},e.prototype._applyElevationOffsetInPlace=function(e,t,r){if(0!==r)for(var n=0;n<t;n++)e[3*n+2]+=r},e}(),v=s.quatf32.create(),m=function(t){function a(){var r=t.call(this)||this;return r._thread=void 0,o.open(i.getAbsMid("./PointCloudWorker",e,y)).then(function(e){void 0===r._thread?r._thread=e:e.close()}),r}return r(a,t),a.prototype.destroy=function(){this._thread&&this._thread.close(),this._thread=null},a.prototype.transform=function(e,t,r){return this._thread?this._thread.invoke("_process",e,{transferList:t,signal:r}):n.resolve(this._transform(e))},a}(g);t.PointCloudWorker=m,t.default=function(){return new g}}.apply(null,n))||(e.exports=i)},1461:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(37),r(346),r(255),r(11),r(201),r(8),r(0)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d){return function(e){function t(t){var r=e.call(this)||this;return r.layer=null,r.parent=null,r.view=null,r}return r(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",n=e.layer&&e.layer.title||"no title";return s.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+n+"', id: '"+r+"')",t),u.reject(t)}})},t.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},n([d.property()],t.prototype,"layer",void 0),n([d.property()],t.prototype,"parent",void 0),n([d.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),n([d.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],t.prototype,"updating",null),n([d.property()],t.prototype,"view",void 0),n([d.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),n([d.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),n([d.subclass("esri.views.layers.LayerView")],t)}(d.declared(o,i,a.Identifiable,l))}.apply(null,n))||(e.exports=i)},1463:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(12),r(97),r(15),r(11),r(14),r(8),r(63),r(96),r(39),r(94),r(56),r(1464),r(1465)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p,c,h,f,y){function g(e){return"polygon"===e.type}function v(e){return"polygon"===e[0].type}function m(e){return"polyline"===e[0].type}function _(e){return g(e)?e.rings:e.paths}function b(e,t){return Math.ceil((e-t)/(2*t))}function S(e,t){for(var r=0,n=_(e);r<n.length;r++)for(var i=0,o=n[r];i<o.length;i++){o[i][0]+=t}return e}function x(e){for(var t=[],r=0,n=0,i=0;i<e.length;i++){for(var o=e[i],a=null,s=0;s<o.length;s++)a=o[s],t.push(a),0===s?n=r=a[0]:(r=Math.min(r,a[0]),n=Math.max(n,a[0]));a&&t.push([(r+n)/2,0])}return t}function w(e,t){if(!(e instanceof d||e instanceof u)){var r="straightLineDensify: the input geometry is neither polyline nor polygon";throw O.error(r),new o(r)}for(var n=[],i=0,a=_(e);i<a.length;i++){var s=a[i],l=[];n.push(l),l.push([s[0][0],s[0][1]]);for(var p=0;p<s.length-1;p++){var c=s[p][0],h=s[p][1],f=s[p+1][0],y=s[p+1][1],v=Math.sqrt((f-c)*(f-c)+(y-h)*(y-h)),m=(y-h)/v,b=(f-c)/v,S=v/t;if(S>1){for(var x=1;x<=S-1;x++){var w=x*t,P=b*w+c,R=m*w+h;l.push([P,R])}var N=(v+Math.floor(S-1)*t)/2,z=b*N+c,I=m*N+h;l.push([z,I])}l.push([f,y])}}return g(e)?new u({rings:n,spatialReference:e.spatialReference}):new d({paths:n,spatialReference:e.spatialReference})}function P(e,t,r){if(t){var n=w(e,1e6);e=h.webMercatorToGeographic(n,!0)}return r&&(e=S(e,r)),e}function R(e,t,r){var n;if(Array.isArray(e)){if((n=e[0])>t){var i=b(n,t);e[0]=n+i*(-2*t)}else if(n<r){i=b(n,r);e[0]=n+i*(-2*r)}}else if((n=e.x)>t){i=b(n,t);e=e.clone().offset(i*(-2*t),0)}else if(n<r){i=b(n,r);e=e.clone().offset(i*(-2*r),0)}return e}function N(e,t){for(var r=-1,n=0;n<t.cutIndexes.length;n++)!function(n){for(var i=t.cutIndexes[n],o=t.geometries[n],a=_(o),s=0;s<a.length;s++)!function(e){var t=a[e];t.some(function(r){if(r[0]<180)return!0;for(var n=0,i=0;i<t.length;i++){var a=t[i][0];n=a>n?a:n}for(var s=-360*b(n=Number(n.toFixed(9)),180),l=0;l<t.length;l++){var u=o.getPoint(e,l);o.setPoint(e,l,u.clone().offset(s,0))}return!0})}(s);if(i===r){if(v(e))for(var l=0,u=_(o);l<u.length;l++){var d=u[l];e[i]=e[i].addRing(d)}else if(m(e))for(var p=0,c=_(o);p<c.length;p++){var h=c[p];e[i]=e[i].addPath(h)}}else r=i,e[i]=o}(n);return e}Object.defineProperty(t,"__esModule",{value:!0});var O=a.getLogger("esri.geometry.support.normalizeUtils"),z={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new d({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:p.WebMercator}),minus180Line:new d({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:p.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new d({paths:[[[180,-180],[180,180]]],spatialReference:p.WebMercator}),minus180Line:new d({paths:[[[-180,-180],[-180,180]]],spatialReference:p.WebMercator})}};t.straightLineDensify=w,t.normalizeCentralMeridian=function e(t,o,a){return n(this,void 0,void 0,function(){var n,p,g,v,m,_,x,w,O,I,M,C,j,k,V,A,F,U,L,T,W,E,B,Q,q,D,J,G,H,X,Y,Z,K,$,ee,te,re;return r(this,function(r){switch(r.label){case 0:if(!Array.isArray(t))return[2,e([t],o)];for(n=o?o.url:i.geometryServiceUrl,I=0,M=[],C=[],j=0,k=t;j<k.length;j++)V=k[j],s.isNone(V)?C.push(V):(p||(p=V.spatialReference,g=c.getInfo(p),v=p.isWebMercator,m=z[x=v?102100:4326].maxX,_=z[x].minX,w=z[x].plus180Line,O=z[x].minus180Line),g?"mesh"===V.type?C.push(V):"point"===V.type?C.push(R(V.clone(),m,_)):"multipoint"===V.type?((A=V.clone()).points=A.points.map(function(e){return R(e,m,_)}),C.push(A)):"extent"===V.type?(U=V.clone(),F=U._normalize(!1,!1,g),C.push(F.rings?new u(F):F)):V.extent?(U=V.extent,L=b(U.xmin,_),W=0==(T=L*(2*m))?V.clone():S(V.clone(),T),U.offset(T,0),U.intersects(w)&&U.xmax!==m?(I=U.xmax>I?U.xmax:I,W=P(W,v),M.push(W),C.push("cut")):U.intersects(O)&&U.xmin!==_?(I=U.xmax*(2*m)>I?U.xmax*(2*m):I,W=P(W,v,360),M.push(W),C.push("cut")):C.push(W)):C.push(V.clone()):C.push(V));for(E=b(I,m),B=-90,Q=E,q=new d;E>0;)D=360*E-180,q.addPath([[D,B],[D,-1*B]]),B*=-1,E--;return M.length>0&&Q>0?[4,f.cut(n,M,q,a)]:[3,3];case 1:for(J=r.sent(),G=N(M,J),H=[],X=[],ee=0;ee<C.length;ee++)"cut"!==(te=C[ee])?X.push(te):(re=G.shift(),Y=t[ee],s.isSome(Y)&&"polygon"===Y.type&&Y.rings&&Y.rings.length>1&&re.rings.length>=Y.rings.length?(H.push(re),X.push("simplify")):X.push(v?h.geographicToWebMercator(re):re));return H.length?[4,y.simplify(n,H,a)]:[2,X];case 2:for(Z=r.sent(),K=[],ee=0;ee<X.length;ee++)"simplify"!==(te=X[ee])?K.push(te):K.push(v?h.geographicToWebMercator(Z.shift()):Z.shift());return[2,K];case 3:for($=[],ee=0;ee<C.length;ee++)"cut"!==(te=C[ee])?$.push(te):(re=M.shift(),$.push(!0===v?h.geographicToWebMercator(re):re));return[2,l.resolve($)]}})})},t.getDenormalizedExtent=function(e){var t;if(!e)return null;var r=e.extent;if(!r)return null;var n=e.spatialReference&&c.getInfo(e.spatialReference);if(!n)return r;var i,o=n.valid,a=o[0],s=o[1],l=2*s,u=r.width,d=r.xmin,p=r.xmax;if(d=(t=[p,d])[0],p=t[1],"extent"===e.type||0===u||u<=s||u>l||d<a||p>s)return r;switch(e.type){case"polygon":if(!(e.rings.length>1))return r;i=x(e.rings);break;case"polyline":if(!(e.paths.length>1))return r;i=x(e.paths);break;case"multipoint":i=e.points}for(var h=r.clone(),f=0;f<i.length;f++){var y=i[f][0];y<0?(y+=s,p=Math.max(y,p)):(y-=s,d=Math.min(y,d))}return h.xmin=d,h.xmax=p,h.width<u?(h.xmin-=s,h.xmax-=s,h):r},t.normalizeMapX=function(e,t){var r=c.getInfo(t);if(r){var n=r.valid,i=n[0],o=n[1],a=o-i;if(e<i)for(;e<i;)e+=a;if(e>o)for(;e>o;)e-=a}return e}}.apply(null,n))||(e.exports=i)},1464:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(7),r(12),r(10),r(42),r(48),r(31),r(71)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.cut=function(e,t,u,d){return n(this,void 0,void 0,function(){var n,p,c,h,f,y,g;return i(this,function(i){switch(i.label){case 0:return n="string"==typeof e?s.urlToObject(e):e,p=t[0].spatialReference,c=r({},d,{query:r({},n.query,{f:"json",sr:JSON.stringify(p),target:JSON.stringify({geometryType:l.getJsonType(t[0]),geometries:t}),cutter:JSON.stringify(u)})}),[4,a(n.path+"/cut",c)];case 1:return h=i.sent(),f=h.data,y=f.cutIndexes,g=f.geometries,[2,{cutIndexes:y,geometries:(void 0===g?[]:g).map(function(e){return o.fromJSON(e).set(p)})}]}})})}}.apply(null,n))||(e.exports=i)},1465:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(7),r(12),r(10),r(48),r(31),r(71)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.simplify=function(e,t,l){return n(this,void 0,void 0,function(){var n,u,d,p;return i(this,function(i){switch(i.label){case 0:return n="string"==typeof e?a.urlToObject(e):e,u=t[0].spatialReference,d=s.getJsonType(t[0]),p=r({},l,{query:r({},n.query,{f:"json",sr:u.wkid?u.wkid:JSON.stringify(u),geometries:JSON.stringify(function(e){return{geometryType:s.getJsonType(e[0]),geometries:e.map(function(e){return e.toJSON()})}}(t))})}),[4,o(n.path+"/simplify",p)];case 1:return[2,function(e,t,r){var n=s.getGeometryType(t);return e.map(function(e){var t=n.fromJSON(e);return t.spatialReference=r,t})}(i.sent().data,d,u)]}})})}}.apply(null,n))||(e.exports=i)},1466:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(8),r(28),r(0),r(354),r(1461)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.supportsHeightUnitConversion=!1,t}return r(t,e),t.prototype.postscript=function(e){this.inherited(arguments),s.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return i.create(function(t,r){o.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var n=s.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);n?r(n):t()})})},n([a.property()],t.prototype,"view",void 0),n([a.property()],t.prototype,"slicePlaneEnabled",void 0),n([a.subclass("esri.views.3d.layers.LayerView3D")],t)}(a.declared(l))}.apply(null,n))||(e.exports=i)},1472:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,n))||(e.exports=i)},1496:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(9),r(13),r(0),r(27)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=function(e){function t(t){var r=e.call(this,t)||this;return r.attachmentTypes=null,r.globalIds=null,r.num=null,r.objectIds=null,r.returnMetadata=!1,r.size=null,r.start=null,r.where=null,r}var i;return r(t,e),i=t,t.prototype.writeStart=function(e,t,r){t.resultOffset=this.start,t.resultRecordCount=this.num||10},t.prototype.clone=function(){return new i(o.clone({attachmentTypes:this.attachmentTypes,where:this.where,globalIds:this.globalIds,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))},n([a.property({type:[String],json:{write:!0}})],t.prototype,"attachmentTypes",void 0),n([a.property({type:[Number],json:{write:!0}})],t.prototype,"globalIds",void 0),n([a.property({type:Number,json:{read:{source:"resultRecordCount"}}})],t.prototype,"num",void 0),n([a.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),n([a.property({type:Boolean,json:{default:!1,write:!0}})],t.prototype,"returnMetadata",void 0),n([a.property({type:[Number],json:{write:!0}})],t.prototype,"size",void 0),n([a.property({type:Number,json:{read:{source:"resultOffset"}}})],t.prototype,"start",void 0),n([a.writer("start"),a.writer("num")],t.prototype,"writeStart",null),n([a.property({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],t.prototype,"where",void 0),i=n([a.subclass("esri.tasks.support.AttachmentQuery")],t)}(a.declared(i));return l.from=s.default(l),l}.apply(null,n))||(e.exports=i)},1501:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(42),r(9),r(13),r(0),r(27)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u=function(e){function t(t){var r=e.call(this,t)||this;return r.gdbVersion=null,r.geometryPrecision=void 0,r.historicMoment=null,r.maxAllowableOffset=void 0,r.objectIds=null,r.outFields=null,r.outSpatialReference=null,r.relationshipId=void 0,r.returnGeometry=!1,r.source=null,r.where=null,r}var o;return r(t,e),o=t,t.prototype._writeHistoricMoment=function(e,t){t.historicMoment=e&&e.getTime()},t.prototype.clone=function(){return new o(a.clone({gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&this.historicMoment.getTime(),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,source:this.source,where:this.where}))},n([s.property({type:String,json:{write:!0}})],t.prototype,"gdbVersion",void 0),n([s.property({type:Number,json:{write:!0}})],t.prototype,"geometryPrecision",void 0),n([s.property({type:Date})],t.prototype,"historicMoment",void 0),n([s.writer("historicMoment")],t.prototype,"_writeHistoricMoment",null),n([s.property({type:Number,json:{write:!0}})],t.prototype,"maxAllowableOffset",void 0),n([s.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),n([s.property({type:[String],json:{write:!0}})],t.prototype,"outFields",void 0),n([s.property({type:i.SpatialReference,json:{read:{source:"outSR"},write:{target:"outSR"}}})],t.prototype,"outSpatialReference",void 0),n([s.property({json:{write:!0}})],t.prototype,"relationshipId",void 0),n([s.property({json:{write:!0}})],t.prototype,"returnGeometry",void 0),n([s.property({json:{write:!0}})],t.prototype,"source",void 0),n([s.property({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],t.prototype,"where",void 0),o=n([s.subclass("esri.tasks.support.RelationshipQuery")],t)}(s.declared(o));return u.from=l.default(u),u}.apply(null,n))||(e.exports=i)},1521:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._deferreds=[],this._values=[]}return e.prototype.push=function(e){var t=this;return r.create(function(r,n){t._deferreds.push({resolve:r,reject:n}),t._values.push(e)})},e.prototype.unshift=function(e){var t=this;return r.create(function(r,n){t._deferreds.unshift({resolve:r,reject:n}),t._values.unshift(e)})},Object.defineProperty(e.prototype,"length",{get:function(){return this._deferreds.length},enumerable:!0,configurable:!0}),e.prototype.process=function(){return 0!==this.length&&(this._deferreds.shift().resolve(this._values.shift()),!0)},e.prototype.cancelAll=function(){for(var e=r.createAbortError(),t=0,n=this._deferreds;t<n.length;t++)n[t].reject(e);this._deferreds.length=0,this._values.length=0},e}();t.PromiseQueue=n}.apply(null,n))||(e.exports=i)},1639:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1595),r(1598),r(1599),r(1485)],void 0===(i=function(e,t,r,n,i,o){function a(e){for(var t=0,r=0,n=e||[];r<n.length;r++)t|=1<<n[r];return t}function s(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.name===t&&null!=i.attributeValues&&"UInt8"===i.attributeValues.valueType&&3===i.attributeValues.valuesPerElement)return{storageInfo:i,useElevation:!1}}return null}function l(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.name===t){var o="embedded-elevation"===i.encoding;return{storageInfo:o?null:i,useElevation:o}}}return"elevation"===t.toLowerCase()?{storageInfo:null,useElevation:!0}:null}function u(e,t,r,n){if(e&&e.useElevation){for(var i=new Float64Array(n),a=0;a<n;a++)i[a]=r[3*a+2];return i}return e&&t?o.readBinaryAttribute(e.storageInfo,t,n):null}function d(e){return null==e||"none"===e?null:"low-four-bit"===e?function(e){return 15&e}:"high-four-bit"===e?function(e){return(240&e)>>4}:"absolute-value"===e?function(e){return Math.abs(e)}:"modulo-ten"===e?function(e){return e%10}:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getRendererInfo=function(e){var t=e.renderer,r=t&&t.type,n=t&&e.renderer.toJSON()||null,i=null,o=!1;"point-cloud-unique-value"===r?i=l(e.attributeStorageInfo,t.field):"point-cloud-stretch"===r?i=l(e.attributeStorageInfo,t.field):"point-cloud-class-breaks"===r?i=l(e.attributeStorageInfo,t.field):o="point-cloud-rgb"===r?null!=(i=s(e.attributeStorageInfo,t.field)):null!=(i=s(e.attributeStorageInfo,"RGB"));var a=null;return t&&t.colorModulation&&(a=l(e.attributeStorageInfo,t.colorModulation.field)),{rendererJSON:n,isRGBRenderer:o,primaryAttribute:i,modulationAttribute:a}},t.getFilterInfo=function(e){var t=e.filters;return t?t.map(function(t){return{filterJSON:t.toJSON(),attributeInfo:l(e.attributeStorageInfo,t.field)}}):[]},t.evaluateRenderer=function(e,t,o,a,s){var l=e.rendererJSON,p=e.isRGBRenderer,c=e.primaryAttribute,h=e.modulationAttribute,f=u(c,t,a,s),y=u(h,o,a,s),g=null,v=null;if(f&&p)g=f;else if(f&&"pointCloudUniqueValueRenderer"===l.type){var m=(v=i.fromJSON(l)).colorUniqueValueInfos;g=new Uint8Array(3*s);for(var _=d(v.fieldTransformType),b=0;b<s;b++)for(var S=(P=_?_(f[b]):f[b])+"",x=0;x<m.length;x++)if(m[x].values.indexOf(S)>=0){g[3*b]=m[x].color.r,g[3*b+1]=m[x].color.g,g[3*b+2]=m[x].color.b;break}}else if(f&&"pointCloudStretchRenderer"===l.type){var w=(v=n.fromJSON(l)).stops;for(g=new Uint8Array(3*s),_=d(v.fieldTransformType),b=0;b<s;b++){var P=_?_(f[b]):f[b],R=w.length-1;if(P<w[0].value)g[3*b]=w[0].color.r,g[3*b+1]=w[0].color.g,g[3*b+2]=w[0].color.b;else if(P>=w[R].value)g[3*b]=w[R].color.r,g[3*b+1]=w[R].color.g,g[3*b+2]=w[R].color.b;else for(x=1;x<w.length;x++)if(P<w[x].value){var N=(P-w[x-1].value)/(w[x].value-w[x-1].value);g[3*b]=w[x].color.r*N+w[x-1].color.r*(1-N),g[3*b+1]=w[x].color.g*N+w[x-1].color.g*(1-N),g[3*b+2]=w[x].color.b*N+w[x-1].color.b*(1-N);break}}}else if(f&&"pointCloudClassBreaksRenderer"===l.type){var O=(v=r.fromJSON(l)).colorClassBreakInfos;for(g=new Uint8Array(3*s),_=d(v.fieldTransformType),b=0;b<s;b++)for(P=_?_(f[b]):f[b],x=0;x<O.length;x++)if(P>=O[x].minValue&&P<=O[x].maxValue){g[3*b]=O[x].color.r,g[3*b+1]=O[x].color.g,g[3*b+2]=O[x].color.b;break}}else for(g=new Uint8Array(3*s),b=0;b<g.length;b++)g[b]=255;if(y&&v&&v.colorModulation){var z=v.colorModulation.minValue,I=v.colorModulation.maxValue;for(b=0;b<s;b++){var M=(P=y[b])>=I?1:P<=z?.3:.3+.7*(P-z)/(I-z);g[3*b]=M*g[3*b],g[3*b+1]=M*g[3*b+1],g[3*b+2]=M*g[3*b+2]}}return g},t.filterInPlace=function(e,t,r,n){for(var i=e.length/3,o=n.map(function(t,n){return u(r[n].attributeInfo,t,e,i)}),s=0,l=0;l<i;l++){for(var d=!0,p=0;p<r.length&&d;p++){var c=r[p].filterJSON,h=o[p][l];switch(c.type){case"pointCloudValueFilter":var f="exclude"===c.mode;-1!==c.values.indexOf(h)===f&&(d=!1);break;case"pointCloudBitfieldFilter":var y=a(c.requiredSetBits),g=a(c.requiredClearBits);(h&y)===y&&0==(h&g)||(d=!1);break;case"pointCloudReturnFilter":for(var v=15&h,m=h>>>4&15,_=m>1,b=1===v,S=v===m,x=!1,w=0,P=c.includedReturns;w<P.length;w++){var R=P[w];if("last"===R&&S||"firstOfMany"===R&&b&&_||"lastOfMany"===R&&S&&_||"single"===R&&!_){x=!0;break}}x||(d=!1)}}d&&(e[3*s]=e[3*l],e[3*s+1]=e[3*l+1],e[3*s+2]=e[3*l+2],t[3*s]=t[3*l],t[3*s+1]=t[3*l+1],t[3*s+2]=t[3*l+2],s++)}return s},t.getSplatSizeAlgorithm=function(e){var t=e&&e.pointSizeAlgorithm;return t&&"splat"===t.type?t:null},t.getFixedSizeAlgorithm=function(e){var t=e&&e.pointSizeAlgorithm;return t&&"fixed-size"===t.type?t:null},t.rendererUsesFixedSizes=function(e){var t=e&&e.pointSizeAlgorithm;return!(!t||!t.type)&&"fixed-size"===t.type}}.apply(null,n))||(e.exports=i)},2451:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(48),r(45),r(45),r(11),r(8),r(17),r(68),r(28),r(0),r(4),r(260),r(43),r(35),r(95),r(1521),r(369),r(1466),r(1428),r(1467),r(2452),r(2453),r(1639),r(2454),r(1472),r(30),r(1479),r(38),r(563)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p,c,h,f,y,g,v,m,_,b,S,x,w,P,R,N,O,z,I,M,C){var j=s.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),k=z.plane.create(),V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.maximumPointCount=4e6,t.slicePlaneEnabled=!1,t._renderer=null,t._rendererAdded=!1,t._renderedNodes=new Set,t._nodeScales=new Map,t._updateViewNeeded=!0,t._lodFactor=1,t._worker=new S.PointCloudWorker,t._maxLoggedBoxWarnings=5,t._pageMultiplier=1,t._indexQueue=[],t._workQueue=[],t._idleQueue=new m.PromiseQueue,t._indexPagesLoading=new Map,t._loadingNodes=new Map,t._layerIsVisible=!1,t._totalWork=0,t._index=null,t._loadingInitNodePage=!1,t._nodeIdArray=[],t}return r(t,e),Object.defineProperty(t.prototype,"pointScale",{get:function(){var e=R.getSplatSizeAlgorithm(this.layer.renderer);return e&&null!=e.scaleFactor?e.scaleFactor:1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useRealWorldSymbolSizes",{get:function(){var e=R.getFixedSizeAlgorithm(this.layer.renderer);return!(!e||null==e.useRealWorldSymbolSizes)&&e.useRealWorldSymbolSizes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointSize",{get:function(){var e=R.getFixedSizeAlgorithm(this.layer.renderer);return e&&null!=e.size?e.size:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inverseDensity",{get:function(){return this.layer.renderer?96/this.layer.renderer.pointsPerInch:5},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_clippingBox",{get:function(){var e=y.create(),t=this.view.renderSpatialReference;return M.extentToBoundingBox(this.view.clippingArea,e,t)?e:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_elevationOffset",{get:function(){var e=this.layer.elevationInfo;if(e&&"absolute-height"===e.mode){var t=d.getMetersPerVerticalUnitForSR(this.layer.spatialReference),r=_.getMetersPerUnit(e.unit);return(e.offset||0)*r/t}return 0},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this._tmpPoint=v.makeDehydratedPoint(0,0,0,this.layer.spatialReference),x.checkPointCloudLayerValid(this.layer),x.checkPointCloudLayerCompatibleWithView(this.layer,this.view),this._initRenderer();var t=this._initNodePages(),r=this.view.resourceController.memoryController;this._memCache=r.getMemCache(this.layer.uid),this.handles.add([p.init(this,"_clippingBox",function(){return e._setUpdateViewNeeded()}),p.init(this,"_elevationOffset",function(){return e._elevationOffsetChanged()}),p.init(this.layer,"renderer",function(){return e._rendererChanged()}),p.init(this.layer,"filters",function(){return e._filterChanged()}),this.view.basemapTerrain.on("scale-change",function(t){return e._scaleUpdateHandler(t)}),this.layer.watch(["minScale","maxScale"],function(){return e._setUpdateViewNeeded()}),p.init(this,"clippingArea",function(){e._setUpdateViewNeeded()}),this.view.state.watch("camera",function(){return e._setUpdateViewNeeded()}),r.events.on("quality-changed",function(){return e._setUpdateViewNeeded()})]),this.addResolvingPromise(t);var n=this.view.resourceController.scheduler;this.when(function(){e.handles.add([n.registerTask(2,function(t){return e._process(t)},function(){return e._needsUpdate()}),n.registerIdleStateCallbacks(function(){return e._idleBegin()},function(){return e._idleEnd()}),p.init(e,"suspended",function(t){t?e._clearNodeState():e._setUpdateViewNeeded()})])})},t.prototype._setUpdateViewNeeded=function(){this._updateViewNeeded=!0,this._updateLoading()},t.prototype.destroy=function(){this.cancelLoading(),this._worker.destroy(),this._worker=null,this._destroyRenderer(),this._memCache.destroy(),this._memCache=null},t.prototype._initRenderer=function(){var e=this;this._renderer=new N,this._renderer.layerUid=this.layer.uid,this.handles.add(p.init(this,"_clippingBox",function(t){return e._renderer.clippingBox=t})),this.handles.add(p.init(this,"suspended",function(t){return e._setPointsVisible(!t)})),this.handles.add(p.init(this,"pointScale",function(t){return e._renderer.scaleFactor=t})),this._renderer.minSizePx=Math.sqrt(2),this.handles.add(p.init(this,"useRealWorldSymbolSizes",function(t){return e._renderer.useRealWorldSymbolSizes=t})),this.handles.add(p.init(this,"pointSize",function(t){var r=u.pt2px(t);e._renderer.size=t,e._renderer.sizePx=r})),this.handles.add(p.init(this,"slicePlaneEnabled",function(t){return e._renderer.slicePlaneEnabled=t})),this.handles.add(p.init(this,["inverseDensity","maximumPointCount"],function(){return e._setUpdateViewNeeded()})),this.handles.add(p.init(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",function(t){e._lodFactor=t,e._setUpdateViewNeeded()}))},t.prototype._destroyRenderer=function(){this._renderer.removeAll(),this._setPointsVisible(!1)},t.prototype._setPointsVisible=function(e){e&&!this._rendererAdded?(this.view._stage.addRenderPlugin([6],this._renderer),this._rendererAdded=!0):!e&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)},t.prototype._rendererChanged=function(){this._clearNodeState(),this._memCache.clear(),this._renderer.useFixedSizes=R.rendererUsesFixedSizes(this.layer.renderer),this._setUpdateViewNeeded()},t.prototype._filterChanged=function(){this._clearNodeState(),this._memCache.clear(),this._setUpdateViewNeeded()},t.prototype._elevationOffsetChanged=function(){this._clearNodeState(),this._memCache.clear(),this._initNodePages()},t.prototype._scaleUpdateHandler=function(e){var t=this;this.layer.minScale||this.layer.maxScale?M.boundingRectToBoundingRect(e.extent,e.spatialReference,A,this.layer.spatialReference)&&(this._nodeScales.forEach(function(r,n){if(t._renderedNodes.has(n)){var i=t._index.getNode(n);g.containsPoint(A,i.obb.center)&&t._nodeScales.set(n,e.scale)}else t._nodeScales.delete(n)}),this._setUpdateViewNeeded()):this._nodeScales.clear()},t.prototype.displayNodes=function(e){this._workQueue=w.nodeDiff(o.keysOfSet(this._renderedNodes),e,this._index),w.sortFrontToBack(this._workQueue,this.view.state.camera.viewForward,this._index),w.splitWorkEntries(this._workQueue,8,this._index),this._updateQueues(),this._totalWork=this._computeWork(),this._updateLoading(),this._layerIsVisible=e.length>0||this._loadingInitNodePage,this.notifyChange("suspended")},t.prototype.cancelLoading=function(){this._cancelNodeLoading(),this._cancelIndexLoading()},t.prototype._cancelNodeLoading=function(){var e=[];this._loadingNodes.forEach(function(t){var r=t.abortController;return e.push(r)}),this._loadingNodes.clear();for(var t=0,r=e;t<r.length;t++)r[t].abort();this._workQueue=[],this._idleQueue.cancelAll(),this._totalWork=this._computeWork(),this._updateLoading()},t.prototype._updateQueues=function(){var e=this,t=new Set;this._workQueue.forEach(function(e){e.load.forEach(function(e){t.add(e)})});var r=[],n=new Map;this._loadingNodes.forEach(function(e,i){t.has(i)?n.set(i,e):r.push(e)}),this._loadingNodes=n;for(var i=0,o=r;i<o.length;i++)o[i].abortController.abort();this._workQueue=this._workQueue.filter(function(t){for(var r=0,n=t.load;r<n.length;r++){var i=n[r];if(e._loadingNodes.has(i))return!1}return!0}),this._totalWork=this._computeWork(),this._updateLoading()},t.prototype._cancelIndexLoading=function(){this._indexQueue=[],this._indexPagesLoading.forEach(function(e){return e.abortController.abort()}),this._indexPagesLoading.clear(),this._totalWork=this._computeWork(),this._updateLoading()},t.prototype._clearNodeState=function(){var e=this;this._renderedNodes.forEach(function(t){return e._removeFromRenderer(t)}),this._cancelNodeLoading()},t.prototype._idleBegin=function(){this._setUpdateViewNeeded()},t.prototype._idleEnd=function(){this._setUpdateViewNeeded()},t.prototype._needsUpdate=function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||this._indexQueue.length>0||this._workQueue.length>0||this._idleQueue.length>0},t.prototype._process=function(e){var t=this;if(this.suspended){if(this._updateViewNeeded){this._updateViewNeeded=!1;var r=this._isRootNodeVisible();r!==this._layerIsVisible&&(this._layerIsVisible=r,this.notifyChange("suspended"))}}else{for(e.run(function(){return t._updateWorkQueues()});this._indexQueue.length>0&&e.run(function(){return t._processIndexQueue()}););for(this._processWorkQueue(e);this._idleQueue.length>0&&e.run(function(){return t._idleQueue.process()}););}},t.prototype._processIndexQueue=function(){var e=this,t=this._indexQueue.shift(),r=this._loadNodePage(t);return this._indexPagesLoading.set(t,r),r.promise.then(function(r){e._index.addPage(t,r,e._elevationOffset),e._setUpdateViewNeeded()}).then(function(){e._indexPagesLoading.delete(t)},function(){e._indexPagesLoading.delete(t)}),!0},t.prototype._processWorkQueue=function(e){for(;!e.done;){var t=this._scheduleWorkEntry();if(!t)return;this._processWorkEntry(t),e.madeProgress()}},t.prototype._scheduleWorkEntry=function(){var e=this;if(this._loadingNodes.size>=8)return null;for(var t=0;t<this._workQueue.length;++t){var r=this._workQueue[t];if(!a.find(r.remove,function(t){return!e._renderedNodes.has(t)})){for(var n=t;n>0;--n)this._workQueue[n]=this._workQueue[n-1];return this._workQueue.shift(),r}}return null},t.prototype._processWorkEntry=function(e){var t=this;if(0!==e.load.length)l.all(e.load.map(function(e){var r=l.createAbortController(),n=t._memCache.pop(e.toString());return n?t._loadingNodes.set(e,{abortController:r,promise:l.resolve(n)}):t._loadingNodes.has(e)||t._loadingNodes.set(e,{abortController:r,promise:t.loadNode(e,r.signal)}),t._loadingNodes.get(e).promise})).then(function(r){for(var n=0;n<e.load.length;n++)if(r[n]){var i=t._setupRendererData(e.load[n],r[n]);t._addToRenderer(i)}for(n=0;n<e.remove.length;n++)t._removeFromRenderer(e.remove[n])}).catch(function(){}).then(function(){for(var r=0;r<e.load.length;r++)t._loadingNodes.delete(e.load[r]);t._updateLoading()}),this._updateLoading();else for(var r=0;r<e.remove.length;r++)this._removeFromRenderer(e.remove[r])},t.prototype._computeWork=function(){for(var e=0,t=0;t<this._workQueue.length;t++)e+=this._workQueue[t].load.length;return e+=this._loadingNodes.size,e+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize,(e+=this._loadingInitNodePage?100:0)+(this._updateViewNeeded?100:0)},Object.defineProperty(t.prototype,"updatingPercentageValue",{get:function(){var e=this._computeWork();return 100*Math.min(this._totalWork,e)/this._totalWork},enumerable:!0,configurable:!0}),t.prototype._updateLoading=function(){this.notifyChange("updating"),this.notifyChange("updatingPercentageValue")},t.prototype.canResume=function(){return this.inherited(arguments)&&this._layerIsVisible},t.prototype.isUpdating=function(){return this._computeWork()>0},t.prototype._initNodePages=function(){var e=this,t=this.layer.store.index,r=t.nodesPerPage||t.nodePerIndexBlock;return this._index=new P(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,r),this._cancelIndexLoading(),this._traverseVisible=this._index.createVisibilityTraverse(),this._loadingInitNodePage=!0,this._layerIsVisible=!0,this.notifyChange("suspended"),this._updateLoading(),this._pageMultiplier=null!=t.nodesPerPage?1:t.nodePerIndexBlock,this._loadNodePage(0).promise.then(function(t){e._index.addPage(0,t,e._elevationOffset),e._loadingInitNodePage=!1,e._setUpdateViewNeeded()})},t.prototype._loadNodePage=function(e){var t=this,r=l.createAbortController(),n=this.baseUrl+"/nodepages/"+e*this._pageMultiplier;return{promise:this._requestJSON(n,r.signal).then(function(r){return r.data.nodes.map(function(r,n){return{resourceId:null!=r.resourceId?r.resourceId:e*t._index.pageSize+n,obb:r.obb,firstChild:r.firstChild,childCount:r.childCount,vertexCount:null!=r.vertexCount?r.vertexCount:r.pointCount,lodThreshold:null!=r.lodThreshold?r.lodThreshold:r.effectiveArea}})}),abortController:r}},t.prototype._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;for(var e=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor(),t=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor(),r=this._computeNodesForMinimumDensity(e),n=this._computePointCount(r),i=Math.sqrt(n/(.75*t));n>t;)e*=i,r=this._computeNodesForMinimumDensity(e),n=this._computePointCount(r),i=Math.sqrt(2);return this.displayNodes(r),this._updateViewNeeded=!1,this._updateLoading(),!0},t.prototype._computePointCount=function(e){for(var t=0,r=0;r<e.length;r++){var n=this._index.getNode(e[r]);n&&(t+=n.vertexCount)}return t},t.prototype._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor},t.prototype._isRootNodeVisible=function(){var e=!1;return this._traverseVisible({frustumPlanes:this.view.state.camera.frustum.planes,clippingBox:this._clippingBox},{predicate:function(t,r,n){return e=n,!1},pageMiss:function(e,t){}}),e},t.prototype._computeNodesForMinimumDensity=function(e){var t=this,r=this.view.state.camera,n=r.frustum,i=this._clippingBox,o=r.viewForward,a=h.vec3.dot(o,r.eye),s=z.plane.fromNormalAndOffset(o,-a,k),l=r.perScreenPixelRatio/2,u=e*e,d=this._nodeIdArray;d.length=0;var p=C.extractSafeScaleBounds(this.layer),c=p.minScale,f=p.maxScale,y=0===c&&0===f?function(e){return d.push(e)}:function(e){var r=t._getScale(e);C.scaleBoundsPredicate(r,c,f)&&d.push(e)};return this._traverseVisible({frustumPlanes:n.planes,clippingBox:i},{predicate:function(e,r,n){if(!n)return!1;if(0===r.childCount)return y(e),!1;var i=t._index.getRenderObb(e);return!(t._computeAveragePixelArea(i,r.lodThreshold,r.vertexCount,s,l)<=u&&(y(e),1))},pageMiss:function(e,r){y(e),t._indexQueue.indexOf(r)<0&&t._indexQueue.push(r)}}),d},t.prototype._getScale=function(e){var t=this._nodeScales.get(e);if(null==t){var r=this._index.getNode(e).obb.center;this._tmpPoint.x=r[0],this._tmpPoint.y=r[1],this._tmpPoint.z=r[2],t=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(e,t)}return t},t.prototype._computeAveragePixelArea=function(e,t,r,n,i){var o=Math.max(1e-7,I.minimumDistancePlane(e,n));return t/(o*o)/(4*i*i)/r},t.prototype.loadNode=function(e,t){var r=this,n=this._index.getNode(e),i=R.getRendererInfo(this.layer),o=R.getFilterInfo(this.layer),a=n.resourceId,s=[],u=function(e){var n=r.loadAttribute(a,e,t);return s.push(n),n};return this._idleQueue.push().then(function(){var e=r.loadGeometry(a,t);s.push(e);var n=u(i.primaryAttribute),d=u(i.modulationAttribute),p=o.map(function(e){return u(e.attributeInfo)});return l.all([e,n,d,l.all(p)])}).then(function(n){var a=n[0],s=n[1],l=n[2],u=n[3],d=[a];s&&d.push(s),l&&d.push(l);for(var p=0,c=u;p<c.length;p++){var h=c[p];d.push(h)}var f={geometryBuffer:a,primaryAttribute:s,modulationAttribute:l,filterAttributes:u,schema:r.layer.store.defaultGeometrySchema,rendererInfo:i,filterInfo:o,obb:r._index.getRenderObb(e),elevationOffset:r._elevationOffset,inSR:r.layer.spatialReference.toJSON(),outSR:r.view.renderCoordsHelper.spatialReference.toJSON()};return r._worker.transform(f,d,t)}).catch(function(e){return l.isAbortError(e)||j.error(e),l.reject(e)})},t.prototype.loadGeometry=function(e,t){var r=this.baseUrl+"/nodes/"+e+"/geometries/0";return this._requestBinary(r,t).then(function(e){return e.data})},t.prototype.loadAttribute=function(e,t,r){if(!t||!t.storageInfo)return l.resolve(null);var n=t.storageInfo.key,i=this.baseUrl+"/nodes/"+e+"/attributes/"+n;return this._requestBinary(i,r).then(function(e){return e.data})},t.prototype._requestJSON=function(e,t){return i(e,{query:{f:"json"},responseType:"json",signal:t})},t.prototype._requestBinary=function(e,t){return i(e,{responseType:"array-buffer",signal:t})},t.prototype._removeFromRenderer=function(e){if(this._renderedNodes.has(e)){var t=this._renderer.removeNode(e);this._renderedNodes.delete(e),this._nodeScales.delete(e),this._memCache.put(t.id.toString(),t,function(e){return 5*e.coordinates.length+128}(t))}},t.prototype._addToRenderer=function(e){this._renderedNodes.has(e.id)||(this._renderedNodes.add(e.id),this._renderer.addNode(e))},t.prototype._setupRendererData=function(e,t){var r=this._index.getNode(e),n=Math.sqrt(r.lodThreshold/r.vertexCount),i=this._index.getRenderObb(e);if(N.isInstanceOfNode(t))return t.splatSize=n,t.obb=i,t.origin=f.vec3f32.clone(t.obb.center),t;if(t.obb.halfSize[0]>i.halfSize[0]||t.obb.halfSize[1]>i.halfSize[1]||t.obb.halfSize[2]>i.halfSize[2]){if(this._maxLoggedBoxWarnings>0){var o=function(e){return"["+e.halfSize[0]+", "+e.halfSize[1]+", "+e.halfSize[2]+"]"};j.warn("Node "+e+" reported bounding box too small. got "+o(i)+" but points cover "+o(t.obb)),0==--this._maxLoggedBoxWarnings&&j.warn("  Too many bounding box errors, stopping reporting for this layer.")}this._index.setRenderObb(e,t.obb)}return{id:e,coordinates:t.points,origin:f.vec3f32.clone(i.center),rgb:t.rgb,splatSize:n,obb:i,isLeaf:0===r.childCount}},t.prototype.getUsedMemory=function(){var e=this;return o.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+15*e._index.getNode(r).vertexCount+128},0)},t.prototype.getUnloadedMemory=function(){var e=this,t=this._renderedNodes.size;if(t<4)return 0;for(var r=o.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+e._index.getNode(r).vertexCount}),n=this._loadingNodes.size,i=0;i<this._workQueue.length;i++)n+=this._workQueue[i].load.length,n-=this._workQueue[i].remove.length;return n<0?0:n*r/t*15+128*n},t.prototype.ignoresMemoryFactor=function(){return!1},t.prototype.getStats=function(){var e=this;return{"Rendered Nodes":this._renderedNodes.size,"Rendered Points":o.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+e._index.getNode(r).vertexCount},0),"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}},n([c.property()],t.prototype,"layer",void 0),n([c.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],t.prototype,"baseUrl",void 0),n([c.property({readOnly:!0,dependsOn:["layer.renderer"]})],t.prototype,"pointScale",null),n([c.property({readOnly:!0,dependsOn:["layer.renderer"]})],t.prototype,"useRealWorldSymbolSizes",null),n([c.property({readOnly:!0,dependsOn:["layer.renderer"]})],t.prototype,"pointSize",null),n([c.property({readOnly:!0,dependsOn:["layer.renderer"]})],t.prototype,"inverseDensity",null),n([c.property()],t.prototype,"maximumPointCount",void 0),n([c.property({readOnly:!0,dependsOn:["view.clippingArea"]})],t.prototype,"_clippingBox",null),n([c.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],t.prototype,"_elevationOffset",null),n([c.property({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),n([c.property(O.updatingPercentage)],t.prototype,"updatingPercentage",void 0),n([c.property({readOnly:!0})],t.prototype,"updatingPercentageValue",null),n([c.subclass("esri.views.3d.layers.PointCloudLayerView3D")],t)}(c.declared(b)),A=g.create();return V}.apply(null,n))||(e.exports=i)},2452:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(4)],void 0===(i=function(e,t,r){function n(e,t,r){for(var n=e;n>0;){var i=t.indexOf(n);if(i>=0)return i;n=r.getParentId(n)}return t.indexOf(n)}function i(e,t){for(var r=[e.remove[0]],n=[];1===r.length;){var i=r.pop();n.length=0;for(var o=0;o<e.load.length;o++){for(var a=e.load[o],s=t.getParentId(a);s!==i;)a=s,s=t.getParentId(a);var l=r.indexOf(a);l<0&&(l=r.length,r.push(a),n.push([])),n[l].push(e.load[o])}}var u=[];u.push({remove:e.remove,load:r});for(o=0;o<r.length;o++)n[o].length>1?u.push({remove:[r[o]],load:n[o]}):r[o]=n[o][0];return u}Object.defineProperty(t,"__esModule",{value:!0}),t.nodeDiff=function(e,t,r){for(var i=0;i<t.length;i++)s[i]=!1,l[i]=null;for(i=0;i<e.length;i++)o[i]=!1,a[i]=null;for(i=0;i<t.length;i++)(u=n(t[i],e,r))>=0&&(s[i]=!0,null!=a[u]?a[u].push(t[i]):a[u]=[t[i]]);for(i=0;i<e.length;i++){var u;(u=n(e[i],t,r))>=0&&(o[i]=!0,null!=l[u]?l[u].push(e[i]):l[u]=[e[i]])}var d=[];for(i=0;i<e.length;i++)null!=a[i]||o[i]||d.push({load:[],remove:[e[i]]});for(i=0;i<t.length;i++)null!=l[i]||s[i]||d.push({load:[t[i]],remove:[]});for(i=0;i<t.length;i++)null!=l[i]&&(l[i].length>1||l[i][0]!==t[i])&&d.push({load:[t[i]],remove:l[i]});for(i=0;i<e.length;i++)null!=a[i]&&(a[i].length>1||a[i][0]!==e[i])&&d.push({load:a[i],remove:[e[i]]});return d};var o=[!1],a=[null],s=[!1],l=[null];t.sortFrontToBack=function(e,t,n){return e.sort(function(e,i){if(0===e.load.length&&0===i.load.length)return 0;if(0===e.load.length)return-1;if(0===i.load.length)return 1;if(0===e.remove.length&&0===i.remove.length){var o=n.getRenderCenter(e.load[0]),a=n.getRenderCenter(i.load[0]);return r.vec3.dot(o,t)-r.vec3.dot(a,t)}return 0===e.remove.length?-1:0===i.remove.length?1:1===e.load.length&&1===i.load.length?(o=n.getRenderCenter(e.load[0]),a=n.getRenderCenter(i.load[0]),r.vec3.dot(o,t)-r.vec3.dot(a,t)):1===e.load.length?-1:1===i.load.length?1:(o=n.getRenderCenter(e.remove[0]),a=n.getRenderCenter(i.remove[0]),r.vec3.dot(o,t)-r.vec3.dot(a,t))})},t.splitWorkEntries=function(e,t,r){for(var n=0;n<e.length;++n){var o=e[n];if(o.load.length>t&&1===o.remove.length){var a=i(o,r);e[n]=a[0];for(var s=1;s<a.length;s++)e.push(a[s])}}},t.splitWorkEntry=i}.apply(null,n))||(e.exports=i)},2453:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(19),r(365),r(1549),r(4),r(3),r(43),r(1479),r(38)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u){function d(e,t,r,i){for(var a=new l.ObbArray(e.length),s=0;s<e.length;s++){var d=e[s].obb,p=a.obbs[s];if(l.set(d,p),o.vec3.set(h,d.center[0],d.center[1],d.center[2]+i),!t.isGeographic&&r===u.SphericalECEFSpatialReference){u.computeLinearTransformation(t,h,y,r);var c=2*Math.sqrt(1+y[0]+y[5]+y[10]);g[0]=(y[9]-y[6])/c,g[1]=(y[2]-y[8])/c,g[2]=(y[4]-y[1])/c,g[3]=.25*c,n.quat.conjugate(g,g),n.quat.multiply(p.quaternion,g,p.quaternion)}u.bufferToBuffer(h,t,0,p.center,r,0,1)}return a.obbs}function p(e,t){return e/t|0}function c(e,t){return e%t}var h=a.vec3f64.create(),f=function(){function e(e,t,r){this._pages=[],this.pageSize=0,this._nodeSR=null,this._renderSR=null,this._nodeSR=e,this._renderSR=t,this.pageSize=r}return e.prototype.addPage=function(e,t,r){for(void 0===r&&(r=0);this._pages.length<e;)this._pages.push(null);var n=d(t,this._nodeSR,this._renderSR,r);this._pages[e]={nodes:t,renderObbs:n,parents:new Uint32Array(this.pageSize)},function(e,t){for(var r=[0];r.length;)for(var n=r.pop(),i=e[p(n,t)].nodes[c(n,t)],o=0;o<i.childCount;o++){var a=i.firstChild+o;null!=e[p(a,t)]&&(e[p(a,t)].parents[c(a,t)]=n,r.push(a))}}(this._pages,this.pageSize)},e.prototype.hasPage=function(e){return!!this._pages[e]},e.prototype.getNode=function(e){var t=this.pageSize;return this._pages[p(e,t)].nodes[c(e,t)]},e.prototype.getRenderObb=function(e){var t=this.pageSize;return this._pages[p(e,t)].renderObbs[c(e,t)]},e.prototype.getRenderCenter=function(e){return this.getRenderObb(e).center},e.prototype.setRenderObb=function(e,t){var r=this.pageSize;l.set(t,this._pages[p(e,r)].renderObbs[c(e,r)])},e.prototype.getParentId=function(e){var t=this.pageSize;return this._pages[p(e,t)].parents[c(e,t)]},e.prototype.hasNodes=function(e,t){for(var r=p(e,this.pageSize),n=p(e+t-1,this.pageSize),i=r;i<=n;i++)if(null==this._pages[i])return!1;return!0},e.prototype.createVisibilityTraverse=function(){var e={index:this,queue:[],masks:[],tempAabb:s.create()};return function(t,r){return function(e,t,r){var n=e.index;if(n.hasNodes(0,1)){var i=e.queue;i.length=0,i.push(0);var o=e.masks;for(o.length=0,o.push(0);i.length>0;){var a=i.pop(),u=o.pop(),d=n.getNode(a),c=n.getRenderObb(a),h=!0;if(null!=t.clippingBox&&0==(u&(g=1<<t.frustumPlanes.length))){var f=l.toAaBoundingBox(c,e.tempAabb);s.contains(t.clippingBox,f)?u|=g:s.intersects(t.clippingBox,f)||(h=!1)}for(var y=0;y<t.frustumPlanes.length&&h;y++){var g;if(0==(u&(g=1<<y))){var v=l.intersectPlane(c,t.frustumPlanes[y]);v>0?h=!1:v<0&&(u|=g)}}if(r.predicate(a,d,h)){for(var m=d.firstChild,_=d.childCount,b=!1,S=p(m,n.pageSize),x=p(m+_-1,n.pageSize),w=S;w<=x;w++)if(!n.hasPage(w)){r.pageMiss(a,w),b=!0;break}if(!b)for(y=0;y<_;y++)i.push(m+y),o.push(u)}}}}(e,t,r)}},e}(),y=r.mat4f64.create(),g=i.quatf32.create();return f}.apply(null,n))||(e.exports=i)},2454:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(21),r(356),r(19),r(4),r(260),r(3),r(55),r(43),r(30),r(30),r(1479),r(141),r(612),r(58),r(2455),r(66),r(44),r(70)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,p,c,h,f,y,g,v,m,_){function b(e){return e?256:64}function S(e,t,r,n,i){if(r.drawScreenSpace)return r.fixedSize*t*n;var o=b(i)*t*n;return r.drawFixedSize?Math.min(r.fixedSize/2,o):r.screenMinSize>0?Math.min(Math.max(r.screenMinSize*t*n,e/2),o):Math.min(e/2,o)}function x(e,t,r,n,i){return r.drawScreenSpace?0:S(e,t,r,n,i)}function w(e,t,r){return null==r&&(r=s.vec3f64.create()),r[0]=e.origin[0]+e.coordinates[3*t],r[1]=e.origin[1]+e.coordinates[3*t+1],r[2]=e.origin[2]+e.coordinates[3*t+2],r}var P=i.mat4f64.create(),R={positions:[{name:"aPosition",count:3,type:5126,offset:0,stride:12,normalized:!1}],colors:[{name:"aColor",count:3,type:5121,offset:0,stride:3,normalized:!0}]},N=function(){function e(){this.needsRender=!1,this.layerUid="",this._useFixedSizes=!1,this._scaleFactor=1,this._minSizePx=0,this._useRealWorldSymbolSizes=!1,this._size=0,this._sizePx=0,this._slicePlaneEnabled=!1,this._clipBox=u.create(u.POSITIVE_INFINITY),this._programRep=null,this._needsPrograms=!0,this._programWorld=null,this._programScreen=null,this._programWorldDepth=null,this._programScreenDepth=null,this.tempMatrix4=n.mat4f32.create(),this.tempVec3=a.vec3f32.create(),this.nodes=[]}return e.prototype.initializeRenderContext=function(e){var t=e.rctx;this._programRep=new f(t),this.needsRender=!0,this._needsPrograms=!0},e.prototype.uninitializeRenderContext=function(e){this._programRep.dispose(),this._programRep=null,this._programWorld=null,this._programScreen=null,this._programWorldDepth=null,this._programScreenDepth=null},e.prototype.intersect=function(e,t,r,n,i){var a=s.vec3f64.create(),f=s.vec3f64.create(),y=s.vec3f64.create(),g=s.vec3f64.create(),v=p.plane.create(),m=e.camera.perScreenPixelRatio/2,_=e.camera.near,b=this._getSizeParams();o.vec3.subtract(f,n,r);var R=1/o.vec3.length(f);o.vec3.scale(f,f,R),o.vec3.negate(y,f),l.vec4.set(v,f[0],f[1],f[2],-o.vec3.dot(f,r));var N={},O={},z=[],I=u.create(),M=u.create(this._clipBox);u.offset(M,-r[0],-r[1],-r[2],M);for(var C=0,j=this.nodes;C<j.length;C++){var k=j[C],V=k.splatSize*this._scaleFactor,A=c.minimumDistancePlane(k.obb,v),F=c.maximumDistancePlane(k.obb,v);if(A-=x(V,A+_,b,m,k.isLeaf),!((F-=x(V,F+_,b,m,k.isLeaf))<0)&&!(null!=N.dist&&null!=O.dist&&N.dist<A*R&&O.dist>F*R)){var U=S(V,F+_,b,m,k.isLeaf);if(c.intersectLine(k.obb,r,f,U)){var L=U*U;c.toAaBoundingBox(k.obb,I),u.offset(I,-r[0],-r[1],-r[2],I);var T=!u.contains(M,I);o.vec3.subtract(g,k.origin,r);for(var W=k.coordinates.length/3,E=0;E<W;E++)if(a[0]=g[0]+k.coordinates[3*E],a[1]=g[1]+k.coordinates[3*E+1],a[2]=g[2]+k.coordinates[3*E+2],!T||u.containsPoint(M,a)){var B=o.vec3.dot(a,f),Q=o.vec3.squaredLength(a)-B*B;if(!(Q>L)){var q=B+_,D=x(V,q,b,m,k.isLeaf);if(!(B-D<0)){var J=S(V,q-=D,b,m,k.isLeaf);if(!(Q>J*J)){var G=this.layerUid+"/"+k.id+"/"+E,H=(B-D)*R;if(null==N.dist||H<N.dist){var X=N;(null==t||t(r,n,H))&&(X.point=w(k,E,X.point),X.dist=H,X.normal=y,X.pointId=G,X.layerUid=this.layerUid)}if(null==O.dist||H>O.dist){X=O;(null==t||t(r,n,H))&&(X.point=w(k,E,X.point),X.dist=H,X.normal=y,X.pointId=G,X.layerUid=this.layerUid)}if((null==t||t(r,n,H))&&e.enable.storeAll){var Y={};Y.point=w(k,E,Y.point),Y.dist=H,Y.normal=y,Y.pointId=G,Y.layerUid=this.layerUid,z.push(Y)}}}}}}}}if(null!=N.dist){var Z=e.results.min;if(null==Z.dist||N.dist<Z.dist){var K={type:"external",point:N.point,metadata:{pointId:N.pointId,layerUid:N.layerUid}};Z.set(K,N.pointId,N.dist,N.normal,P,void 0),Z.intersector="PointRenderer"}}if(null!=O.dist){var $=e.results.max;if(null==$.dist||O.dist>$.dist){K={type:"external",point:O.point,metadata:{pointId:O.pointId,layerUid:O.layerUid}};$.set(K,O.pointId,O.dist,O.normal,P,void 0),$.intersector="PointRenderer"}}if(e.enable.storeAll)for(var ee=d.ray.fromPoints(r,n),te=0,re=z;te<re.length;te++){K={type:"external",point:(X=re[te]).point,metadata:{pointId:X.pointId,layerUid:X.layerUid}};var ne=new h.IntersectorResult(ee);ne.set(K,X.pointId,X.dist,X.normal,P,void 0),ne.intersector="PointRenderer",e.results.all.push(ne)}},e.prototype.render=function(e){if(0!==e.pass&&1!==e.pass)return!1;this.needsRender=!1;for(var t=1===e.pass,n=e.rctx,i=0,a=this.nodes;i<a.length;i++){null==(v=a[i]).vao&&this._initNode(e,v)}this._selectPrograms();var s=this._getSizeParams(),l=t?s.drawScreenSpace?this._programScreenDepth:this._programWorldDepth:s.drawScreenSpace?this._programScreen:this._programWorld;if(null==l||0===this.nodes.length)return!0;var d=this._clipBox,p=!u.equals(d,u.POSITIVE_INFINITY,function(e,t){return e===t});p||(o.vec3.set(this.tempVec3,-1/0,-1/0,-1/0),l.setUniform3fv("uClipMin",this.tempVec3),o.vec3.set(this.tempVec3,1/0,1/0,1/0),l.setUniform3fv("uClipMax",this.tempVec3)),n.bindProgram(l),n.setPipelineState(this._pipelineState),l.setUniformMatrix4fv("uProjectionMatrix",e.camera.projectionMatrix),t&&l.setUniform2f("nearFar",e.camera.near,e.camera.far);var c=e.camera.pixelRatio;s.drawFixedSize&&l.setUniform2f("uPointScale",s.fixedSize*c,e.camera.fullHeight);for(var h=this._slicePlaneEnabled?e.sliceHelper&&e.sliceHelper.plane:null,f=0,g=this.nodes;f<g.length;f++){var v=g[f];if(l.setUniform2f("uScreenMinMaxSize",s.screenMinSize*c,b(v.isLeaf)*c),!s.drawFixedSize){var m=v.splatSize*this._scaleFactor;l.setUniform2f("uPointScale",m*c,e.camera.fullHeight/c)}var _=v.origin;p&&(o.vec3.set(this.tempVec3,d[0]-_[0],d[1]-_[1],d[2]-_[2]),l.setUniform3fv("uClipMin",this.tempVec3),o.vec3.set(this.tempVec3,d[3]-_[0],d[4]-_[1],d[5]-_[2]),l.setUniform3fv("uClipMax",this.tempVec3)),r.mat4.identity(this.tempMatrix4),r.mat4.translate(this.tempMatrix4,this.tempMatrix4,_),r.mat4.multiply(this.tempMatrix4,e.camera.viewMatrix,this.tempMatrix4),l.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4),h&&y.bindSlicePlane(_,h,l),n.bindVAO(v.vao),n.drawArrays(0,0,v.coordinates.length/3)}return!0},Object.defineProperty(e.prototype,"useFixedSizes",{get:function(){return this._useFixedSizes},set:function(e){this._useFixedSizes!==e&&(this._useFixedSizes=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(e){this._scaleFactor!==e&&(this._scaleFactor=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minSizePx",{get:function(){return this._minSizePx},set:function(e){this._minSizePx!==e&&(this._minSizePx=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useRealWorldSymbolSizes",{get:function(){return this._useRealWorldSymbolSizes},set:function(e){this._useRealWorldSymbolSizes!==e&&(this._useRealWorldSymbolSizes=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){this._size!==e&&(this._size=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sizePx",{get:function(){return this._sizePx},set:function(e){this._sizePx!==e&&(this._sizePx=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clippingBox",{set:function(e){u.set(this._clipBox,e||u.POSITIVE_INFINITY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(e){this._slicePlaneEnabled!==e&&(this._slicePlaneEnabled=e,this._requestRender(),this._needsPrograms=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectionHandlerId",{get:function(){return this.layerUid},enumerable:!0,configurable:!0}),e.prototype.addNode=function(e){this.nodes.push(e),this._requestRender()},e.prototype.removeNode=function(e){var t=null;return this.nodes=this.nodes.filter(function(r){return r.id!==e||(t=r,r.vao&&(r.vao.dispose(!0),r.vao=null),!1)}),this._requestRender(),t},e.prototype.removeAll=function(){this.nodes.forEach(function(e){e.vao&&(e.vao.dispose(!0),e.vao=null)}),this.nodes=[],this._requestRender()},e.prototype._initNode=function(e,t){var r=e.rctx;t.vao=new _(r,g.program.attributes,R,{positions:v.createVertex(r,35044,t.coordinates),colors:v.createVertex(r,35044,t.rgb)})},e.prototype._requestRender=function(){this.needsRender=!0},e.prototype._getSizeParams=function(){var e=this._useFixedSizes,t=e&&!this._useRealWorldSymbolSizes,r=t?this._sizePx:this._size,n=this._minSizePx;return e&&(n=0),{drawScreenSpace:t,drawFixedSize:e,fixedSize:r,screenMinSize:n}},e.prototype._selectPrograms=function(){this._needsPrograms&&(this._needsPrograms=!1,this._programWorld=this._programRep.getProgram(g.program,{slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreen=this._programRep.getProgram(g.program,{drawScreenSize:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programWorldDepth=this._programRep.getProgram(g.program,{depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreenDepth=this._programRep.getProgram(g.program,{drawScreenSize:!0,depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._pipelineState=m.makePipelineState({depthTest:{func:513},depthWrite:m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams}))},e}();return function(e){(N||(N={})).isInstanceOfNode=function(e){return e.hasOwnProperty("splatSize")}}(),N}.apply(null,n))||(e.exports=i)},2455:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(61),r(51)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return n.glslifyDefineMap({DEPTH_PASS:e.depthPass,DRAW_SCREEN_SIZE:e.drawScreenSize,SLICE:e.slicePlaneEnabled})};t.program={name:"point-renderer",shaders:function(e){return{vertexShader:i(e)+r.resolveIncludes("pointRenderer/pointRenderer.vert"),fragmentShader:i(e)+r.resolveIncludes("pointRenderer/pointRenderer.frag")}},attributes:{aPosition:0,aColor:1}}}.apply(null,n))||(e.exports=i)}}]);