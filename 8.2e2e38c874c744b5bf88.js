(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":1482,"esri/core/libs/quickselect/quickselect":1487,"esri/views/3d/webgl-engine/lib/HighlightSet":1519,"esri/views/3d/layers/graphics/Graphics3DCore":1566,"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":1567,"esri/views/3d/layers/graphics/Graphics3DHighlights":1568,"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":1569,"esri/core/libs/rbush/PooledRBush":1590,"esri/renderers/support/rendererConversion":1681,"esri/views/3d/layers/graphics/Graphics3DFeatureStore":1682,"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":1683,"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":1684,"esri/views/3d/layers/graphics/Graphics3DPointSymbol":1685,"esri/views/3d/layers/graphics/SpatialIndex2D":1686,"esri/views/3d/layers/graphics/Graphics3DHighlightSet":1687})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{1482:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1484),i(553),i(551)],void 0===(n=function(e,t,i,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.optimizedFeatureQueryEngineAdapter={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new r.default(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return e.centroid||(e.centroid=i.getCentroidOptimizedGeometry(new n.default,e.geometry,t.hasZ,t.hasM)),e.centroid}},t.default=t.optimizedFeatureQueryEngineAdapter}.apply(null,r))||(e.exports=n)},1487:function(e,t,i){var r;void 0===(r=function(){"use strict";function e(i,r,n,a,s){for(;a>n;){if(a-n>600){var o=a-n+1,l=r-n+1,h=Math.log(o),p=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*p*(o-p)/o)*(l-o/2<0?-1:1);e(i,r,Math.max(n,Math.floor(r-l*p/o+c)),Math.min(a,Math.floor(r+(o-l)*p/o+c)),s)}var d=i[r],u=n,y=a;for(t(i,n,r),s(i[a],d)>0&&t(i,n,a);u<y;){for(t(i,u,y),u++,y--;s(i[u],d)<0;)u++;for(;s(i[y],d)>0;)y--}0===s(i[n],d)?t(i,n,y):t(i,++y,a),y<=r&&(n=y+1),r<=y&&(a=y-1)}}function t(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function i(e,t){return e<t?-1:e>t?1:0}return function(t,r,n,a,s){e(t,r,n||0,a||t.length-1,s||i)}}.apply(null,[]))||(e.exports=r)},1519:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:"object",highlightId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,i){this.items.push({type:"renderGeometry",highlightId:t,renderGeometry:e,owner:i})},e.prototype.addExternal=function(e,t){this.items.push({type:"external",highlightId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var i=this.items[t];i.highlightId===e&&(this.removeHighlight(i),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var i=this.items[t];"object"===i.type&&i.object===e&&(this.removeHighlight(i),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var i=this.items[t];"renderGeometry"===i.type&&i.renderGeometry===e&&(this.removeHighlight(i),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach(function(t){e.removeHighlight(t)}),this.items=[]},e.prototype.removeHighlight=function(e){switch(e.type){case"object":e.object.removeHighlights(e.highlightId);break;case"renderGeometry":e.owner.removeRenderGeometryHighlight(e.renderGeometry,e.highlightId);break;case"external":e.remove(e.highlightId)}},e}()}.apply(null,r))||(e.exports=n)},1566:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(10),i(12),i(42),i(359),i(69),i(6),i(45),i(25),i(15),i(20),i(207),i(11),i(24),i(14),i(85),i(86),i(8),i(28),i(0),i(3),i(43),i(35),i(118),i(95),i(570),i(1681),i(352),i(574),i(598),i(172),i(1682),i(595),i(1683),i(1684),i(596),i(78),i(1686),i(180),i(38),i(142),i(79),i(386),i(364),i(597)],void 0===(n=function(e,t,i,r,n,a,s,o,l,h,p,c,d,u,y,f,g,m,b,v,S,x,w,G,C,D,_,R,E,I,V,O,P,M,U,A,j,F,B,L,z,H,T,q,Y,X,k,W){var N=new s.Point,Q=G.vec3f64.create(),Z=C.create(),J=f.getLogger("esri.views.3d.layers.graphics.Graphics3DCore"),K=function(e){function t(t){var i=e.call(this)||this;return i.propertiesPool=new q.PropertiesPool({computedExtent:s.Extent},i),i.computedExtent=null,i.currentRenderer=null,i.rendererHasGeometryOperations=!1,i.symbolCreationContext=new j.Graphics3DSymbolCreationContext,i.graphics3DGraphics=new Map,i.stageLayer=null,i.stage=null,i.graphicsDrapedUids=new Set,i.graphicsBySymbol=new Map,i.symbolConversionCache=new Map,i.symbols=new Map,i.graphicsWithoutSymbol={},i.graphicsWaitingForSymbol=new Set,i.handles=new u,i.suspendSymbolCleanup=!1,i._spatialReference=null,i.elevationAlignment=null,i.scaleVisibility=null,i.filterVisibility=null,i._spatialIndex=null,i.featureStore=null,i.deconflictor=null,i.labeler=null,i.highlights=null,i.viewElevationProvider=null,i.sharedSymbolResourcesOwnerHandle=null,i.whenGraphics3DGraphicRequests={},i.pendingUpdates=new Map,i.pendingAdds=0,i.pendingRemoves=0,i.pendingUpdatesPool=new v({allocator:function(e){return e||{add:null,remove:null}},deallocator:function(e){return e.add=null,e.remove=null,e}}),i.symbolWarningLogged=!1,i.geometryWarningLogged=!1,i.objectIdInvisibleSet=new Set,i._whenSymbolRemoved=new v,i.asyncUpdates=!1,i.elevationFeatureExpressionEnabled=!0,i.owner=null,i.layer=null,i.hasDraped=!1,i.graphicSymbolSupported=!0,i.hasZ=null,i.hasM=null,i._usedMemory=0,i.numberOfGraphics=0,i._visible=void 0,i._startCreateGraphics=!1,i.maxPendingUpdates=0,i}var h;return i(t,e),h=t,Object.defineProperty(t.prototype,"spatialIndex",{get:function(){return this._spatialIndex||(this._spatialIndex=new z.default({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,spatialReference:this._spatialReference,hasZ:this.hasZ,hasM:this.hasM}),ee.clear(),this.graphics3DGraphics.forEach(function(e){return ee.push(e),!1}),this._spatialIndex.addMany(ee.data,ee.length)),this._spatialIndex},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsWaitingForSymbol.size>0||this.needsUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating||this.filterVisibility&&this.filterVisibility.updating)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingRemaining",{get:function(){return this.updating?this.pendingUpdates.size:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingTotal",{get:function(){return this.updating?this.maxPendingUpdates:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayFeatureLimit",{get:function(){var e=this.owner&&this.owner.view&&this.owner.view.qualitySettings,t=e?e.graphics3D.minTotalNumberOfFeatures:0,i=e?e.graphics3D.maxTotalNumberOfFeatures:0,r=e?e.graphics3D.maxTotalNumberOfPrimitives:0,n=this.maxSymbolComplexity,a=Math.max(t,Math.min(i,Math.ceil(r/Math.max(1,n?n.primitivesPerFeature:1)))),s=this._get("displayFeatureLimit");return s&&s.minimumTotalNumberOfFeatures===t&&s.maximumTotalNumberOfFeatures===i&&s.maximumTotalNumberOfPrimitives===r&&s.maximumSymbolComplexity===n&&s.maximumNumberOfFeatures===a?s:{minimumTotalNumberOfFeatures:t,maximumTotalNumberOfFeatures:i,maximumTotalNumberOfPrimitives:r,maximumSymbolComplexity:n,maximumNumberOfFeatures:a}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSymbolComplexity",{get:function(){for(var e=null,t=this.symbolComplexities,i=this._get("maxSymbolComplexity"),r=!1,n=0,a=t;n<a.length;n++){var s=a[n];(!e||0===e.primitivesPerCoordinate&&s.primitivesPerFeature>e.primitivesPerFeature||0!==e.primitivesPerCoordinate&&s.primitivesPerCoordinate>e.primitivesPerCoordinate)&&(e=s),r=r||s.estimated}return!e||r&&i&&(i.primitivesPerFeature>=e.primitivesPerFeature||i.primitivesPerCoordinate>=e.primitivesPerCoordinate)||i&&i.primitivesPerFeature===e.primitivesPerFeature&&i.primitivesPerCoordinate===e.primitivesPerCoordinate?i:e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this._spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usedMemory",{get:function(){return this._usedMemory},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usedMemoryPerGraphic",{get:function(){return this._usedMemory&&this.numberOfGraphics?this._usedMemory/this.numberOfGraphics:this.maxSymbolComplexity?this.maxSymbolComplexity.memory.bytesPerFeature:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unprocessedMemoryEstimate",{get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbolComplexities",{get:function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()},enumerable:!0,configurable:!0}),t.prototype.getConvertedSymbol=function(e){if("web-style"===e.type)return e.clone();var t=this.symbolConversionCache.get(e.id);if(void 0!==t)return t;var i=O.to3D(e,!0,!1,this.hasLabelingContext(e)),r=i.symbol||null;return r||i.error&&J.error(i.error.message),this.symbolConversionCache.set(e.id,r),r},t.prototype.getSymbolComplexitiesUsedOrRenderer=function(e){var t=e.getSymbols();if(!t||!t.length)return[];for(var i=[],r=0,n=t;r<n.length;r++){var a=n[r],s=this.symbols.get(a.id);if(s)i.push(s.complexity);else{var o=this.getConvertedSymbol(a);o&&i.push(H.defaultSymbolComplexity(o))}}return i},t.prototype.getSymbolComplexitiesUsed=function(){var e=[];return this.symbols.forEach(function(t){t&&e.push(t.complexity)}),e},t.prototype.initialize=function(){var e=this;this._spatialReference=this.owner.view.spatialReference,this._set("featureStore",new U.default({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,spatialReference:this._spatialReference,getSpatialIndex:function(){return e.spatialIndex},forAllGraphics:function(t){return e.graphics3DGraphics.forEach(t)}}))},t.prototype.setup=function(e){return a(this,void 0,void 0,function(){var t,i,r,a,s=this;return n(this,function(n){return this._set("elevationAlignment",e.elevationAlignment),this._set("scaleVisibility",e.scaleVisibility),this._set("filterVisibility",e.filterVisibility),this._set("deconflictor",e.deconflictor),this._set("labeler",e.labeler),this._set("highlights",e.highlights),t=this.owner.view,this.viewElevationProvider=new P.ViewElevationProvider(this._spatialReference,t),this.initializeStage(t,this.layer.uid),this.symbolCreationContext.sharedResources=t.sharedSymbolResources,this.sharedSymbolResourcesOwnerHandle=t.sharedSymbolResources.addGraphicsOwner(this.owner),this.symbolCreationContext.renderer=this.currentRenderer,this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataRequester=t.sharedSymbolResources.streamDataRequester,this.symbolCreationContext.renderSpatialReference=t.renderSpatialReference,this.symbolCreationContext.renderCoordsHelper=t.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.layerView=this.owner,this.symbolCreationContext.layerOrder=0,this.symbolCreationContext.localOriginFactory=new X,this.symbolCreationContext.elevationProvider=t.elevationProvider,i=M.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled),this.symbolCreationContext.featureExpressionInfoContext=M.createContext(i,this._spatialReference,J),this.symbolCreationContext.screenSizePerspectiveEnabled=t.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.handles.add(this.owner.watch("suspended",function(){return s.updateLayerVisibility()})),r="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled",this.handles.add([this.owner.watch(r,function(){var e=t.screenSizePerspectiveEnabled&&s.layer.screenSizePerspectiveEnabled;e!==s.symbolCreationContext.screenSizePerspectiveEnabled&&(s.symbolCreationContext.screenSizePerspectiveEnabled=e,s.recreateAllGraphics())}),x.init(this,"asyncUpdates",function(e){return s.modeChange(e)},!0),this.owner.watch("slicePlaneEnabled",function(e){return s.slicePlaneEnabledChange(!!e)}),this.owner.view.watch("pixelRatio",function(e){return s.pixelRatioChange(e)}),x.when(t.basemapTerrain,"tilingScheme",function(e){e.spatialReference.equals(s.symbolCreationContext.overlaySR)||(s.symbolCreationContext.overlaySR=t.basemapTerrain.spatialReference),s.handles.has("loaded-graphics")?s.recreateAllGraphics():s.handles.add(x.on(s.owner,"loadedGraphics","change",function(e){return s.graphicsCollectionChanged(e)},function(){return s.recreateAllGraphics()}),"loaded-graphics")}),t.resourceController.scheduler.registerTask(3,function(e){return s.update(e)},function(){return s.needsUpdate()})]),this.owner.layer&&"featureReduction"in this.owner.layer&&this.handles.add(this.owner.watch("layer.featureReduction",function(){return s.deconflictor.featureReductionChange()})),a=this.rendererChange(this.layer.renderer),this.notifyChange("maxSymbolComplexity"),[2,a]})})},t.prototype.destroy=function(){for(var e in this.owner.view.deconflictor.removeGraphicsOwner(this),this.owner.view.labeler.removeGraphicsOwner(this),this.clear(),this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(Y.ModelContentType.LAYER,this.stageLayer.id),this.stageLayer=null,this.stage=null),this.handles.destroy(),this.handles=null,this._spatialReference=null,this._set("owner",null),this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[e].reject(new d("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null,this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null),this.pendingUpdatesPool=null,this.symbolConversionCache.clear(),this.objectIdInvisibleSet.clear(),this._spatialIndex&&(this._spatialIndex.destroy(),this._spatialIndex=null),this.featureStore&&(this.featureStore.destroy(),this._set("featureStore",null))},t.prototype.clear=function(){this.graphics3DGraphics.forEach(function(e){return e.destroy()}),this._spatialIndex&&this._spatialIndex.clear(),this.graphics3DGraphics.clear(),this.numberOfGraphics=0,this._usedMemory=0,this.updateLayerVisibility(),this.symbols.forEach(function(e){e&&e.destroy()}),this.symbols.clear(),this.graphicsBySymbol.clear(),this.graphicsWithoutSymbol={},this.graphicsWaitingForSymbol.clear(),this.pendingUpdates.clear(),this.pendingUpdatesPool.clear(),this.maxPendingUpdates=0,this.pendingAdds=0,this.pendingRemoves=0,this._set("hasDraped",!1),this.notifyChange("updating"),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining"),this.featureStore.events.emit("changed")},t.prototype.initializeStage=function(e,t){this.stage=e._stage,this.stageLayer=new k(t,{isPickable:!this.owner.suspended},t),this.stage.add(Y.ModelContentType.LAYER,this.stageLayer),this.stage.addToViewContent([this.stageLayer.id])},t.prototype.setDrawingOrder=function(e){this.symbolCreationContext.layerOrder=e;var t=new Set;this.symbols.forEach(function(i){i&&i.setDrawOrder(e,t)}),t.size>0&&this.stage.renderView.getDrapedRenderer().updateRenderOrder(t)},t.prototype.updateLayerVisibility=function(){var e=!!this.owner.suspended,t=this.numberOfGraphics>this.displayFeatureLimit.maximumNumberOfFeatures*ie,i=!e&&!t;i!==this._visible&&(this._visible=i,i?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())},t.prototype.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||this.layer.opacity>0)},t.prototype.getGraphics3DGraphicById=function(e){return this.graphics3DGraphics.get(e)},t.prototype._getGraphicObjectID=function(e,t){return void 0===t&&(t=this.owner.layer&&this.owner.layer.objectIdField),R.getObjectId(e,t)},Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){var e=this,t=this.owner.layer&&this.owner.layer.objectIdField;if(!t)return null;var i=new Map;return this.graphics3DGraphics.forEach(function(r){if(r){var n=r.graphic,a=e._getGraphicObjectID(n,t);m.isSome(a)&&i.set(a,r)}}),i},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelsEnabled",{get:function(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())},enumerable:!0,configurable:!0}),t.prototype.updateLabelingInfo=function(e){return a(this,void 0,void 0,function(){var t,i;return n(this,function(r){switch(r.label){case 0:return t=this.deconflictor&&this.deconflictor.labelingInfoChange(e),i=this.labeler&&this.labeler.labelingInfoChange(e),[4,S.eachAlways([t,i])];case 1:return r.sent(),[2]}})})},t.prototype.updateVisibilityInfo=function(){this.deconflictor&&this.deconflictor.labelingInfoChange(),this.labeler&&this.labeler.visibilityInfoChange()},Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){var e=this;if(this.pendingUpdates.size>0)return"unknown";var t=0,i=0;return y.everyMap(this.symbols,function(r,n){if(r){var a=r.getFastUpdateStatus();if(a.loading>0)return!1;e.graphicsBySymbol.has(n)&&(i+=a.fast,t+=a.slow)}})?i>=0&&0===t?"fast":t>=0&&0===i?"slow":"mixed":"unknown"},enumerable:!0,configurable:!0}),t.prototype.needsUpdate=function(){return this.pendingUpdates.size>0},t.prototype.update=function(e){this._applyPendingUpdates(e),this.needsUpdate()||this.notifyChange("updating")},t.prototype.setObjectIdVisibility=function(e,t){t?this.objectIdInvisibleSet.delete(e):this.objectIdInvisibleSet.add(e);var i=this._findGraphics3DGraphicByObjectId(e);m.isSome(i)&&this._updateUserVisibility(i)},t.prototype._findGraphics3DGraphicByObjectId=function(e){var t,i=this;return y.everyMap(this.graphics3DGraphics,function(r){return i._getGraphicObjectID(r.graphic)!==e||(t=r,!1)}),t},t.prototype._updateUserVisibility=function(e){if(m.isNone(e))return!1;var t=e.graphic,i=this._getGraphicObjectID(t),r=t.visible&&!this.owner.suspended&&(m.isNone(i)||!this.objectIdInvisibleSet.has(i));return e.setVisibilityFlag(0,r,0)},t.prototype.whenGraphics3DGraphic=function(e){var t=this.graphics3DGraphics.get(e.uid);if(t)return S.resolve(t);var i=this.whenGraphics3DGraphicRequests[e.uid];if(i)return i.promise;var r=S.createDeferred();return this.whenGraphics3DGraphicRequests[e.uid]=r,r.promise},t.prototype.boundsForGraphics3DGraphic=function(e,t){return a(this,void 0,void 0,function(){var i,r,a,s,o,l,h,p,c,d;return n(this,function(n){switch(n.label){case 0:return i=this._spatialReference,r=this.owner.view.renderSpatialReference,a=this.owner.view.basemapTerrain.spatialReference,s=function(e,t,n){return T.bufferToBuffer(e,r,t,e,i,t,n)},o=function(e,t,r){return T.bufferToBuffer(e,a,t,e,i,t,r)},l=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:m.isSome(t)&&t.useViewElevation,minDemResolution:m.isSome(t)&&t.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,[4,e.getProjectedBoundingBox(s,o,l,m.get(t,"signal"))];case 1:return(h=n.sent())?(p=h.boundingBox,h.requiresDrapedElevation&&(c=this.symbolCreationContext.elevationProvider)&&(C.center(p,Q),N.x=Q[0],N.y=Q[1],N.z=void 0,N.spatialReference=i,d=c.getElevation(N)||0,p[2]=Math.min(p[2],d),p[5]=Math.max(p[5],d)),[2,{boundingBox:p,screenSpaceObjects:h.screenSpaceObjects}]):[2,null]}})})},t.prototype.whenGraphicBounds=function(e,t){var i=this;return x.whenOnce(this.owner,"loadedGraphics").then(function(){var t=i.owner.layer&&i.owner.layer.objectIdField,r=i.owner.loadedGraphics.find(function(i){return i===e||t&&i.attributes&&e.attributes&&i.attributes[t]===e.attributes[t]});if(r)return i.whenGraphics3DGraphic(r);throw new d("internal:graphic-not-part-of-view","Graphic is not part of this view")}).then(function(e){return i.boundsForGraphics3DGraphic(e,t)})},t.prototype.whenSymbolLayerSize=function(e,t){return a(this,void 0,void 0,function(){var i,r,a;return n(this,function(n){switch(n.label){case 0:if(null==(i=this.symbols.get(e.id)))throw new d("internal:symbol-not-part-of-view","Symbol is not part of this view");if(-1===(r=e.symbolLayers.indexOf(t)))throw new d("internal:missing-symbol-layer","Symbol layer is not in symbol");return[4,i.whenSymbolLayerSize(r)];case 1:if(null==(a=n.sent()))throw new d("internal:missing-size","Symbol layer has no valid size");return[2,a]}})})},t.prototype.graphicsCollectionChanged=function(e){this._startCreateGraphics&&(this.add(e.added),this.remove(e.removed))},t.prototype.graphicUpdateHandler=function(e){var t=e.graphic.uid,i=this.graphics3DGraphics.get(t),r=this.graphicsWithoutSymbol[t];if(i||r)switch(e.property){case"visible":this.graphicUpdateVisibleHandler(i,e);break;case"geometry":this.graphicUpdateGeometryHandler(i,e);break;case"symbol":this.graphicUpdateSymbolHandler(i,e);break;case"attributes":break;default:c.neverReached(e)}},t.prototype.graphicUpdateGeometryHandler=function(e,t){var i=t.graphic.geometry;if(m.isNone(i))this.recreateGraphic(t.graphic);else if(m.isNone(e)){var r=t.graphic.symbol&&t.graphic.symbol.id;if(r){var n=this.symbols.get(r);if(n&&0===n.loadStatus)return}this.recreateGraphic(t.graphic)}else e.graphics3DSymbol.updateGeometry(e,t.newValue)||this.recreateGraphic(e.graphic),this.expandComputedExtent(i)},t.prototype.graphicUpdateSymbolHandler=function(e,t){var i=t.graphic,r=m.isSome(e)?e.graphics3DSymbol:t.oldValue&&this.symbols.get(t.oldValue.id);if(r){var n=r.symbol,a=this.getConvertedSymbol(t.newValue);if(a.type===n.type&&"web-style"!==a.type&&"web-style"!==n.type){var s=this.graphicsBySymbol.get(n.id);if(s&&1!==s.size)this.recreateGraphic(i);else{var o=E.diff(n,a);if(m.isNone(o))this.updateSymbolMapping(n.id,a);else{var l={diff:o,graphics3DGraphicPatches:[],symbolStatePatches:[]};if(r.prepareSymbolPatch(l),E.isEmpty(l.diff)){for(var h=0,p=l.symbolStatePatches;h<p.length;h++){(0,p[h])()}var c=this._getRenderingInfo(i);if(m.isSome(e))for(var d=0,u=l.graphics3DGraphicPatches;d<u.length;d++){(0,u[d])(e,c)}this.updateSymbolMapping(n.id,a)}else this.recreateGraphic(i)}}}else this.recreateGraphic(i)}else this.recreateGraphic(i)},t.prototype.graphicUpdateVisibleHandler=function(e,t){var i=this._updateUserVisibility(e);i&&this.labeler&&this.owner.view.labeler.setDirty(),i&&this.owner.view.deconflictor.setDirty()},t.prototype.recreateGraphic=function(e){var t=[e];this.suspendSymbolCleanup=!0,this.remove(t),this.add(t),this.suspendSymbolCleanup=!1,this.asyncUpdates||this._cleanupSymbols()},t.prototype._beginGraphicUpdate=function(e){this.graphicsWaitingForSymbol.add(e.uid),1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating"),this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)},t.prototype._endGraphicUpdate=function(e){e&&(this.graphicsWaitingForSymbol.delete(e.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"),this._get("symbolsUpdating")&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))))},t.prototype.expandComputedExtent=function(e){var t=Z,i=e.spatialReference;R.computeAABB(e,t);var r=this._spatialReference,n=h.tmpVec;if(i.equals(r)||T.xyzToVector(t[0],t[1],0,i,n,r)&&(t[0]=n[0],t[1]=n[1],T.xyzToVector(t[3],t[4],0,i,n,r),t[3]=n[0],t[4]=n[1]),g.isFinite(t[0])&&g.isFinite(t[3])&&g.isFinite(t[1])&&g.isFinite(t[4])){var a=this.computedExtent,s=null,o=g.isFinite(t[2])&&g.isFinite(t[5]),l=o&&(!a||null==a.zmin||t[2]<a.zmin),p=o&&(!a||null==a.zmax||t[5]>a.zmax);a?(t[0]<a.xmin||t[1]<a.ymin||t[3]>a.xmax||t[4]>a.ymax||l||p)&&((s=this.propertiesPool.get("computedExtent")).xmin=Math.min(t[0],a.xmin),s.ymin=Math.min(t[1],a.ymin),s.xmax=Math.max(t[3],a.xmax),s.ymax=Math.max(t[4],a.ymax),s.spatialReference=r):((s=this.propertiesPool.get("computedExtent")).xmin=t[0],s.ymin=t[1],s.xmax=t[3],s.ymax=t[4],s.spatialReference=r),s&&(l&&(s.zmin=t[2]),p&&(s.zmax=t[5]),this._set("computedExtent",s))}},t.prototype.updateHasDraped=function(){var e=this.graphicsDrapedUids.size>0;this._set("hasDraped",e)},t.prototype.elevationInfoChange=function(){var e=this,t=M.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=M.createContext(t,this._spatialReference,J),this.labeler&&this.labeler.elevationInfoChange(),this.forEachGraphics3DSymbol(function(t,i,r){t.globalPropertyChanged("elevationInfo",i)?i.forEach(function(e){for(var t=e.graphic,i=e._labelGraphics,r=0;r<i.length;r++){var n=i[r];n.graphics3DSymbolLayer.updateGraphicElevationContext(t,n)}}):e._recreateSymbol(r)}),this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()},t.prototype.clearSymbolsAndGraphics=function(){this.clear(),this.filterVisibility&&this.filterVisibility.clear(),this.labeler&&this.labeler.reset(),this.deconflictor&&this.deconflictor.clear(),this.elevationAlignment&&this.elevationAlignment.clear(),this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator()},t.prototype.startCreateGraphics=function(){this._startCreateGraphics=!0,this.recreateAllGraphics()},t.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))},t.prototype._recreateSymbol=function(e){var t=this,i=[];this.graphicsBySymbol.get(e).forEach(function(e,r){var n=e.usedMemory;t._conditionalRemove(e,r),t._spatialIndex&&t._spatialIndex.remove(e),i.push(e.graphic),e.destroy(),t.removeGraphics3DGraphic(r,n),t.updateLayerVisibility(),t.featureStore.events.emit("changed")}),this.graphicsBySymbol.set(e,new Map);var r=this.symbols.get(e);r&&r.destroy(),this.symbols.delete(e),this.updateHasDraped(),this.add(i)},t.prototype._conditionalRemove=function(e,t){e.isDraped()&&this.graphicsDrapedUids.delete(t),this.highlights&&this.highlights.removeGraphic(e),this.labeler&&this.labeler.removeGraphic(e),this.deconflictor&&this.deconflictor.removeGraphic(e)},t.prototype.add=function(e){if(e&&0!==e.length){if(!this.owner.view.basemapTerrain||!this.owner.view.basemapTerrain.tilingScheme)return void J.error("#add()","Cannot add graphics before terrain surface has been initialized");this.asyncUpdates?this._addDelayed(e):this._addImmediate(e),this.notifyChange("updating")}},t.prototype._addImmediate=function(e){var t=this;this.geometryWarningLogged=!1,this.symbolWarningLogged=!1,$.clear();for(var i=0,r=e;i<r.length;i++){var n=r[i];this._startAddGraphic(n,$)}$.forEach(function(e){return t._finishAddGraphics(e)}),$.clear(),this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty(),this._cleanupSymbols()},t.prototype._addDelayed=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t],n=r.uid,a=this.pendingUpdates.get(n);if(a)a.add||this.pendingAdds++,a.add=r;else{var s=this.pendingUpdatesPool.pushNew();s.add=r,this.pendingAdds++,this.pendingUpdates.set(n,s)}}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype.remove=function(e){this.asyncUpdates?this._removeDelayed(e):this._removeImmediate(e),this.notifyChange("updating")},t.prototype._removeImmediate=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];this._removeGraphic(r)}this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty()},t.prototype._removeDelayed=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t],n=r.uid,a=this.pendingUpdates.get(n);if(a)a.add&&(a.remove?a.add=null:this.pendingUpdates.delete(n),this.pendingAdds--);else{var s=this.pendingUpdatesPool.pushNew();s.remove=r,this.pendingUpdates.set(n,s),this.pendingRemoves++}}0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype._finishPendingUpdates=function(){this.pendingUpdatesPool.clear(),this.maxPendingUpdates=0,this._cleanupSymbols(),(this.pendingAdds||this.pendingRemoves)&&J.warn("pendingAdds/Removes in inconsistent state!"),this.pendingAdds=0,this.pendingRemoves=0},t.prototype._applyPendingUpdates=function(e){var t=this;this.geometryWarningLogged=!1,this.symbolWarningLogged=!1;var i=e.idleFrame?1e3:100,r=0;$.clear(),y.everyMap(this.pendingUpdates,function(n,a){if(n.remove&&(t.pendingRemoves--,t._removeGraphic(n.remove)),n.add&&(t.pendingAdds--,t._startAddGraphic(n.add,$)&&r++),t.pendingUpdates.delete(a),r>i&&($.forEach(function(e){return t._finishAddGraphics(e)}),$.clear(),r=0),e.madeProgress(),e.done)return!1}),$.forEach(function(e){return t._finishAddGraphics(e)}),$.clear(),0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining"),this.updateHasDraped()},t.prototype._startAddGraphic=function(e,t){this.graphicsWithoutSymbol[e.uid]=e;var i=this._getRenderingInfo(e,J);if(!i||m.isNone(i.symbol))return!1;if(!R.hasGeometry(e))return!1;var r=i.symbol,n=this.getOrCreateGraphics3DSymbol(r,i.renderer);if(!n)return!1;this.expandComputedExtent(e.geometry),this._beginGraphicUpdate(e);var a={graphic:e,renderingInfo:i,layer:this.layer},s=n.symbol.id,o=t.get(s);if(o)o.graphics.push(a);else{var l=te.acquire();l.clear(),l.push(a),t.set(s,{asyncSymbol:n,graphics:l})}return!0},t.prototype._finishAddGraphics=function(e){var t=this,i=!1,r=function(t){t===e.asyncSymbol.symbol.id&&(i=!0)};this._whenSymbolRemoved.push(r),e.asyncSymbol.load().then(function(){t._whenSymbolRemoved.removeUnordered(r),ee.clear();for(var n=0;n<e.graphics.length;n++){var a=e.graphics.data[n],s=a.graphic;if(!(i||e.asyncSymbol.destroyed||t.graphicSymbolSupported&&s.symbol&&s.symbol.id!==e.asyncSymbol.symbol.id)){if(t.graphicsWaitingForSymbol.has(s.uid)){var o=t.createGraphics3DGraphic(e.asyncSymbol,a);t._spatialIndex&&o&&ee.push(o)}t._endGraphicUpdate(s)}--e.asyncSymbol.referenced}ee.length>0&&(t._spatialIndex.addMany(ee.data,ee.length),ee.clear()),t.featureStore.events.emit("changed"),e.graphics.clear(),te.release(e.graphics),t.labeler&&t.owner.view.labeler.setDirty()},function(){if(t._whenSymbolRemoved.removeUnordered(r),!i&&!e.asyncSymbol.destroyed)for(var n=0;n<e.graphics.length;n++)t._endGraphicUpdate(e.graphics.data[n].graphic);e.graphics.clear(),te.release(e.graphics)})},t.prototype._removeGraphic=function(e){var t=e.uid,i=this.graphics3DGraphics.get(t);if(i){var r=i.usedMemory;this._conditionalRemove(i,t),this._spatialIndex&&this._spatialIndex.remove(i);var n=i.graphics3DSymbol.symbol.id;this.graphicsBySymbol.get(n).delete(t),delete this.graphicsWithoutSymbol[t],this.removeGraphics3DGraphic(t,r),i.destroy(),this.featureStore.events.emit("changed")}else delete this.graphicsWithoutSymbol[t],this.graphicsWaitingForSymbol.delete(t)},t.prototype.hasLabelingContext=function(e){if(e instanceof l.LabelSymbol3D||e instanceof l.TextSymbol){var t=this.symbolCreationContext.layer;return!!t.labelingInfo&&t.labelingInfo.some(function(t){return t.symbol===e})}return!1},t.prototype.hasValidSymbolCreationContext=function(e){return!(e instanceof l.LabelSymbol3D&&!this.hasLabelingContext(e)&&(J.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),1))},t.prototype._getRenderingInfo=function(e,t){var i=e.geometry;if(m.isNone(i))return t&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&m.isSome(e.symbol))return t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),null;var r=this.rendererHasGeometryOperations?R.hydrateGraphic(e,this.layer):e,n=this.owner.getRenderingInfo(r,this.currentRenderer);return!n||m.isNone(n.symbol)?(t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),null):n},t.prototype.createGraphics3DSymbol=function(e,t){var i=this;if(!this.hasValidSymbolCreationContext(e))return null;var r,n=this.getConvertedSymbol(e);if(!n)return null;if(t&&"backgroundFillSymbol"in t&&t.backgroundFillSymbol){var a=O.to3D(t.backgroundFillSymbol,!1,!0);a.symbol&&"web-style"!==a.symbol.type&&(r=a.symbol.symbolLayers)}var s=F.make(n,this.symbolCreationContext,r);return s.load().then(function(){return i.notifyChange("maxSymbolComplexity")}),s},t.prototype.getOrCreateGraphics3DSymbol=function(e,t){var i=this,r=this.symbols.get(e.id);return void 0===r&&(r=e instanceof l.WebStyleSymbol?new B(e,function(e){return i.createGraphics3DSymbol(e,t)}):this.createGraphics3DSymbol(e,t),this.symbols.set(e.id,r)),r&&++r.referenced,r},t.prototype.addGraphics3DGraphic=function(e){this._usedMemory+=e.usedMemory,this.graphics3DGraphics.set(e.graphic.uid,e),this.numberOfGraphics++,this.updateLayerVisibility()},t.prototype.removeGraphics3DGraphic=function(e,t){this._usedMemory-=t,this.graphics3DGraphics.delete(e),this.numberOfGraphics--,this.updateLayerVisibility()},t.prototype.createGraphics3DGraphic=function(e,t){var i=t.graphic;if(delete this.graphicsWithoutSymbol[i.uid],this.symbols.has(e.symbol.id)){if(!this.graphics3DGraphics.has(i.uid)){var r=e.createGraphics3DGraphic(t),n=e.symbol.id;this.addGraphics3DGraphic(r),this.graphicsBySymbol.has(n)||this.graphicsBySymbol.set(n,new Map),this.graphicsBySymbol.get(n).set(i.uid,r),r.initialize(this.stageLayer,this.stage),r.isDraped()&&(this.graphicsDrapedUids.add(i.uid),this._set("hasDraped",!0)),r.centroid=null,m.isSome(i.geometry)&&"point"!==i.geometry.type&&r instanceof A&&(r.centroid=L.computeCentroid(i.geometry,this._spatialReference)),this._updateUserVisibility(r),this.deconflictor&&this.deconflictor.addGraphic(r),this.labeler&&this.labeler.addGraphic(r),this.scaleVisibility&&this.scaleVisibility.updateVisibility(r),this.filterVisibility&&this.filterVisibility.updateVisibility(r),this.highlights&&this.highlights.addGraphic(r),this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,r);var a=this.whenGraphics3DGraphicRequests[i.uid];return a&&(delete this.whenGraphics3DGraphicRequests[i.uid],a.resolve(r)),r}}else this.add([i])},t.prototype.rendererChange=function(e){return a(this,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return e===this.currentRenderer?[2]:(this.validateRenderer(e),V.hasGeometryOperations(e)?[4,V.enableGeometryOperations()]:[3,2]);case 1:return t.sent(),this.layer.renderer===e&&this.currentRendererChange(e,!0),[3,3];case 2:this.currentRendererChange(e,!1),t.label=3;case 3:return[2]}})})},t.prototype.currentRendererChange=function(e,t){this.currentRenderer=e,this.rendererHasGeometryOperations=t;var i=this.symbolCreationContext.renderer;if(e!==i){this.symbolConversionCache.clear();var r=E.diff(i,e);this.updateUnchangedSymbolMappings(r,e,i),this.symbolCreationContext.renderer=e,m.isNone(r)||("complete"===r.type?this.recreateAllGraphics():"partial"===r.type&&(this.applyRendererDiff(r,e,i)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("maxSymbolComplexity"))}},t.prototype.diffHasSymbolChange=function(e){for(var t in e.diff)switch(t){case"visualVariables":case"defaultSymbol":case"uniqueValueInfos":break;case"authoringInfo":case"fieldDelimiter":delete e.diff[t];break;default:return!0}return!1},t.prototype.applySymbolSetDiff=function(e,t,i,r){var n=this;e=e||[];for(var a=[],s=this,o=0,l=t=t||[];o<l.length;o++){!function(t){var r=s.graphicsBySymbol.get(t.id);r&&r.forEach(function(s,o){var l=s.graphic,h=n.layer instanceof _?n.layer:null;if(t!==i.defaultSymbol||i.getSymbol(R.hydrateGraphic(l,h),{arcadeUtils:V})!==i.defaultSymbol){var p=s.usedMemory;e.length||i.defaultSymbol?a.push(l):n.graphicsWithoutSymbol[o]=l;var c=n.graphics3DGraphics.get(o);n._conditionalRemove(c,o),s.destroy(),r.delete(o),n.removeGraphics3DGraphic(o,p),n.updateLayerVisibility()}}),s._whenSymbolRemoved.forEach(function(e){return e(t.id)})}(l[o])}if(e.length||a.length){for(var h in this.graphicsWithoutSymbol)a.push(this.graphicsWithoutSymbol[h]);this.graphicsWithoutSymbol={},this.add(a)}this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty()},t.prototype.applyUniqueValueRendererDiff=function(e,t,i){var r=e.diff.defaultSymbol,n=e.diff.uniqueValueInfos;if(r||n){var a=n?n.added.map(function(e){return e.symbol}):[],s=n?n.removed.map(function(e){return e.symbol}):[];if(n)for(var o=0;o<n.changed.length;o++)a.push(n.changed[o].newValue.symbol),s.push(n.changed[o].oldValue.symbol);return r?(i.defaultSymbol&&s.push(i.defaultSymbol),t.defaultSymbol&&a.push(t.defaultSymbol)):i.defaultSymbol&&a.length&&s.push(t.defaultSymbol),this.applySymbolSetDiff(a,s,t,i),delete e.diff.defaultSymbol,delete e.diff.uniqueValueInfos,!0}return!1},t.prototype.calculateUnchangedSymbolMapping=function(e,t,i){var r=function(e){return m.isSome(e)?e.id:null};if(t instanceof o.UniqueValueRenderer&&i instanceof o.UniqueValueRenderer&&(m.isNone(e)||"partial"===e.type)){var n=e&&e.diff,a=n&&n.defaultSymbol,s=n&&n.uniqueValueInfos,l=void 0;return l=s?s.unchanged.map(function(e){return{oldId:r(e.oldValue.symbol),newId:r(e.newValue.symbol)}}):i.uniqueValueInfos.map(function(e,i){return{oldId:r(e.symbol),newId:r(t.uniqueValueInfos[i].symbol)}}),!a&&i.defaultSymbol&&l.push({oldId:r(i.defaultSymbol),newId:r(t.defaultSymbol)}),l}return[]},t.prototype.updateSymbolMapping=function(e,t){var i=t?"string"==typeof t?t:t.id:null,r="string"==typeof t?null:t;if(e&&e!==i){var n=this.graphicsBySymbol.get(e);this.graphicsBySymbol.delete(e),void 0!==n&&this.graphicsBySymbol.set(i,n);var a=this.symbols.get(e);this.symbols.delete(e),void 0!==a&&(this.symbols.set(i,a),r?a.symbol=r:a.symbol.id=i)}},t.prototype.updateUnchangedSymbolMappings=function(e,t,i){for(var r=0,n=this.calculateUnchangedSymbolMapping(e,t,i);r<n.length;r++){var a=n[r],s=a.oldId,o=a.newId;this.updateSymbolMapping(s,o)}},t.prototype.applyRendererDiff=function(e,t,i){var r=this;return!this.diffHasSymbolChange(e)&&(!!(t instanceof o.UniqueValueRenderer&&i instanceof o.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(e,t,i)&&0===Object.keys(e.diff).length)||y.everyMap(this.graphicsBySymbol,function(i,n){var a=r.symbols.get(n);if(a&&!a.applyRendererDiff(e,t))return!1}))},t.prototype.opacityChange=function(){this.forEachGraphics3DSymbol(function(e){return e.globalPropertyChanged("opacity")}),this.updateStageLayerVisibility()},t.prototype.modeChange=function(e){this.symbolCreationContext.isAsync=e,e||this.update(W.noBudget)},t.prototype.slicePlaneEnabledChange=function(e){e!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=e,this.stageLayer.isSliceable=e,this.forEachGraphics3DSymbol(function(e,t){return e.globalPropertyChanged("slicePlaneEnabled",t)}),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())},t.prototype.pixelRatioChange=function(e){var t=this;this.forEachGraphics3DSymbol(function(e,i,r){e.globalPropertyChanged("pixelRatio",i)||t._recreateSymbol(r)})},t.prototype.setClippingExtent=function(e,t){var i=this.symbolCreationContext.clippingExtent,r=D.create();return T.extentToBoundingRect(e,r,t)?this.symbolCreationContext.clippingExtent=[r[0],r[1],-1/0,r[2],r[3],1/0]:this.symbolCreationContext.clippingExtent=null,!p.equals(this.symbolCreationContext.clippingExtent,i)},t.prototype.notifyVisibilityChanged=function(){this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty()},t.prototype.modifyGraphics3DGraphicVisibilities=function(e){var t=!1;this.graphics3DGraphics.forEach(function(i){e(i)&&(t=!0)}),t&&this.notifyVisibilityChanged()},t.prototype.forEachGraphics3DSymbol=function(e){var t=this;this.graphicsBySymbol.forEach(function(i,r){var n=t.symbols.get(r);n&&e(n,i,r)})},t.prototype.updateAllGraphicsVisibility=function(){var e=this;this.filterVisibility&&(this.filterVisibility.dirty=!0),this.modifyGraphics3DGraphicVisibilities(function(t){var i=e._updateUserVisibility(t),r=e.scaleVisibility&&e.scaleVisibility.updateVisibility(t);return i||r})},t.prototype.hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(function(e){return e.setVisibilityFlag(0,!1,0)})},t.prototype.validateRenderer=function(e){var t=I.validateTo3D(e);if(t){var i="Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView";J.warn(i,t.message)}},t.prototype.volatileGraphicsUpdated=function(){this.labeler&&this.labeler.reset(),this.stageLayer.invalidateSpatialQueryAccelerator(),this.stageLayer.shaderTransformationChanged(),this.notifyChange("updating")},t.prototype._cleanupSymbols=function(){var e=this;if(!(this.graphicsWaitingForSymbol.size>0||this.suspendSymbolCleanup)){var t=!1;this.symbols.forEach(function(i,r){if(i&&!(i.referenced>0)){var n=e.graphicsBySymbol.get(r);n&&0!==n.size||(e.graphicsBySymbol.delete(r),e.symbols.delete(r),i&&i.destroy(),t=!0)}}),t&&this.notifyChange("maxSymbolComplexity")}},t.prototype.snapshotInternals=function(){var e=this;return{graphics:p.keysOfMap(this.graphics3DGraphics).sort(),symbols:p.keysOfMap(this.symbols).sort(),graphicsBySymbol:p.keysOfMap(this.graphicsBySymbol).sort().map(function(t){return{symbolId:t,graphics:p.keysOfMap(e.graphicsBySymbol.get(t)).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:p.keysOfSet(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}},Object.defineProperty(t.prototype,"test",{get:function(){return{symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size}},enumerable:!0,configurable:!0}),t.prototype.getStats=function(){return{"core.visible":this.graphics3DGraphics.size,"core.missing":Object.keys(this.graphicsWithoutSymbol).length,"core.pending":this.pendingUpdates.size}},t.tmpVec=G.vec3f64.create(),r([w.property({readOnly:!0})],t.prototype,"computedExtent",void 0),r([w.property()],t.prototype,"currentRenderer",void 0),r([w.property()],t.prototype,"rendererHasGeometryOperations",void 0),r([w.property({readOnly:!0})],t.prototype,"elevationAlignment",void 0),r([w.property({readOnly:!0})],t.prototype,"scaleVisibility",void 0),r([w.property({readOnly:!0})],t.prototype,"filterVisibility",void 0),r([w.property({readOnly:!0})],t.prototype,"featureStore",void 0),r([w.property({readOnly:!0})],t.prototype,"deconflictor",void 0),r([w.property({readOnly:!0})],t.prototype,"labeler",void 0),r([w.property({readOnly:!0})],t.prototype,"highlights",void 0),r([w.property()],t.prototype,"asyncUpdates",void 0),r([w.property({constructOnly:!0})],t.prototype,"elevationFeatureExpressionEnabled",void 0),r([w.property({constructOnly:!0})],t.prototype,"owner",void 0),r([w.property({constructOnly:!0})],t.prototype,"layer",void 0),r([w.property({readOnly:!0})],t.prototype,"hasDraped",void 0),r([w.property({readOnly:!0})],t.prototype,"symbolsUpdating",void 0),r([w.property({constructOnly:!0})],t.prototype,"graphicSymbolSupported",void 0),r([w.property({readOnly:!0,dependsOn:["elevationAlignment.updating","scaleVisibility.updating","filterVisibility.updating"]})],t.prototype,"updating",null),r([w.property({readOnly:!0})],t.prototype,"updatingRemaining",null),r([w.property({readOnly:!0})],t.prototype,"updatingTotal",null),r([w.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","maxSymbolComplexity"]})],t.prototype,"displayFeatureLimit",null),r([w.property({readOnly:!0})],t.prototype,"maxSymbolComplexity",null),r([w.property({constructOnly:!0})],t.prototype,"hasZ",void 0),r([w.property({constructOnly:!0})],t.prototype,"hasM",void 0),h=r([w.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],t)}(w.declared(h)),$=new Map,ee=new v,te=new b(v),ie=10;return K}.apply(null,r))||(e.exports=n)},1567:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(6),i(37),i(20),i(86),i(0),i(35)],void 0===(n=function(e,t,i,r,n,a,s,o,l,h){var p=function(){function e(){this.extents=new o({allocator:function(e){return e||h.create()}}),this.tempExtent=h.create(),this.dirty=!1}return Object.defineProperty(e.prototype,"length",{get:function(){return this.extents.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.extents.clear()},e.prototype.add=function(e){this.contains(e)||(this.removeContained(e),h.set(this.extents.pushNew(),e),this.dirty=!0)},e.prototype.pop=function(){return this.dirty&&(this.mergeTight(),this.dirty=!1),this.extents.pop()},e.prototype.mergeTight=function(){for(var e=this.extents,t=this.tempExtent,i=!1;!i;){i=!0;for(var r=0;r<e.length;++r)if(function(i){for(var r=e.data[i],n=h.area(r),a=!1,s=e.length-1;s>i;--s){var o=e.data[s],l=h.area(o);h.expand(r,o,t);var p=n+l;(h.area(t)-p)/p<.05&&(h.set(r,t),n=h.area(r),e.swapElements(s,e.length-1),e.pop(),a=!0)}return a}(r)){i=!1;break}}},e.prototype.contains=function(e){return this.extents.some(function(t){return h.contains(t,e)})},e.prototype.removeContained=function(e){for(var t=this.extents.length-1;t>=0;--t)h.contains(e,this.extents.data[t])&&this.extents.removeUnorderedIndex(t)},e}();return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dirtyExtents=new p,t.globalDirty=!1,t.dirtyGraphicsQueue=new o({deallocator:null}),t.dirtyGraphicsSet=new Set,t.handles=new s,t.updateElevation=!1,t.layerView=null,t.graphicsCore=null,t.events=new a,t}return i(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this.needsUpdate()},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,i,r){var n=this;this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=i,this.elevationProvider=r;var a=this.layerView.view.resourceController.scheduler;this.handles.add([r.on("elevation-change",function(e){return n.elevationUpdateHandler(e)}),this.layerView.watch("suspended",function(){return n.suspendedChange()}),a.registerTask(12,function(e){return n.update(e)},function(){return n.needsUpdate()})])},t.prototype.destroy=function(){this.dirtyGraphicsQueue=null,this.dirtyGraphicsSet=null,this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null},t.prototype.clear=function(){this.dirtyGraphicsQueue.clear(),this.dirtyGraphicsSet.clear(),this.notifyChange("updating")},t.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))},t.prototype.elevationInfoChange=function(){this.globalDirty=!0,this.notifyChange("updating")},t.prototype.needsUpdate=function(){return this.dirtyGraphicsQueue.length>0||this.dirtyExtents.length>0||this.globalDirty},t.prototype.update=function(e){for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress());this.needsUpdate()&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")},t.prototype._updateDirtyGraphics=function(e){for(var t=this.layerView.view,i=this.graphicsCore.stageLayer.id,r=this.layerView.labeling;this.dirtyGraphicsQueue.length>0&&!e.done;){for(var n=Math.min(this.dirtyGraphicsQueue.length,100);n--&&!e.done;){var a=this.dirtyGraphicsQueue.pop(),s=this.graphicsCore.getGraphics3DGraphicById(a);this.dirtyGraphicsSet.delete(a),s&&s.alignWithElevation(this.elevationProvider,t.renderCoordsHelper),e.madeProgress()}t._stage.processDirtyLayer(i),r&&r.processStageDirty()}},t.prototype._updateDirtyExtents=function(e){for(var t=this;this.dirtyExtents.length>0&&this.dirtyGraphicsQueue.length<100&&!e.done;){var i=this.dirtyExtents.pop();this.events.hasEventListener("invalidate-elevation")&&this.events.emit("invalidate-elevation",{extent:i,spatialReference:this.spatialReference}),this.queryGraphicUIDsInExtent(i,this.spatialReference,function(e){var i=t.graphicsCore.getGraphics3DGraphicById(e);!t.dirtyGraphicsSet.has(e)&&i&&i.needsElevationUpdates()&&(t.dirtyGraphicsQueue.push(e),t.dirtyGraphicsSet.add(e))}),e.madeProgress()}},t.prototype.markAllGraphicsElevationDirty=function(){var e=this;this.dirtyExtents.clear(),this.dirtyGraphicsQueue.clear(),this.graphicsCore.graphics3DGraphics.forEach(function(t,i){e.dirtyGraphicsQueue.push(i),e.dirtyGraphicsSet.add(i)})},t.prototype.elevationUpdateHandler=function(e){var t=e.extent;if(this.layerView.suspended){if(!this.updateElevation){var i=this.graphicsCore.computedExtent;i&&t[2]>i.xmin&&t[0]<i.xmax&&t[3]>i.ymin&&t[1]<i.ymax&&(this.updateElevation=!0)}}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.spatialReference=e.spatialReference,this.notifyChange("updating")},r([l.property({readOnly:!0})],t.prototype,"updating",null),r([l.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],t)}(l.declared(n))}.apply(null,r))||(e.exports=n)},1568:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1687)],void 0===(n=function(e,t,i){return function(){function e(){this.graphicsCore=null,this.highlights=[]}return e.prototype.destroy=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()}),this.highlights=null},e.prototype.setup=function(e){this.graphicsCore=e},e.prototype.acquireSet=function(e,t){var r=this,n=new i(e,t);return this.highlights.push(n),{set:n,handle:{remove:function(){return r.releaseSet(n)},pause:function(){n.highlightSet.removeAll(),n.paused=!0},resume:function(){n.paused=!1,r.initializeSet(n)}}}},e.prototype.releaseSet=function(e){e.highlightSet.removeAll();var t=this.highlights?this.highlights.indexOf(e):-1;-1!==t&&this.highlights.splice(t,1)},e.prototype.setUids=function(e,t){for(var i=this.graphicsCore.graphics3DGraphics,r=0,n=t;r<n.length;r++){var a=n[r];e.ids.add(a);var s=i.get(a);s&&s.addHighlight(e.highlightSet,e.options)}},e.prototype.setObjectIds=function(e,t){t.forEach(function(t){return e.ids.add(t)}),this.initializeSet(e)},e.prototype.addGraphic=function(e){this.highlights.forEach(function(t){!t.paused&&t.hasGraphic(e)&&e.addHighlight(t.highlightSet,t.options)})},e.prototype.removeGraphic=function(e){this.highlights.forEach(function(t){t.hasGraphic(e)&&e.removeHighlight(t.highlightSet)})},e.prototype.allGraphicsDeleted=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()})},e.prototype.initializeSet=function(e){var t=this.graphicsCore.graphics3DGraphics;e.objectIdField?t.forEach(function(t){t&&e.hasGraphic(t)&&t.addHighlight(e.highlightSet,e.options)}):e.ids.forEach(function(i){var r=t.get(i);r&&r.addHighlight(e.highlightSet,e.options)})},e}()}.apply(null,r))||(e.exports=n)},1569:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(6),i(20),i(14),i(0),i(563)],void 0===(n=function(e,t,i,r,n,a,s,o,l){function h(e,t){return null!==e&&e>0&&e<8e7||t>50}return function(e){function t(){var t=e.call(this)||this;return t._scaleRangeActive=!1,t._layerScaleRangeVisibilityDirty=!0,t.layerScaleRangeVisibilityQuery=!1,t.scaleChangeEventHandle=null,t.handles=new a,t.layerView=null,t.layer=null,t.queryGraphicUIDsInExtent=null,t.extent=null,t.graphicsCore=null,t.basemapTerrain=null,t.suspended=!1,t}return i(t,e),Object.defineProperty(t.prototype,"layerScaleRangeVisibilityDirty",{get:function(){return this._layerScaleRangeVisibilityDirty},set:function(e){this._layerScaleRangeVisibilityDirty!==e&&(this._layerScaleRangeVisibilityDirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,i,r,n){var a=this;this.layerView=e,this.layer=t,this.queryGraphicUIDsInExtent=i,this.graphicsCore=r,this.basemapTerrain=n,this.updateScaleRangeActive();var s=this.layerView.view.resourceController.scheduler;this.handles.add(s.registerTask(6,function(){return a.update()},function(){return a.needsUpdate()}))},t.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null),this.handles.destroy(),this.handles=null,this.layerView=null,this.extent=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null},t.prototype.needsUpdate=function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},t.prototype.setExtent=function(e){this.extent=e,this.layerScaleRangeVisibilityDirty=!0},t.prototype.update=function(){this.updateSuspendScaleVisible(),this.layerScaleRangeVisibilityDirty=!1},t.prototype.scaleRangeActive=function(){return this._scaleRangeActive},t.prototype.updateScaleRangeActive=function(){var e=this,t=this.layer,i=h(t.minScale,t.maxScale);t.labelingInfo&&!i&&(i=t.labelingInfo.some(function(e){return e&&h(e.minScale,e.maxScale)}));var r=this._scaleRangeActive!==i;return this._scaleRangeActive=i,i&&!this.scaleChangeEventHandle&&this.basemapTerrain?this.scaleChangeEventHandle=this.basemapTerrain.on("scale-change",function(t){return e.scaleUpdateHandler(t)}):!i&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null),r},t.prototype.updateSuspendScaleVisibleFinish=function(e){this.layerScaleRangeVisibilityQuery=!1,this._set("suspended",!e)},t.prototype.updateSuspendScaleVisible=function(){var e=this,t=this.layerView.view.basemapTerrain;this.extent&&t&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,t.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(t){return e.updateSuspendScaleVisibleFinish(t)})):this.updateSuspendScaleVisibleFinish(!0)},t.prototype.visibleAtLayerScale=function(e){return l.scaleBoundsPredicate(e,this.layer.minScale||0,this.layer.maxScale||0)},t.prototype.visibleAtLabelScale=function(e,t){return l.scaleBoundsPredicate(e,t.minScale||0,t.maxScale||0)},t.prototype.graphicScale=function(e){var t;return s.isSome(e.centroid)?t=e.centroid:s.isSome(e.graphic.geometry)&&"point"===e.graphic.geometry.type&&(t=e.graphic.geometry),t?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(t):1:null},t.prototype.graphicVisible=function(e){var t=this.graphicScale(e);return this.visibleAtLayerScale(t)},t.prototype.updateVisibility=function(e){if(this._scaleRangeActive){var t=this.graphicVisible(e);return e.setVisibilityFlag(1,t,0)}return!1},t.prototype.updateGraphicLabelScaleVisibility=function(e){if(!this._scaleRangeActive)return!1;if(!e._labelGraphics||0===e._labelGraphics.length)return!1;var t=this.graphicScale(e),i=this.updateLabelScaleVisibility(e,t);return i&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty()),i},t.prototype.updateLabelScaleVisibility=function(e,t){if(!e._labelGraphics||0===e._labelGraphics.length)return!1;var i=e._labelGraphics[0]._labelClass;if(i&&null!=i.minScale&&null!=i.maxScale){var r=this.visibleAtLabelScale(t,i);if(e.setVisibilityFlag(1,r,1))return!0}return!1},t.prototype.scaleUpdateHandler=function(e){var t=this;if(!this.layerView.suspended){var i=e.extent,r=e.scale,n=this.visibleAtLayerScale(r),a=!1;this.queryGraphicUIDsInExtent(i,e.spatialReference,function(e){var o=t.graphicsCore.getGraphics3DGraphicById(e);if(o){var l=o.centroid;if(s.isSome(l)&&(i[0]>l.x||i[1]>l.y||i[2]<l.x||i[3]<l.y))return;var h=!1;o.setVisibilityFlag(1,n,0)&&(h=!0),t.updateLabelScaleVisibility(o,r)&&(h=!0),h&&(a=!0)}}),a&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}this.layerScaleRangeVisibilityDirty=!0},t.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&(this._scaleRangeActive?this.graphicsCore.updateAllGraphicsVisibility():this.graphicsCore.modifyGraphics3DGraphicVisibilities(function(e){return e.clearVisibilityFlag(1)})),this.layerScaleRangeVisibilityDirty=!0},r([o.property({readOnly:!0})],t.prototype,"suspended",void 0),r([o.property({readOnly:!0})],t.prototype,"updating",null),r([o.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],t)}(o.declared(n))}.apply(null,r))||(e.exports=n)},1590:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(86),i(1487)],void 0===(n=function(e,t,i,r){function n(e,t,i){if(!i)return t.indexOf(e);for(var r=0;r<t.length;r++)if(i(e,t[r]))return r;return-1}function a(e,t){s(e,0,e.children.length,t,e)}function s(e,t,i,r,n){n||(n=g(null,!0)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var a=t,s=void 0;a<i;a++)s=e.children[a],o(n,e.leaf?r(s):s);return n}function o(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function h(e,t){return e.minY-t.minY}function p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function c(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function u(e,t){var i=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,n-i)*Math.max(0,a-r)}function y(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function f(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function g(e,t){return{children:e,height:1,leaf:t,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(e,t,i,n,a){for(var s=[t,i];s.length;)if(!((i=s.pop())-(t=s.pop())<=n)){var o=t+Math.ceil((i-t)/n/2)*n;r(e,o,t,i,a),s.push(t,o,o,i)}}Object.defineProperty(t,"__esModule",{value:!0});var b=function(){function e(e,t){void 0===e&&(e=9),this.compareMinX=l,this.compareMinY=h,this.toBBox=function(e){return e},this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}return e.prototype.destroy=function(){this.clear(),v.prune(),S.prune(),x.prune(),w.prune()},e.prototype.all=function(e){this._all(this.data,e)},e.prototype.search=function(e,t){var i=this.data,r=this.toBBox;if(f(e,i))for(v.clear();i;){for(var n=0,a=i.children.length;n<a;n++){var s=i.children[n],o=i.leaf?r(s):s;f(e,o)&&(i.leaf?t(s):y(e,o)?this._all(s,t):v.push(s))}i=v.pop()}},e.prototype.collides=function(e){var t=this.data,i=this.toBBox;if(!f(e,t))return!1;for(v.clear();t;){for(var r=0,n=t.children.length;r<n;r++){var a=t.children[r],s=t.leaf?i(a):a;if(f(e,s)){if(t.leaf||y(e,s))return!0;v.push(a)}}t=v.pop()}return!1},e.prototype.load=function(e,t){if(void 0===t&&(t=e.length),!t)return this;if(t<this._minEntries){for(var i=0,r=t;i<r;i++)this.insert(e[i]);return this}var n=this._build(e.slice(0,t),0,t-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var a=this.data;this.data=n,n=a}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},e.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},e.prototype.clear=function(){return this.data=g([],!0),this},e.prototype.remove=function(e,t){if(!e)return this;var i,r,a,s,o=this.data,l=this.toBBox(e);for(x.clear(),w.clear();o||x.length;){if(o||(o=x.pop(),i=x.data[x.length-1],r=w.pop(),a=!0),o.leaf&&-1!==(s=n(e,o.children,t)))return o.children.splice(s,1),x.push(o),this._condense(x),this;a||o.leaf||!y(o,l)?i?(r++,o=i.children[r],a=!1):o=null:(x.push(o),w.push(r),r=0,i=o,o=o.children[0])}return this},e.prototype.toJSON=function(){return this.data},e.prototype.fromJSON=function(e){return this.data=e,this},e.prototype._all=function(e,t){for(S.clear();e;){if(!0===e.leaf)for(var i=0,r=e.children;i<r.length;i++){t(r[i])}else S.pushArray(e.children);e=S.pop()}},e.prototype._build=function(e,t,i,r){var n,s=i-t+1,o=this._maxEntries;if(s<=o)return a(n=g(e.slice(t,i+1),!0),this.toBBox),n;r||(r=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,r-1))),(n=g([],!1)).height=r;var l=Math.ceil(s/o),h=l*Math.ceil(Math.sqrt(o));m(e,t,i,h,this.compareMinX);for(var p=t;p<=i;p+=h){var c=Math.min(p+h-1,i);m(e,p,c,l,this.compareMinY);for(var d=p;d<=c;d+=l){var u=Math.min(d+l-1,c);n.children.push(this._build(e,d,u,r-1))}}return a(n,this.toBBox),n},e.prototype._chooseSubtree=function(e,t,i,r){for(;r.push(t),!0!==t.leaf&&r.length-1!==i;){for(var n=1/0,a=1/0,s=void 0,o=0,l=t.children.length;o<l;o++){var h=t.children[o],c=p(h),u=d(e,h)-c;u<a?(a=u,n=c<n?c:n,s=h):u===a&&c<n&&(n=c,s=h)}t=s||t.children[0]}return t},e.prototype._insert=function(e,t,i){var r=this.toBBox,n=i?e:r(e);x.clear();var a=this._chooseSubtree(n,this.data,t,x);for(a.children.push(e),o(a,n);t>=0&&x.data[t].children.length>this._maxEntries;)this._split(x,t),t--;this._adjustParentBBoxes(n,x,t)},e.prototype._split=function(e,t){var i=e.data[t],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var s=this._chooseSplitIndex(i,n,r),o=g(i.children.splice(s,i.children.length-s),i.leaf);o.height=i.height,a(i,this.toBBox),a(o,this.toBBox),t?e.data[t-1].children.push(o):this._splitRoot(i,o)},e.prototype._splitRoot=function(e,t){this.data=g([e,t],!1),this.data.height=e.height+1,a(this.data,this.toBBox)},e.prototype._chooseSplitIndex=function(e,t,i){var r,n,a;r=n=1/0;for(var o=t;o<=i-t;o++){var l=s(e,0,o,this.toBBox),h=s(e,o,i,this.toBBox),c=u(l,h),d=p(l)+p(h);c<r?(r=c,a=o,n=d<n?d:n):c===r&&d<n&&(n=d,a=o)}return a},e.prototype._chooseSplitAxis=function(e,t,i){var r=e.leaf?this.compareMinX:l,n=e.leaf?this.compareMinY:h;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,n)&&e.children.sort(r)},e.prototype._allDistMargin=function(e,t,i,r){e.children.sort(r);for(var n=this.toBBox,a=s(e,0,t,n),l=s(e,i-t,i,n),h=c(a)+c(l),p=t;p<i-t;p++){var d=e.children[p];o(a,e.leaf?n(d):d),h+=c(a)}for(p=i-t-1;p>=t;p--){d=e.children[p];o(l,e.leaf?n(d):d),h+=c(l)}return h},e.prototype._adjustParentBBoxes=function(e,t,i){for(var r=i;r>=0;r--)o(t.data[r],e)},e.prototype._condense=function(e){for(var t=e.length-1,i=void 0;t>=0;t--)0===e.data[t].children.length?t>0?(i=e.data[t-1].children).splice(i.indexOf(e.data[t]),1):this.clear():a(e.data[t],this.toBBox)},e.prototype._initFormat=function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")},e}();t.PooledRBush=b;var v=new i,S=new i,x=new i,w=new i({deallocator:null});t.default=b}.apply(null,r))||(e.exports=n)},1681:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(15),i(574)],void 0===(n=function(e,t,i,r){function n(e,t){if(!t)return null;var r;if((r=Array.isArray(t)?t:[t]).length>0){var n=r.map(function(e){return e.details.symbol.type||e.details.symbol.declaredClass}).filter(function(e){return!!e});n.sort();var a=[];return n.forEach(function(e,t){0!==t&&e===n[t-1]||a.push(e)}),new i("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+a.join(", ")+") which are not supported in 3D",{renderer:e,symbolErrors:r})}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.validateTo3D=function(e){return e?function(e){return"simple"===e.type}(e)?function(e){return n(e,r.to3D(e.symbol).error)}(e):function(e){return"unique-value"===e.type}(e)?function(e){var t=e.uniqueValueInfos.map(function(e){return r.to3D(e.symbol).error}).filter(function(e){return!!e}),i=r.to3D(e.defaultSymbol);return i.error&&t.unshift(i.error),n(e,t)}(e):function(e){return"class-breaks"===e.type}(e)?function(e){var t=e.classBreakInfos.map(function(e){return r.to3D(e.symbol).error}).filter(function(e){return!!e}),i=r.to3D(e.defaultSymbol);return i.error&&t.unshift(i.error),n(e,t)}(e):new i("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+(e.type||e.declaredClass)+"'",{renderer:e}):null}}.apply(null,r))||(e.exports=n)},1682:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(6),i(37),i(14),i(0),i(95),i(553),i(551),i(1482),i(38)],void 0===(n=function(e,t,i,r,n,a,s,o,l,h,p,c,d){Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(t){var i=e.call(this)||this;return i.events=new a,i.hasZ=null,i.hasM=null,i.objectIdField=null,i.spatialReference=null,i.featureAdapter={getAttribute:function(e,t){return"graphic"in e?e.graphic.attributes[t]:c.default.getAttribute(e,t)},getAttributes:function(e){return"graphic"in e?e.graphic.attributes:c.default.getAttributes(e)},getObjectId:function(e){return"graphic"in e?l.getObjectId(e.graphic,i.objectIdField):c.default.getObjectId(e)},getGeometry:function(e){return"graphic"in e?e.getAsOptimizedGeometry(i.hasZ,i.hasM):c.default.getGeometry(e)},getCentroid:function(e,t){if("graphic"in e){var r=null;s.isSome(e.centroid)?r=e.centroid:"point"===e.graphic.geometry.type&&d.pointToPoint(e.graphic.geometry,y,i.spatialReference)&&(r=y);var n=new Array(2+(t.hasZ?1:0)+(t.hasM?1:0));return s.isNone(r)?(n[0]=0,n[1]=0,n[2]=0,n[3]=0):(n[0]=r.x,n[1]=r.y,t.hasZ&&(n[2]=r.hasZ?r.z:0),t.hasM&&(n[t.hasZ?3:2]=r.hasM?r.m:0)),new p.default([],n)}return c.default.getCentroid(e,t)},cloneWithGeometry:function(e,t){return"graphic"in e?new h.default(t,i.featureAdapter.getAttributes(e),null,i.featureAdapter.getObjectId(e)):c.default.cloneWithGeometry(e,t)}},i}return i(t,e),t.prototype.forEach=function(e){this.forAllGraphics(function(t){e(t)})},t.prototype.forEachInBounds=function(e,t){this.getSpatialIndex().forEachInBounds(e,t)},t.prototype.forEachBounds=function(e,t,i){for(var r=this.getSpatialIndex(),n=0,a=e;n<a.length;n++){var o=a[n],l=this.featureAdapter.getObjectId(o);s.isSome(r.getBounds(l,i))&&t(i)}},r([o.property({constructOnly:!0})],t.prototype,"getSpatialIndex",void 0),r([o.property({constructOnly:!0})],t.prototype,"forAllGraphics",void 0),r([o.property({constructOnly:!0})],t.prototype,"hasZ",void 0),r([o.property({constructOnly:!0})],t.prototype,"hasM",void 0),r([o.property({constructOnly:!0})],t.prototype,"objectIdField",void 0),r([o.property({constructOnly:!0})],t.prototype,"spatialReference",void 0),r([o.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],t)}(o.declared(n));t.Graphics3DFeatureStore=u;var y={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};t.default=u}.apply(null,r))||(e.exports=n)},1683:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.layerOrder=null,this.layerOrderDelta=null,this.clippingExtent=null,this.renderSpatialReference=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.layerView=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.isAsync=!1}}();t.Graphics3DSymbolCreationContext=i}.apply(null,r))||(e.exports=n)},1684:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1685),i(576)],void 0===(n=function(e,t,i,r){Object.defineProperty(t,"__esModule",{value:!0}),t.make=function(e,t,n){var a;switch(e.type){case"point-3d":a=i;break;default:a=r}return new a(e,t,n)}}.apply(null,r))||(e.exports=n)},1685:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(5),i(10),i(12),i(8),i(594),i(576)],void 0===(n=function(e,t,i,r,n,a,s,o){return function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.calloutSymbolLayer=null,n.symbol.hasVisibleCallout()&&(n.calloutSymbolLayer=s.make(n.symbol,i)),n}return i(t,e),t.prototype.doLoad=function(t){return n(this,void 0,void 0,function(){return r(this,function(i){switch(i.label){case 0:return[4,e.prototype.doLoad.call(this,t)];case 1:return i.sent(),this.calloutSymbolLayer?[4,this.calloutSymbolLayer.load()]:[3,3];case 2:i.sent(),i.label=3;case 3:if(a.isAborted(t))throw a.createAbortError();return[2]}})})},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.calloutSymbolLayer&&this.calloutSymbolLayer.destroy()},t.prototype.createGraphics3DGraphic=function(t,i,r){var n=e.prototype.createGraphics3DGraphic.call(this,t,r);if(this.calloutSymbolLayer){var a=this.createCalloutGraphic(t);a&&n.addAuxiliaryGraphic(a)}return n},t.prototype.globalPropertyChanged=function(t,i){var r=this;if(!e.prototype.globalPropertyChanged.call(this,t,i))return!1;if(this.calloutSymbolLayer){return this.calloutSymbolLayer.globalPropertyChanged(t,i,function(e){for(var t=0,i=e._auxiliaryGraphics;t<i.length;t++){var n=i[t];if(n.graphics3DSymbolLayer===r.calloutSymbolLayer)return n}})}return!0},t.prototype.createCalloutGraphic=function(e){var t=e.renderingInfo,i={renderer:t.renderer,symbol:t.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return e.renderingInfo=i,this.calloutSymbolLayer.createGraphics3DGraphic(e)},t}(o)}.apply(null,r))||(e.exports=n)},1686:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(6),i(22),i(0),i(1590),i(43),i(95)],void 0===(n=function(e,t,i,r,n,a,s,o,l,h){Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){function t(t){var i=e.call(this)||this;return i.index=new o.default(9,a("csp-restrictions")?function(e){return{minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),i.boundsByFeature=new Map,i.spatialReference=null,i.hasZ=null,i.hasM=null,i.objectIdField=null,i}return i(t,e),t.prototype.destroy=function(){this.index.destroy(),this.index=null,this.boundsByFeature.clear(),this.boundsByFeature=null},t.prototype.queryGraphicUIDsInExtent=function(e,t,i){t.equals(this.spatialReference)&&(c.minX=e[0],c.minY=e[1],c.maxX=e[2],c.maxY=e[3],this.index.search(c,function(e){return i(e.graphic.uid)}))},t.prototype.add=function(e){e.computeExtent(this.spatialReference),this.index.insert(e);var t=h.getObjectId(e.graphic,this._get("objectIdField"));null!=t&&this.boundsByFeature.set(t,e.extent)},t.prototype.addMany=function(e,t){void 0===t&&(t=e.length);for(var i=this._get("objectIdField"),r=0;r<t;r++){var n=e[r];n.computeExtent(this.spatialReference);var a=h.getObjectId(n.graphic,i);null!=a&&this.boundsByFeature.set(a,n.extent)}this.index.load(e,t)},t.prototype.remove=function(e){this.index.remove(e);var t=h.getObjectId(e.graphic,this._get("objectIdField"));null!=t&&this.boundsByFeature.delete(t)},t.prototype.clear=function(){this.index.clear(),this.boundsByFeature.clear()},t.prototype.forEachInBounds=function(e,t){c.minX=e[0],c.minY=e[1],c.maxX=e[2],c.maxY=e[3],this.index.search(c,function(e){t(e)})},t.prototype.getBounds=function(e,t){var i=this.boundsByFeature.get(e);return i?l.fromRect(t,i):null},r([s.property({constructOnly:!0})],t.prototype,"spatialReference",void 0),r([s.property({constructOnly:!0})],t.prototype,"hasZ",void 0),r([s.property({constructOnly:!0})],t.prototype,"hasM",void 0),r([s.property({constructOnly:!0})],t.prototype,"objectIdField",void 0),r([s.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],t)}(s.declared(n));t.SpatialIndex2D=p;var c={minX:0,minY:0,maxX:0,maxY:0};t.default=p}.apply(null,r))||(e.exports=n)},1687:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1519)],void 0===(n=function(e,t,i){return function(){function e(e,t){this.highlightSet=new i,this.ids=new Set,this.paused=!1,this.options=e,this.objectIdField=t}return e.prototype.hasGraphic=function(e){if(this.objectIdField){var t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)},e}()}.apply(null,r))||(e.exports=n)}}]);