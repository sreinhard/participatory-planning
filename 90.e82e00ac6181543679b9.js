(function(){(this||window).webpackJsonp.registerAbsMids({"esri/core/MapPool":1788,"esri/views/2d/layers/features/processors/BaseProcessor":1834,"esri/views/2d/layers/features/processors/SymbolProcessor":2547})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{1788:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(64)],void 0===(o=function(e,t,r){var n=function(){function e(e,t){void 0===e&&(e=50),void 0===t&&(t=50),this._pool=new r(Map,!1,function(e){return e.clear()},t,e)}return e.prototype.acquire=function(){return this._pool.acquire()},e.prototype.release=function(e){this._pool.release(e)},e.acquire=function(){return o.acquire()},e.release=function(e){return o.release(e)},e}(),o=new n(100);return n}.apply(null,n))||(e.exports=o)},1834:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(2),r(1),r(10),r(11),r(282),r(0)],void 0===(o=function(e,t,r,n,o,i,s,a){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.initialize=function(){},t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"supportsTileUpdates",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){var e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null},enumerable:!0,configurable:!0}),n([a.property({readOnly:!0})],t.prototype,"supportsTileUpdates",null),n([a.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),n([a.property({constructOnly:!0})],t.prototype,"service",void 0),n([a.property({dependsOn:["tileStore.tileScheme.spatialReference"]})],t.prototype,"spatialReference",null),n([a.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),n([a.property({constructOnly:!0})],t.prototype,"tileStore",void 0),n([a.subclass("esri.views.2d.layers.features.processors.BaseProcessor")],t)}(a.declared(s.HandleOwner));t.default=l}.apply(null,n))||(e.exports=o)},2547:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(2),r(1),r(4),r(10),r(11),r(58),r(14),r(18),r(6),r(1788),r(9),r(7),r(0),r(40),r(660),r(693),r(411),r(184),r(426),r(699),r(1834)],void 0===(o=function(e,t,r,n,o,i,s,a,l,c,u,p,f,d,y,h,g,m,v,b,_,w,O){function S(e,t,r){r.has(e)||r.set(e,new Set);for(var n=r.get(e),o=t.length,i=0;i<o;i++){var s=t.charCodeAt(i);n.add(s)}}Object.defineProperty(t,"__esModule",{value:!0});var I=u.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor"),P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._symbolToMosaicItemMap=new Map,t._visualSetPromises=new Map,t.type="symbol",t}return r(t,e),t.prototype.destroy=function(){this._visualSetPromises.clear(),this._symbolToMosaicItemMap.clear(),this.notifyChange("updating")},Object.defineProperty(t.prototype,"supportsTileUpdates",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelingInfo",{get:function(){return!this.config||f.isNone(this.config.labelingInfo)?null:this.config.labelingInfo.map(function(e){return g.fromJSON(e)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelClassInfos",{get:function(){var e=this;return this.labelingInfo?d.all(this.labelingInfo.map(function(t,r){return s(e,void 0,void 0,function(){var e;return i(this,function(n){switch(n.label){case 0:return e={index:r,minScale:t.minScale,maxScale:t.maxScale},[4,m.createLabelFunction(t,this.fields,this.spatialReference)];case 1:return[2,(e.builder=n.sent(),e.symbol=t.symbol,e)]}})})})):d.resolve()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hydrate",{get:function(){return _.createHydrateFactory(this.service.geometryType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"factory",{get:function(){var e=this;if(!this.config)return I.error(new l("mapview-processor","Unable to create factory without a configuration")),null;var t=this.service,r=t.geometryType,n=t.objectIdField,o={geometryType:r,fields:t.fields,spatialReference:h.fromJSON(this.spatialReference)},i=new b.WGLTemplateStore(function(t,r){return e.remoteClient.invoke("tileRenderer.getMaterialItems",t,r)},!1),s=this.tileStore.tileScheme.tileInfo;return this._matcher=b.createMatcher(this.renderer,i,o),new b.WGLMeshFactory(r,n,this.renderer,i,this.labelingInfo,s)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.config?v.fromJSON(this.config.renderer):(c("esri-2d-debug")&&console.debug("Unable to create renderer for undefined configuration"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._visualSetPromises.size>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){return this.service.fields},enumerable:!0,configurable:!0}),t.prototype.update=function(e){return s(this,void 0,void 0,function(){return i(this,function(t){return this._set("config",e),[2]})})},t.prototype.onTileData=function(e,t,r){var n,o=this,i=t.addOrUpdate,s=t.remove,a=t.clear;n=i&&i.length?this._processFeatures(e,i,t.transformParams):d.resolve();var l=r.signal,c=n.then(function(t){var r=t&&t.message||null,n=t&&t.transferList||null;return o.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{addOrUpdate:r,remove:s,clear:a}},{transferList:n,signal:l})}).catch(function(t){return o._handleError(e,t,r)});return this._visualSetPromises.set(e,c),d.always(c,function(){return o._cleanPromise(e)}),this.notifyChange("updating"),c},t.prototype.onTileError=function(e,t,r){var n=this,o=r.signal,i=this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},{signal:o});return this._visualSetPromises.set(e,i),d.always(i,function(){return n._cleanPromise(e)}),this.notifyChange("updating"),i},t.prototype._cleanPromise=function(e){this._visualSetPromises.delete(e),this.notifyChange("updating")},t.prototype._processFeatures=function(e,t,r){var n=this;if(!t||!t.length)return d.resolve(null);var o=this.factory,i={viewingMode:"",scale:e.scale};return a.safeCast(this._matcher.then(function(e){return o.analyze(t,!1,e,r,i)})).then(function(t){return a.safeCast(n._getLabelMosaicItems(e,t,r)).then(function(i){return n._writeFeatures(e,t,r,i,o)})})},t.prototype._writeFeatures=function(e,t,r,n,o){for(var i=o.createMeshData(t.length),s={viewingMode:"",scale:e.scale},a=this._symbolToMosaicItemMap,l=0,c=t;l<c.length;l++){var u=c[l];o.write(i,u,r,s,e.level,n,a)}return this._encodeDisplayData(i)},t.prototype._encodeDisplayData=function(e){var t={},r=new Array;return e.encode(t,r),{message:t,transferList:r}},t.prototype._handleError=function(e,t,r){var n=r.signal;if(!d.isAbortError(t))return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t.message},{signal:n})},t.prototype._getLabelMosaicItems=function(e,t,r){return s(this,void 0,void 0,function(){var n,o,s,a,l,c;return i(this,function(i){switch(i.label){case 0:return n=p.acquire(),[4,this._createLabelFeatures(e.scale,t,n,r)];case 1:return o=i.sent(),s=this._symbolToMosaicItemMap,a=p.acquire(),l=[],c=0,n.forEach(function(e,t){if(s.has(t.id)){var r=s.get(t.id).glyphMosaicItems,n=[];e.forEach(function(e){(r&&r.length<e||!r[e])&&(n[e]=e)}),n.length>0&&(a.set(c,t),l.push({symbol:t.toJSON(),id:c,glyphIds:n}),c++)}else{a.set(c,t);var o=[];e.forEach(function(e){return o.push(e)}),l.push({symbol:t.toJSON(),id:c,glyphIds:o}),c++}}),l.length>0?[2,this.remoteClient.invoke("tileRenderer.getMaterialItems",l).then(function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t],i=a.get(n.id);if(i)if(w.isTextSymbol(i))if(s.has(i.id)){var l=s.get(i.id).glyphMosaicItems,c=n.mosaicItem.glyphMosaicItems;if(c)for(var u=0;u<c.length;u++)null!=c[u]&&(l[u]=c[u])}else s.set(i.id,n.mosaicItem);else s.set(i.id,n.mosaicItem)}return p.release(a),o})]:(p.release(n),[2,d.resolve(o)])}})})},t.prototype._getLabelClassInfosForScale=function(e){return s(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,this.labelClassInfos];case 1:return[2,t.sent().filter(function(t){var r=t.minScale,n=t.maxScale;return(!r||r>=e||0===r)&&(!n||n<=e||0===n)})]}})})},t.prototype._createLabelFeatures=function(e,t,r,n){return s(this,void 0,void 0,function(){var s,a,l,c,u,d,y,g,m,v,_,w,O,P,M,T,C,L,R,j,E,x,F,J,N,U,k,D;return i(this,function(i){switch(i.label){case 0:return this.labelingInfo&&t&&0!==t.length?[4,this._getLabelClassInfosForScale(e)]:[2,null];case 1:if(0===(s=i.sent()).length)return[2,null];for(a=p.acquire(),l=new b.CollisionGrid(b.definitions.COLLISION_EARLY_REJECT_BUCKET_SIZE),c=0,u=t;c<u.length;c++)if(d=u[c],y=this.service.geometryType,g=0,m=0,"esriGeometryPoint"!==y&&"esriGeometryPolygon"!==y||("esriGeometryPoint"===y?(v=d.geometry,g=v.x,m=v.y):(g=d.centroid.x,m=d.centroid.y),!l.checkOverlap(g,m))){for(_=d.localId,w=new Array,O=0;O<s.length;O++){if(P=s[O],M=P.index,T=P.builder,C=P.symbol,L=d,!n)return I.error("mapview-labeling","Tried to evaluate geometry expression but no transformation found"),[2,void 0];R=n.transform,j=n.hasZ,E=n.hasM,x=this.hydrate(d.geometry,R,j,E),F=o({},d,{geometry:x}),x.spatialReference=h.fromJSON(this.spatialReference),L=F,J=T.evaluate(L),f.isNone(J)||(b.definitions.DEBUG_LABELS&&(N="-"+_,J=J.substring(0,J.length-N.length)+N),U=b.bidiText(J),k=U[0],D=U[1],S(C,k,r),w.push({text:k,rtl:D,id:M}))}a.set(_,w)}return[2,a]}})})},n([y.property({readOnly:!0})],t.prototype,"supportsTileUpdates",null),n([y.property()],t.prototype,"config",void 0),n([y.property({dependsOn:["config"]})],t.prototype,"labelingInfo",null),n([y.property({dependsOn:["labelingInfo","fields","spatialReference"]})],t.prototype,"labelClassInfos",null),n([y.property({dependsOn:["service"]})],t.prototype,"hydrate",null),n([y.property({dependsOn:["config","service","renderer","fields","tileStore"]})],t.prototype,"factory",null),n([y.property({dependsOn:["config"],readOnly:!0})],t.prototype,"renderer",null),n([y.property({readOnly:!0})],t.prototype,"updating",null),n([y.property({dependsOn:["service"]})],t.prototype,"fields",null),n([y.subclass("esri.views.2d.layers.features.processors.SymbolProcessor")],t)}(y.declared(O.default));t.default=P}.apply(null,n))||(e.exports=o)}}]);