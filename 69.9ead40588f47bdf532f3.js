(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":1482,"esri/core/libs/quickselect/quickselect":1487,"esri/core/libs/rbush/rbush":1494,"esri/layers/graphics/data/FeatureStore":1504,"esri/layers/graphics/data/QueryEngineCapabilities":1506,"esri/layers/graphics/sources/support/clientSideDefaults":1710,"esri/layers/graphics/sources/support/MemorySourceWorker":1856})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{1482:function(e,t,i){var n,r;n=[i.dj.c(e.i),t,i(1484),i(552),i(550)],void 0===(r=function(e,t,i,n,r){Object.defineProperty(t,"__esModule",{value:!0}),t.optimizedFeatureQueryEngineAdapter={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new n.default(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return e.centroid||(e.centroid=i.getCentroidOptimizedGeometry(new r.default,e.geometry,t.hasZ,t.hasM)),e.centroid}},t.default=t.optimizedFeatureQueryEngineAdapter}.apply(null,n))||(e.exports=r)},1487:function(e,t,i){var n;void 0===(n=function(){"use strict";function e(i,n,r,s,a){for(;s>r;){if(s-r>600){var o=s-r+1,u=n-r+1,l=Math.log(o),d=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*d*(o-d)/o)*(u-o/2<0?-1:1);e(i,n,Math.max(r,Math.floor(n-u*d/o+h)),Math.min(s,Math.floor(n+(o-u)*d/o+h)),a)}var f=i[n],c=r,p=s;for(t(i,r,n),a(i[s],f)>0&&t(i,r,s);c<p;){for(t(i,c,p),c++,p--;a(i[c],f)<0;)c++;for(;a(i[p],f)>0;)p--}0===a(i[r],f)?t(i,r,p):t(i,++p,s),p<=n&&(r=p+1),n<=p&&(s=p-1)}}function t(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function i(e,t){return e<t?-1:e>t?1:0}return function(t,n,r,s,a){e(t,n,r||0,s||t.length-1,a||i)}}.apply(null,[]))||(e.exports=n)},1494:function(e,t,i){var n,r;n=[i(1487)],void 0===(r=function(e){"use strict";function t(e,i){if(!(this instanceof t))return new t(e,i);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&("function"==typeof i?this.toBBox=i:this._initFormat(i)),this.clear()}function i(e,t,i){if(!i)return t.indexOf(e);for(var n=0;n<t.length;n++)if(i(e,t[n]))return n;return-1}function n(e,t){r(e,0,e.children.length,t,e)}function r(e,t,i,n,r){r||(r=p(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var a,o=t;o<i;o++)a=e.children[o],s(r,e.leaf?n(a):a);return r}function s(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function a(e,t){return e.minX-t.minX}function o(e,t){return e.minY-t.minY}function u(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function l(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function h(e,t){var i=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,r-i)*Math.max(0,s-n)}function f(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function c(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function p(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(t,i,n,r,s){for(var a,o=[i,n];o.length;)(n=o.pop())-(i=o.pop())<=r||(a=i+Math.ceil((n-i)/r/2)*r,e(t,a,i,n,s),o.push(i,a,a,n))}return t.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,i=[],n=this.toBBox;if(!c(e,t))return i;for(var r,s,a,o,u=[];t;){for(r=0,s=t.children.length;r<s;r++)a=t.children[r],c(e,o=t.leaf?n(a):a)&&(t.leaf?i.push(a):f(e,o)?this._all(a,i):u.push(a));t=u.pop()}return i},collides:function(e){var t=this.data,i=this.toBBox;if(!c(e,t))return!1;for(var n,r,s,a,o=[];t;){for(n=0,r=t.children.length;n<r;n++)if(s=t.children[n],c(e,a=t.leaf?i(s):s)){if(t.leaf||f(e,a))return!0;o.push(s)}t=o.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=p([]),this},remove:function(e,t){if(!e)return this;for(var n,r,s,a,o=this.data,u=this.toBBox(e),l=[],d=[];o||l.length;){if(o||(o=l.pop(),r=l[l.length-1],n=d.pop(),a=!0),o.leaf&&-1!==(s=i(e,o.children,t)))return o.children.splice(s,1),l.push(o),this._condense(l),this;a||o.leaf||!f(o,u)?r?(n++,o=r.children[n],a=!1):o=null:(l.push(o),d.push(n),n=0,r=o,o=o.children[0])}return this},toBBox:function(e){return e},compareMinX:a,compareMinY:o,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},_build:function(e,t,i,r){var s,a=i-t+1,o=this._maxEntries;if(a<=o)return n(s=p(e.slice(t,i+1)),this.toBBox),s;r||(r=Math.ceil(Math.log(a)/Math.log(o)),o=Math.ceil(a/Math.pow(o,r-1))),(s=p([])).leaf=!1,s.height=r;var u,l,d,h,f=Math.ceil(a/o),c=f*Math.ceil(Math.sqrt(o));for(m(e,t,i,c,this.compareMinX),u=t;u<=i;u+=c)for(m(e,u,d=Math.min(u+c-1,i),f,this.compareMinY),l=u;l<=d;l+=f)h=Math.min(l+f-1,d),s.children.push(this._build(e,l,h,r-1));return n(s,this.toBBox),s},_chooseSubtree:function(e,t,i,n){for(var r,s,a,o,l,h,f,c;n.push(t),!t.leaf&&n.length-1!==i;){for(f=c=1/0,r=0,s=t.children.length;r<s;r++)l=u(a=t.children[r]),(h=d(e,a)-l)<c?(c=h,f=l<f?l:f,o=a):h===c&&l<f&&(f=l,o=a);t=o||t.children[0]}return t},_insert:function(e,t,i){var n=this.toBBox,r=i?e:n(e),a=[],o=this._chooseSubtree(r,this.data,t,a);for(o.children.push(e),s(o,r);t>=0&&a[t].children.length>this._maxEntries;)this._split(a,t),t--;this._adjustParentBBoxes(r,a,t)},_split:function(e,t){var i=e[t],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);var a=this._chooseSplitIndex(i,s,r),o=p(i.children.splice(a,i.children.length-a));o.height=i.height,o.leaf=i.leaf,n(i,this.toBBox),n(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(e,t){this.data=p([e,t]),this.data.height=e.height+1,this.data.leaf=!1,n(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,i){var n,s,a,o,l,d,f,c;for(d=f=1/0,n=t;n<=i-t;n++)o=h(s=r(e,0,n,this.toBBox),a=r(e,n,i,this.toBBox)),l=u(s)+u(a),o<d?(d=o,c=n,f=l<f?l:f):o===d&&l<f&&(f=l,c=n);return c},_chooseSplitAxis:function(e,t,i){var n=e.leaf?this.compareMinX:a,r=e.leaf?this.compareMinY:o;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,r)&&e.children.sort(n)},_allDistMargin:function(e,t,i,n){e.children.sort(n);var a,o,u=this.toBBox,d=r(e,0,t,u),h=r(e,i-t,i,u),f=l(d)+l(h);for(a=t;a<i-t;a++)o=e.children[a],s(d,e.leaf?u(o):o),f+=l(d);for(a=i-t-1;a>=t;a--)o=e.children[a],s(h,e.leaf?u(o):o),f+=l(h);return f},_adjustParentBBoxes:function(e,t,i){for(var n=i;n>=0;n--)s(t[n],e)},_condense:function(e){for(var t,i=e.length-1;i>=0;i--)0===e[i].children.length?i>0?(t=e[i-1].children).splice(t.indexOf(e[i]),1):this.clear():n(e[i],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}},t}.apply(null,n))||(e.exports=r)},1504:function(e,t,i){var n,r;n=[i.dj.c(e.i),t,i(10),i(12),i(5),i(551),i(15),i(37),i(22),i(11),i(14),i(1494),i(43),i(35),i(352),i(1482)],void 0===(r=function(e,t,i,n,r,s,a,o,u,l,d,h,f,c,p,m){Object.defineProperty(t,"__esModule",{value:!0});var y=[],g=l.getLogger("esri.layers.graphics.data.FeatureStore"),_={minX:0,minY:0,maxX:0,maxY:0},v=function(){function e(e,t,i){this._geometryInfo=e,this._onFeatureAdd=t,this._onFeatureRemove=i,this._featuresById=new s.default,this._boundsByFeature=new s.default,this._featuresByBounds=new s.default,this._index=h(9,u("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this.events=new o,this.featureAdapter=m.optimizedFeatureQueryEngineAdapter}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this._geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this._geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this._geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){if(!this.numFeatures)return null;var e=c.create(c.NEGATIVE_INFINITY);return this._boundsByFeature.forEach(function(t){t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]))}),e},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this._add(e,y),this._index.load(y),this._emitChanged(),y.length=0},e.prototype.addMany=function(e){for(var t=0,i=e;t<i.length;t++){var n=i[t];this._add(n,y)}this._index.load(y),this._emitChanged(),y.length=0},e.prototype.clear=function(){this._featuresById.clear(),this._boundsByFeature.clear(),this._featuresByBounds.clear(),this._index.clear(),this._emitChanged()},e.prototype.removeById=function(e){var t=this._featuresById.get(e);if(!t)return null;var i=this._boundsByFeature.get(t);return i&&(this._index.remove(i),this._featuresByBounds.delete(i)),this._boundsByFeature.delete(t),this._featuresById.delete(e),this._emitChanged(),t},e.prototype.removeIf=function(e,t){var i=this;this._featuresById.forEach(function(n,r){t(n)&&(i._remove(n),e.push(n))}),this._emitChanged()},e.prototype.removeManyById=function(e){for(var t=0,i=e;t<i.length;t++){var n=i[t],r=this._featuresById.get(n);if(r){var s=this._boundsByFeature.get(r);s&&(this._index.remove(s),this._featuresByBounds.delete(s)),this._boundsByFeature.delete(r)}this._featuresById.delete(n)}this._emitChanged()},e.prototype.forEachBounds=function(e,t,i){for(var n=0,r=e;n<r.length;n++){var s=r[n],a=this._boundsByFeature.get(s);a&&t(f.fromRect(i,a))}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.has=function(e){return this._featuresById.has(e)},e.prototype.forEach=function(e){this._featuresById.forEach(function(t){return e(t)})},e.prototype.forEachInBounds=function(e,t){for(var i=0,n=function(e,t){return _.minX=t[0],_.minY=t[1],_.maxX=t[2],_.maxY=t[3],e.search(_)}(this._index,e);i<n.length;i++){var r=n[i];t(this._featuresByBounds.get(r))}},e.prototype.transferById=function(e,t){var i=this._featuresById.get(t);i&&(this._remove(i),e.add(i),this._emitChanged())},e.prototype.transferByIds=function(e,t){for(var i=[],n=0,r=t;n<r.length;n++){var s=r[n],a=this._featuresById.get(s);a&&(this._remove(a),i.push(a))}e.addMany(i),this._emitChanged()},e.prototype.transferIdRange=function(e,t,i){for(var n=[],r=t;r<i;r++){var s=this._featuresById.get(r);s&&(this._remove(s),n.push(s))}e.addMany(n),this._emitChanged()},e.prototype.transferIf=function(e,t){var i=this,n=[];this._featuresById.forEach(function(e,r){t(e)&&(i._remove(e),n.push(e))}),e.addMany(n),this._emitChanged()},e.prototype.transferAll=function(e){var t=this,i=[];this._featuresById.forEach(function(e,n){t._remove(e),i.push(e)}),e.addMany(i),this._emitChanged()},e.prototype._emitChanged=function(){this.events.emit("changed",void 0)},e.prototype._add=function(e,t){if(e){var i=e.objectId;if(null==i)return void g.error(new a("featurestore:invalid-feature","feature id is missing",{feature:e}));var n,r=this._featuresById.get(i);if(r?(n=this._boundsByFeature.get(r),e.localId=r.localId,n&&(this._index.remove(n),this._boundsByFeature.delete(r),this._featuresByBounds.delete(n))):d.isSome(this._onFeatureAdd)&&this._onFeatureAdd(e),!e.geometry)return this._boundsByFeature.set(e,null),void this._featuresById.set(i,e);n=p.getBoundsOptimizedGeometry(n||c.create(),e.geometry,this._geometryInfo.hasZ,this._geometryInfo.hasM),this._boundsByFeature.set(e,n),this._featuresByBounds.set(n,e),this._featuresById.set(i,e),t.push(n)}},e.prototype._remove=function(e){var t;e&&(d.isSome(this._onFeatureRemove)&&this._onFeatureRemove(e),(t=this._boundsByFeature.get(e))&&(this._index.remove(t),this._boundsByFeature.delete(e),this._featuresByBounds.delete(t)),this._featuresById.delete(e.objectId))},e}();t.default=v}.apply(null,n))||(e.exports=r)},1506:function(e,t,i){var n,r;n=[i.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}}.apply(null,n))||(e.exports=r)},1710:function(e,t,i){var n,r;n=[i.dj.c(e.i),t,i(7),i(22),i(13),i(577)],void 0===(r=function(e,t,i,n,r,s){Object.defineProperty(t,"__esModule",{value:!0}),t.createDrawingInfo=function(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?s.defaultPointSymbolJSON:"esriGeometryPolyline"===e?s.defaultPolylineSymbolJSON:s.defaultPolygonSymbolJSON}}},t.createDefaultAttributesFunction=function(e,t){if(n("csp-restrictions"))return function(){var n;return i(((n={})[t]=null,n),e)};try{var r="this."+t+" = null;";for(var s in e)r+="this."+s+" = "+JSON.stringify(e[s])+";";var a=new Function(r);return function(){return new a}}catch(n){return function(){var n;return i(((n={})[t]=null,n),e)}}},t.createDefaultTemplate=function(e){return void 0===e&&(e={}),[{name:"New Feature",description:"",prototype:{attributes:r.clone(e)}}]}}.apply(null,n))||(e.exports=r)},1856:function(e,t,i){var n,r;n=[i.dj.c(e.i),t,i(10),i(12),i(7),i(15),i(8),i(71),i(94),i(352),i(1504),i(1511),i(1505),i(1710),i(553),i(396),i(106)],void 0===(r=function(e,t,i,n,r,s,a,o,u,l,d,h,f,c,p,m,y){function g(e){return o.isPoint(e)?null!=e.z:!!e.hasZ}function _(e){return o.isPoint(e)?null!=e.m:!!e.hasM}Object.defineProperty(t,"__esModule",{value:!0});var v=u.WGS84,b={xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:u.WGS84},x={hasAttachments:!1,capabilities:"query, editing, create, delete, update",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}},I=function(){return function(){this.code=null,this.description=null}}(),F=function(){return function(e){this.error=new I,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=e}}(),B=function(){return function(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}(),M=function(){function e(){this._queryEngine=null,this._nextObjectId=null}return e.prototype.destroy=function(){this._queryEngine&&this._queryEngine&&this._queryEngine.destroy(),this._queryEngine=this._requiredFieldNames=this._fieldsIndex=this._createDefaultAttributes=null},e.prototype.load=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,function(){var t,n,a,o,u,l,g,_,I,F,B,M,j,E,w,T,Y,O,X,S,R,q,D,C,P;return i(this,function(i){switch(i.label){case 0:if(t=[],n=e.features,a=this._inferLayerProperties(n,e.fields),o=e.fields||[],u=null!=e.hasM?e.hasM:a.hasM,l=null!=e.hasZ?e.hasZ:a.hasZ,g=!e.spatialReference&&!a.spatialReference,_=g?v:e.spatialReference||a.spatialReference,I=g?b:null,F=e.geometryType||a.geometryType,B=e.objectIdField||a.objectIdField,M=e.timeInfo,g&&t.push({type:"feature-layer:spatial-reference-not-found",message:"Spatial reference not provided or found in features. Defaults to WGS84"}),!F)throw new s("feature-layer:missing-property","geometryType not set and couldn't be inferred from the provided features");if(!B)throw new s("feature-layer:missing-property","objectIdField not set and couldn't be found in the provided fields");for(a.objectIdField&&B!==a.objectIdField&&(t.push({type:"feature-layer:duplicated-oid-field",message:'Provided objectIdField "'+B+'" doesn\'t match the field name "'+a.objectIdField+'", found in the provided fields'}),B=a.objectIdField),B&&!a.objectIdField&&(j=null,o.some(function(e){return e.name===B&&(j=e,!0)})?(j.type="esriFieldTypeOID",j.editable=!1,j.nullable=!1):o.unshift({alias:B,name:B,type:"esriFieldTypeOID",editable:!1,nullable:!1})),E=0,w=o;E<w.length;E++){if(null==(X=w[E]).name&&(X.name=X.alias),null==X.alias&&(X.alias=X.name),!X.name)throw new s("feature-layer:invalid-field-name","field name is missing",{field:X});if(X.name===B&&(X.type="esriFieldTypeOID"),-1===m.kebabDict.jsonValues.indexOf(X.type))throw new s("feature-layer:invalid-field-type",'invalid type for field "'+X.name+'"',{field:X})}for(T={},this._requiredFieldNames=[],Y=0,O=o;Y<O.length;Y++)"esriFieldTypeOID"!==(X=O[Y]).type&&"esriFieldTypeGlobalID"!==X.type&&(X.editable=null==X.editable||!!X.editable,X.nullable=null==X.nullable||!!X.nullable,S=y.getFieldDefaultValue(X),X.nullable||void 0!==S?T[X.name]=S:this._requiredFieldNames.push(X.name));return this._fieldsIndex=new p(o),this._createDefaultAttributes=c.createDefaultAttributesFunction(T,B),M&&(M.startTimeField&&((R=this._fieldsIndex.get(M.startTimeField.toLowerCase()))?(M.startTimeField=R.name,R.type="esriFieldTypeDate"):M.startTimeField=null),M.endTimeField&&((q=this._fieldsIndex.get(M.endTimeField.toLowerCase()))?(M.endTimeField=q.name,q.type="esriFieldTypeDate"):M.endTimeField=null),M.trackIdField&&((D=this._fieldsIndex.get(M.trackIdField.toLowerCase()))?M.trackIdField=D.name:(M.trackIdField=null,t.push({type:"feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:M}}))),M.startTimeField||M.endTimeField||(t.push({type:"feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing or invalid",details:{timeInfo:M}}),M=null)),C={warnings:t,featureErrors:[],layerDefinition:r({},x,{drawingInfo:c.createDrawingInfo(F),templates:c.createDefaultTemplate(T),extent:I,geometryType:F,objectIdField:B,fields:o,hasZ:!!l,hasM:!!u,timeInfo:M}),assignedObjectIds:{}},this._queryEngine=new f.default({fields:o,geometryType:F,hasM:u,hasZ:l,objectIdField:B,spatialReference:_,featureStore:new d.default({geometryType:F,hasM:u,hasZ:l}),timeInfo:M}),n&&n.length?(P=n.reduce(function(e,t){var i=t.attributes&&t.attributes[B];return null==i||isNaN(i)||!isFinite(i)?e:Math.max(e,i)},0),this._nextObjectId=1+P,[4,h.checkProjectionSupport(n,_)]):(this._nextObjectId=1,[2,C]);case 1:return i.sent(),[2,this._loadInitialFeatures(C,n)]}})})},e.prototype.applyEdits=function(e){return n(this,void 0,void 0,function(){var t;return i(this,function(i){switch(i.label){case 0:return t=this._queryEngine.spatialReference,[4,a.all([h.checkProjectionSupport(e.adds,t),h.checkProjectionSupport(e.updates,t)])];case 1:return i.sent(),[2,this._applyEdits(e)]}})})},e.prototype.queryFeatures=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,function(){return i(this,function(i){return[2,this._queryEngine.executeQuery(e,t.signal)]})})},e.prototype.queryFeatureCount=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,function(){return i(this,function(i){return[2,this._queryEngine.executeQueryForCount(e,t.signal)]})})},e.prototype.queryObjectIds=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,function(){return i(this,function(i){return[2,this._queryEngine.executeQueryForIds(e,t.signal)]})})},e.prototype.queryExtent=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,function(){return i(this,function(i){return[2,this._queryEngine.executeQueryForExtent(e,t.signal)]})})},e.prototype._inferLayerProperties=function(e,t){for(var i=void 0,n=void 0,r=null,s=null,a=null,u=0,l=e;u<l.length;u++){var d=l[u].geometry;if(d&&(r||(r=o.getJsonType(d)),s||(s=d.spatialReference),null==i&&(i=g(d)),null==n&&(n=_(d)),r&&s&&null!=i&&null!=n))break}if(t&&t.length){var h=null;t.some(function(e){var t="esriFieldTypeOID"===e.type,i=!e.type&&e.name&&"objectid"===e.name.toLowerCase();return h=e,t||i})&&(a=h.name)}return{geometryType:r,spatialReference:s,objectIdField:a,hasM:n,hasZ:i}},e.prototype._loadInitialFeatures=function(e,t){for(var i=this._queryEngine,n=i.geometryType,r=i.hasM,s=i.hasZ,a=i.objectIdField,u=i.spatialReference,d=i.featureStore,f=[],c=0,p=t;c<p.length;c++){var m=p[c];if(null!=m.uid&&(e.assignedObjectIds[m.uid]=-1),m.geometry&&n!==o.getJsonType(m.geometry))e.featureErrors.push(new F("Incorrect geometry type."));else{var y=this._createDefaultAttributes(),g=this._mixAttributes(y,m.attributes,!0);g?e.featureErrors.push(g):(this._assignObjectId(y,m.attributes,!0),m.attributes=y,null!=m.uid&&(e.assignedObjectIds[m.uid]=m.attributes[a]),m.geometry&&(m.geometry=h.project(m.geometry,m.geometry.spatialReference,u)),f.push(m))}}if(d.addMany(l.convertFromFeatures([],f,n,s,r,a)),e.layerDefinition.extent=this._queryEngine.fullExtent,e.layerDefinition.timeInfo){var _=this._queryEngine.timeExtent,v=_.start,b=_.end;e.layerDefinition.timeInfo.timeExtent=[v,b]}return e},e.prototype._applyEdits=function(e){var t=e.adds,i=e.updates,n=e.deletes,r={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};if(t&&t.length&&this._applyAddEdits(r,t),i&&i.length&&this._applyUpdateEdits(r,i),n&&n.length){for(var s=0,a=n;s<a.length;s++){var o=a[s];r.deleteResults.push(new B(o))}this._queryEngine.featureStore.removeManyById(n)}return{fullExtent:this._queryEngine.fullExtent,featureEditResults:r}},e.prototype._applyAddEdits=function(e,t){for(var i=e.addResults,n=this._queryEngine,r=n.geometryType,s=n.hasM,a=n.hasZ,u=n.objectIdField,d=n.spatialReference,f=n.featureStore,c=[],p=0,m=t;p<m.length;p++){var y=m[p];if(y.geometry&&r!==o.getJsonType(y.geometry))i.push(new F("Incorrect geometry type."));else{var g=this._createDefaultAttributes(),_=this._mixAttributes(g,y.attributes);if(_)i.push(_);else{if(this._assignObjectId(g,y.attributes),y.attributes=g,null!=y.uid){var v=y.attributes[u];e.uidToObjectId[y.uid]=v}y.geometry&&(y.geometry=h.project(y.geometry,y.geometry.spatialReference,d)),c.push(y),i.push(new B(y.attributes[u]))}}}f.addMany(l.convertFromFeatures([],c,r,a,s,u))},e.prototype._applyUpdateEdits=function(e,t){for(var i=e.updateResults,n=this._queryEngine,r=n.geometryType,s=n.hasM,a=n.hasZ,u=n.objectIdField,d=n.spatialReference,f=n.featureStore,c=0,p=t;c<p.length;c++){var m=p[c],y=m.attributes,g=m.geometry,_=y&&y[u];if(null!=_)if(f.has(_)){var v=l.convertToFeature(f.getFeature(_),r,a,s);if(g){if(r!==o.getJsonType(g)){i.push(new F("Incorrect geometry type."));continue}v.geometry=h.project(g,g.spatialReference,d)}if(y){var b=this._mixAttributes(v.attributes,y);if(b){i.push(b);continue}}f.add(l.convertFromFeature(v,r,a,s,u)),i.push(new B(_))}else i.push(new F("Feature with object id "+_+" missing"));else i.push(new F("Identifier field "+u+" missing"))}},e.prototype._assignObjectId=function(e,t,i){void 0===i&&(i=!1);var n=this._queryEngine.objectIdField;i&&t&&isFinite(t[n])?e[n]=t[n]:e[n]=this._nextObjectId++},e.prototype._mixAttributes=function(e,t,i){for(var n in void 0===i&&(i=!1),t){var r=y.sanitizeNullFieldValue(t[n]),s=this._fieldsIndex.get(n)||this._fieldsIndex.get(n.toLowerCase());if(s&&(i||s.editable)){var a=y.validateFieldValue(s,r);if(a)return new F(y.validationErrorToString(a,s,r));e[s.name]=r}}for(var o=0,u=this._requiredFieldNames;o<u.length;o++){var l=u[o];if(void 0===e[l])return new F('missing required field "'+l+'"')}return null},e}();t.default=M}.apply(null,n))||(e.exports=r)}}]);