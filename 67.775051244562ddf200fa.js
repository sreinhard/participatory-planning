(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/layers/features/processors/BaseProcessor":1718,"esri/views/2d/engine/webgl/rendererInfoUtils":1719,"esri/views/2d/layers/features/processors/SymbolProcessor":2272,"esri/views/2d/engine/webgl/collisions/CollisionGrid":2273,"esri/views/2d/layers/features/support/pixelBuffering":2274})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{1718:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(6),r(48),r(1509),r(0)],void 0===(i=function(e,t,r,n,i,o,s,l){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])},t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"supportsTileUpdates",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){var e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null},enumerable:!0,configurable:!0}),n([l.property({readOnly:!0})],t.prototype,"supportsTileUpdates",null),n([l.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),n([l.property({constructOnly:!0})],t.prototype,"service",void 0),n([l.property({dependsOn:["tileStore.tileScheme.spatialReference"]})],t.prototype,"spatialReference",null),n([l.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),n([l.property({constructOnly:!0})],t.prototype,"tileStore",void 0),n([l.subclass()],t)}(l.declared(i,s,o));t.default=a}.apply(null,n))||(e.exports=i)},1719:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(79),r(156),r(81),r(1511),r(1626)],void 0===(i=function(e,t,r,n,i,o,s,l){Object.defineProperty(t,"__esModule",{value:!0});var a=new i;function u(e,t,r){if(!e)return null;var i=0,s={},l=e.clone(),u=l.visualVariables,p=null;if("simple"!==l.type&&"dot-density"!==l.type){var c=l.field,f=l.valueExpression;if(!c&&f){var d="$$fake"+i++,y=o.createFunction(f);s[d]=function(e,n){return a.repurposeFromGraphicLikeObject(e.geometry,e.attributes,r),o.executeFunction(y,{vars:{$feature:a,$view:o.getViewInfo(n)},spatialReference:t})},l.field=d,l.valueExpression=null,p=function(e,t){return t.attributes[d]=s[d](t),e.valueExpression?e.getSymbol(n.fromJSON(t)):e.getSymbol(t)}}}return u&&(l.visualVariables=u.map(function(e){var n="size"===e.type&&e.valueExpression&&"$view.scale"===e.valueExpression;if(e.normalizationField){var l=e.field,u=e.normalizationField,p="$$fake"+i++;return s[p]=function(e,t){return e.attributes[l]/e.attributes[u]},(c=e.clone()).field=p,c.normalizationField=null,c}if(!e.valueExpression||n)return e;var c,f=e.valueExpression,d=(p="$$fake"+i++,o.createFunction(f));return s[p]=function(e,n){return a.repurposeFromGraphicLikeObject(e.geometry,e.attributes,r),o.executeFunction(d,{vars:{$feature:a,$view:o.getViewInfo(n)},spatialReference:t})},(c=e.clone()).field=p,c.valueExpression=null,c})),{renderer:l,normalizingFunctions:s,getSymbolFunction:p}}t.createRendererInfo=function(e,t,r){var n=u(e,t,r)||{renderer:null,normalizingFunctions:null,getSymbolFunction:null},i=n&&n.normalizingFunctions,o=n&&n.getSymbolFunction;e=n&&n.renderer||e;var s=l.convertVisualVariables(e.visualVariables);return{renderer:e,vvFields:s.vvFields,vvRanges:s.vvRanges,getValue:function(e,t){var r=i[t];return r?r(e):e.attributes[t]},getSymbol:function(e){return o?o(this.renderer,e):this.renderer.getSymbol?this.renderer.getSymbol.call(this.renderer,e):null}}},t.getNormalizedRenderer=function(e,t,r){var n=u(e,t,r)||{renderer:null,normalizingFunctions:null,getSymbolFunction:null};return n&&n.renderer||e},t.getSymbol=function(e,t){return e.getSymbol(t)},t.isRendererWebGLCompatible=function(e){if(!e)return!1;if(-1===["simple","class-breaks","unique-value","heatmap"].indexOf(e.type))return!1;if("visualVariables"in e&&e.visualVariables)for(var t=0,r=e.visualVariables;t<r.length;t++){var n=r[t];switch(n.type){case"color":case"opacity":if(n.stops&&8<n.stops.length)return!1;break;case"size":if(l.getTypeOfSizeVisualVariable(n)===s.WGLVVFlag.SIZE_FIELD_STOPS&&n.stops&&6<n.stops.length)return!1}}return!0}}.apply(null,n))||(e.exports=i)},2272:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(11),r(134),r(13),r(10),r(1617),r(8),r(0),r(34),r(374),r(604),r(368),r(1512),r(1719),r(1517),r(2273),r(1624),r(1625),r(1607),r(1650),r(1718),r(2274)],void 0===(i=function(e,t,r,n,i,o,s,l,a,u,p,c,f,d,y,h,m,g,v,b,_,S,I,x,O){function w(e,t){switch(e){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryMultipoint":return!0;case"esriGeometryPolygon":return function(e){var t=e&&e.getSymbols();return function(e){return e&&("unique-value"===e.type||"class-breaks"===e.type)&&null!==e.backgroundFillSymbol}(e)||t.some(function(e){return"simple-fill"===e.type||"picture-fill"===e.type})}(t);default:return E.error(new s("mapview-invalid-type",e+" is not supported")),!1}}function M(e,t,r){r.has(e)||r.set(e,new Set);for(var n=r.get(e),i=t.length,o=0;o<i;o++){var s=t.charCodeAt(o);n.add(s)}}Object.defineProperty(t,"__esModule",{value:!0});var E=l.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor"),P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._symbolToMosaicItemMap=new Map,t._visualSetPromises=new Map,t.type="symbol",t}return r(t,e),t.prototype.destroy=function(){this._visualSetPromises.forEach(function(e,t){e.cancel()}),this._visualSetPromises.clear(),this._symbolToMosaicItemMap.clear(),this.notifyChange("updating")},Object.defineProperty(t.prototype,"supportsTileUpdates",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelingInfo",{get:function(){return this.configuration&&this.configuration.labelingInfo?this.configuration.labelingInfo.map(function(e){return f.fromJSON(e)}):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelClassInfos",{get:function(){var e=this;return this.labelingInfo?this.labelingInfo.map(function(t){return{labelOptions:d.getLabelingOptions(t,e.spatialReference),labelExpression:t.getLabelExpression(),labelClass:t}}):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hydrate",{get:function(){return g.createHydrateFactory(this.service.geometryType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"factory",{get:function(){var e=this;if(!this.configuration)return null;var t=this.service,r=t.geometryType,n=t.objectIdField,i=t.fields,o=this.configuration,s=o.devicePixelRatio,l=o.hasGeometryExpr,a=c.fromJSON(this.spatialReference),u={hasGeometryExpr:l,geometryType:r,fields:i,spatialReference:a},p=new S.default(function(t){return e.remoteClient.invoke("tileRenderer.getMaterialItems",t)});return this._matcher=b.createMatcher(this.renderer,p,u),new _.default(r,n,this.renderer,u,s,a,p,this.labelingInfo,this.tileStore.tileScheme.tileInfo)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryInfo",{get:function(){var e=this.configuration,t=e.renderer,r=e.definitionExpression,n=e.availableFields,i=e.gdbVersion,o=e.historicMoment,s=this.service.geometryType,l=this._getReturnCentroid(this.rendererInfo.renderer),a=w(s,this.rendererInfo.renderer),u=null,p=t.visualVariables;p&&p.some(function(e){if("size"===e.type&&e.field&&!e.normalizationField)return u=[e.field+" DESC"],!0});var c=O.computePxBuffer(this.rendererInfo.renderer);return{definitionExpression:r,orderByFields:u,outFields:n,pixelBuffer:c,returnCentroid:l,returnGeometry:a,gdbVersion:i,historicMoment:o}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.configuration?y.fromJSON(this.configuration.renderer):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rendererInfo",{get:function(){return this.configuration?m.createRendererInfo(y.fromJSON(this.configuration.renderer),this.tileStore.tileScheme.spatialReference,{fields:this.service.fields}):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._visualSetPromises.size>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){return this.service.fields},enumerable:!0,configurable:!0}),t.prototype.onTileData=function(e,t){var r=this,n=t.addOrUpdate,i=t.remove,o=t.clear,s=(n&&n.length?this._processFeatures(e,n,t.transformParams):u.resolve()).then(function(t){var n=t&&t.message||null,s=t&&t.transferList||null;return r.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{addOrUpdate:n,remove:i,clear:o}},{transferList:s})}).catch(function(t){return r._handleError(e,t)});return this._visualSetPromises.set(e,s),s.then(function(){return r._cleanPromise(e)},function(){return r._cleanPromise(e)}),this.notifyChange("updating"),s},t.prototype.onTileError=function(e,t){var r=this,n=this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t});return this._visualSetPromises.set(e,n),n.then(function(){return r._cleanPromise(e)},function(){return r._cleanPromise(e)}),this.notifyChange("updating"),n},t.prototype.onTileUpdate=function(e){for(var t=0,r=e.removed;t<r.length;t++){var n=r[t],i=this._visualSetPromises;if(!i.has(n))return;i.get(n).cancel(),i.delete(n),this.notifyChange("updating")}},t.prototype._cleanPromise=function(e){this._visualSetPromises.delete(e),this.notifyChange("updating")},t.prototype._processFeatures=function(e,t,r){var n=this;if(!t||!t.length)return u.resolve(null);var i=this.factory,o={viewingMode:"",scale:e.scale};return i.analyze(t,this._matcher,r,o).then(function(t){return n._getLabelMosaicItems(e,t,r).then(function(o){return n._writeFeatures(e,t,r,o,i)})})},t.prototype._writeFeatures=function(e,t,r,n,i){for(var o=i.createMeshData(t.length),s={viewingMode:"",scale:e.scale},l=this._symbolToMosaicItemMap,a=0,u=t;a<u.length;a++){var p=u[a];i.write(o,p,r,s,e.level,n,l)}return this._encodeDisplayData(o)},t.prototype._encodeDisplayData=function(e){var t={},r=new Array;return e.encode(t,r),{message:t,transferList:r}},t.prototype._handleError=function(e,t){if(t&&"cancel"!==t.dojoType)return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t.message})},t.prototype._getReturnCentroid=function(e){function t(e){if(!e)return!1;var t=e.type;return"simple-marker"===t||"picture-marker"===t||"text"===t}if("esriGeometryPolygon"===this.service.geometryType&&this.labelingInfo)return!0;if("esriGeometryPolygon"!==this.service.geometryType)return!1;switch(e.type){case"simple":return t(e.symbol);case"unique-value":return t(e.defaultSymbol)||e.uniqueValueInfos.some(function(e){return t(e.symbol)});case"class-breaks":return t(e.defaultSymbol)||e.classBreakInfos.some(function(e){return t(e.symbol)});default:return!0}},t.prototype._getLabelMosaicItems=function(e,t,r){var n=a.acquire(),i=this._createLabelFeatures(e.scale,t,n,r),o=this._symbolToMosaicItemMap,s=a.acquire(),l=[],p=0;return n.forEach(function(e,t){if(o.has(t.id)){var r=o.get(t.id).glyphMosaicItems,n=[];e.forEach(function(e){(r&&r.length<e||!r[e])&&(n[e]=e)}),n.length>0&&(s.set(p,t),l.push({symbol:t.toJSON(),id:p,glyphIds:n}),p++)}else{s.set(p,t);var i=[];e.forEach(function(e){return i.push(e)}),l.push({symbol:t.toJSON(),id:p,glyphIds:i}),p++}}),l.length>0?this.remoteClient.invoke("tileRenderer.getMaterialItems",l).then(function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t],l=s.get(n.id);if(l)if(g.isTextSymbol(l))if(o.has(l.id)){var u=o.get(l.id).glyphMosaicItems,p=n.mosaicItem.glyphMosaicItems;if(p)for(var c=0;c<p.length;c++)null!=p[c]&&(u[c]=p[c])}else o.set(l.id,n.mosaicItem);else o.set(l.id,n.mosaicItem)}return a.release(s),i}):(a.release(n),u.resolve(i))},t.prototype._getLabelClassInfos=function(e){return this.labelClassInfos.map(function(e,t){return{id:t,labelClassInfo:e}}).filter(function(t){var r=t.labelClassInfo;return(!r.labelClass.minScale||r.labelClass.minScale>=e||0===r.labelClass.minScale)&&(!r.labelClass.maxScale||r.labelClass.maxScale<=e||0===r.labelClass.maxScale)})},t.prototype._createLabelFeatures=function(e,t,r,n){if(!this.labelingInfo||!t||0===t.length)return null;var s=new o({viewingMode:"",scale:e}),l=this._getLabelClassInfos(e);if(0===l.length)return null;for(var u=a.acquire(),p=new v.default(h.COLLISION_EARLY_REJECT_BUCKET_SIZE),f=0,d=t;f<d.length;f++){var y=d[f],m=this.service.geometryType,g=0,b=0;if("esriGeometryPoint"===m||"esriGeometryPolygon"===m){if("esriGeometryPoint"===m){var _=y.geometry;g=_.x,b=_.y}else g=y.centroid.x,b=y.centroid.y;if(p.checkOverlap(g,b))continue}for(var S=y.attributes[this.service.objectIdField],x=new Array,O=0;O<l.length;O++){var w=l[O],P=w.labelClassInfo,C=w.id,T=y;if(this.configuration.hasGeometryExpr){if(!n)return void E.error("mapview-labeling","Tried to evaluate geometry expression but no transformation found");var F=n.transform,L=n.hasZ,z=n.hasM,k=this.hydrate(y.geometry,F,L,z),R=i({},y,{geometry:k});k.spatialReference=c.fromJSON(this.spatialReference),T=R}var j=I.bidiText(this._evaluateLabelExpression(T,P,s)),V=j[0],G=j[1];if(h.DEBUG_LABELS){var q="-"+S;V=V.substring(0,V.length-q.length)+q}V&&V.length&&(M(P.labelClass.symbol,V,r),x.push({text:V,rtl:G,id:C}))}u.set(S,x)}return u},t.prototype._evaluateLabelExpression=function(e,t,r){if(!t.labelClass.symbol)return"";if(!f.evaluateWhere(t.labelClass.where,e.attributes))return"";if(!t.labelExpression.expression)return"";var n=i({view:r},t.labelOptions);return d.buildLabelText(t.labelExpression.expression,e,this.fields,n)},n([p.property({readOnly:!0})],t.prototype,"supportsTileUpdates",null),n([p.property()],t.prototype,"configuration",void 0),n([p.property({dependsOn:["configuration"]})],t.prototype,"labelingInfo",null),n([p.property({dependsOn:["labelingInfo"]})],t.prototype,"labelClassInfos",null),n([p.property({dependsOn:["service"]})],t.prototype,"hydrate",null),n([p.property({dependsOn:["configuration","service","fields","tileStore"]})],t.prototype,"factory",null),n([p.property({constructOnly:!0})],t.prototype,"queryInfo",null),n([p.property({dependsOn:["configuration"]})],t.prototype,"renderer",null),n([p.property({dependsOn:["configuration"]})],t.prototype,"rendererInfo",null),n([p.property({readOnly:!0})],t.prototype,"updating",null),n([p.property({dependsOn:["service"]})],t.prototype,"fields",null),n([p.subclass()],t)}(p.declared(x.default));t.default=P}.apply(null,n))||(e.exports=i)},2273:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1512)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._bucketSize=e,this._rowsLength=r.TILE_SIZE/e,this._colsLength=r.TILE_SIZE/e,this._grid=this._initGrid()}return e.prototype.checkOverlap=function(e,t){var r=Math.floor(e/this._bucketSize),n=Math.floor(t/this._bucketSize);return r<0||r>=this._rowsLength||n<0||n>=this._colsLength||!!this._grid[n][r]||!(this._grid[n][r]=!0)},e.prototype.reset=function(){this._grid=this._initGrid()},e.prototype._initGrid=function(){for(var e=[],t=0;t<this._rowsLength;t++)e.push(new Array(this._colsLength));return e},e}();t.default=n}.apply(null,n))||(e.exports=i)},2274:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(14),r(1748),r(1512),r(1525)],void 0===(i=function(e,t,r,n,i,o){function s(e,t){return null==e?t:e}function l(e){var t=s(e.xoffset,0),r=s(e.yoffset,0);return Math.sqrt(t*t+r*r)}function a(e,t){return Math.max(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var u={"simple-marker":1,"picture-marker":1,text:1,"simple-line":1,"simple-fill":1,"picture-fill":1,cim:1},p=.707;t.computePxBuffer=function(e){if("simple"!==e.type&&"class-breaks"!==e.type&&"unique-value"!==e.type)return 0;var t=e.getSymbols();return r.pt2px(t.map(function(r){return function(e,r){return function(e){return e.type in u}(e)?Math.min(Math.max(5,function(e,r){if("simple-marker"===e.type){var n=Math.max(s(e.size,12),r);return l(e)+n*p}if("picture-marker"===e.type){var a=Math.max(s(e.height,12),r),u=s(e.width,12)*(a/s(e.height,12)),y=u/2,h=a/2;return l(e)+Math.sqrt(y*y+h*h)}if("text"===e.type){o.getTextSymbolEstimatedSize(c,e,i.AVERAGE_GLYPH_MOSAIC_ITEM);var m=c[2]*(s(e.horizontalAlignment,"top")in f?1:.5),g=c[3]*(s(e.horizontalAlignment,"center")in d?1:.5),v=function(e,t){return null==e.font?t:s(e.font.size,t)}(e,9),b=Math.max(v,r)/v;return l(e)+Math.sqrt(m*m+g*g)*b}if("simple-line"===e.type)return Math.max(s(e.width,.75),r)/2;if("simple-fill"===e.type||"picture-fill"===e.type)return Math.max(function(e,t){return null==e.outline?t:s(e.outline.width,t)}(e,.75),r)/2;if("cim"===e.type){var _=t.CIMSymbolHelper.getEnvelope(e);return Math.sqrt(_.width*_.width+_.height*_.height)}}(e,r)),75):0}(r,function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];return"stops"===r.transformationType?r.stops.map(function(e){return e.size}).reduce(a,0):"clamped-linear"===r.transformationType?"number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map(function(e){return e.size}).reduce(a,0):"real-world-size"===r.transformationType?30:void 0}(e))}).reduce(a,0))};var c=[0,0,0,0],f={left:1,right:1},d={top:1,bottom:1,baseline:1}}.apply(null,n))||(e.exports=i)}}]);